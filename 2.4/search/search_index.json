{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Percona XtraBackup - Documentation","text":"<p>This documentation is for the latest release: Percona XtraBackup 2.4.27 (Release Notes).</p> <p>Percona XtraBackup is an open-source hot backup utility for MySQL - based servers that does not lock your database during the backup. It can back up data from InnoDB, XtraDB, and MyISAM tables on MySQL 5.1 , 5.5, 5.6 and 5.7 servers, as well as Percona Server with XtraDB.</p> <p>Note</p> <p>Support for InnoDB 5.1 builtin has been removed in Percona XtraBackup 2.1</p> <p>For a high-level overview of many of its advanced features, including a feature comparison, please see About Percona XtraBackup.</p> <p>Whether it is a 24x7 highly loaded server or a low-transaction-volume environment, Percona XtraBackup is designed to make backups a seamless procedure without disrupting the performance of the server in a production environment. Commercial support contracts are available.</p> <p>Important</p> <p>Percona XtraBackup 2.4 does not support making backups of databases created in MySQL 8.0, Percona Server for MySQL 8.0, or Percona XtraDB Cluster 8.0. Use Percona XtraBackup 8.0 for the version 8.0 databases.</p>"},{"location":"404.html","title":"404 - Not Found","text":"<p>We can\u2019t find the page you are looking for. Try using the Search or return to the homepage.</p>"},{"location":"copyright-and-licensing-information.html","title":"Copyright and licensing information","text":""},{"location":"copyright-and-licensing-information.html#documentation-licensing","title":"Documentation licensing","text":"<p>Percona XtraBackup documentation is (C)2009-2023 Percona LLC and/or its affiliates and is distributed under the Creative Commons Attribution 4.0 International License.</p>"},{"location":"faq.html","title":"Frequently Asked Questions","text":""},{"location":"faq.html#do-i-need-an-innodb-hot-backup-license-to-use-percona-xtrabackup","title":"Do I need an InnoDB Hot Backup license to use Percona XtraBackup?","text":"<p>No. Although <code>innobackupex</code> is derived from the same GPL and open-source wrapper script that InnoDB Hot Backup uses, it does not execute <code>ibbackup</code>, and the <code>xtrabackup</code> binary does not execute or link to <code>ibbackup</code>. You can use Percona  XtraBackup without any license; it is completely separate from InnoDB Hot Backup.</p>"},{"location":"faq.html#whats-the-difference-between-innobackupex-and-innobackup","title":"What\u2019s the difference between innobackupex and innobackup?","text":"<p>The innobackupex binary is a patched version of the Oracle innobackup script (renamed mysqlbackup). They are similar, and familiarity with innobackup might be helpful.</p> <p>Besides the available options for specific features of innobackupex, the main differences are:</p> <ul> <li> <p>Prints to <code>STDERR</code> instead of <code>STDOUT</code> which enables the <code>innobackupex --stream</code> option</p> </li> <li> <p>Detects the configuration file - <code>my.cnf</code> - is automatically (or set with <code>innobackupex --defaults-file</code>) instead of requiring the configuration file as the the first argument</p> </li> <li> <p>Defaults to xtrabackup as binary to use in the <code>innobackupex --ibbackup</code></p> </li> </ul> <p>See The innobackupex Option Reference for more details.</p>"},{"location":"faq.html#which-web-based-backup-tools-are-based-on-percona-xtrabackup","title":"Which Web-based backup tools are based on Percona XtraBackup?","text":"<p>Zmanda Recovery Manager is a commercial tool that uses Percona  XtraBackup for Non-Blocking Backups:</p> <p>\u201cZRM provides support for non-blocking backups of MySQL using Percona XtraBackup. ZRM with Percona  XtraBackup provides resource utilization management by providing throttling based on the number of IO operations per second. Percona  XtraBackup based backups also allow for table-level recovery even though the backup was done at the database level. This operation requires the recovery database server to be Percona Server for MySQL with XtraDB.\u201d</p>"},{"location":"faq.html#xtrabackup-binary-fails-with-a-floating-point-exception","title":"xtrabackup binary fails with a floating point exception","text":"<p>In most of the cases this is due to not having installed the required libraries (and version) by xtrabackup. Installing the GCC suite with the supporting libraries and recompiling xtrabackup will solve the issue. See Compiling and Installing from Source Code for instructions on the procedure.</p>"},{"location":"faq.html#how-does-xtrabackup-handle-the-ibdataib_log-files-on-restore-if-they-are-not-in-the-mysql-datadir","title":"How does xtrabackup handle the <code>ibdata/ib_log</code> files on restore if they are not in the MySQL datadir?","text":"<p>If the <code>ibdata</code> and <code>ib_log</code> files are located in different directories outside of the datadir, you move them to their proper place after the logs have been applied.</p>"},{"location":"faq.html#backup-fails-with-error-24-too-many-open-files","title":"Backup fails with Error 24: \u2018Too many open files\u2019","text":"<p>This error usually occurs when the database being backed up contains large amount of files and Percona  XtraBackup can\u2019t open all of them to create a successful backup. In order to avoid this error the operating system should be configured appropriately so that Percona  XtraBackup can open all its files. On Linux, this can be done with the <code>ulimit</code> command for specific backup session or by editing the /etc/security/limits.conf to change it globally</p> <p>Note</p> <p>The maximum possible value that can be set up is <code>1048576</code> which is a hard-coded constant in the Linux kernel.</p>"},{"location":"faq.html#how-to-deal-with-skipping-of-redo-logs-for-ddl-operations","title":"How to deal with skipping of redo logs for DDL operations?","text":"<p>To prevent creating corrupted backups when running DDL operations, Percona XtraBackup aborts if it detects that redo logging is disabled. In this case, the following error is printed:</p> <pre><code>[FATAL] InnoDB: An optimized (without redo logging) DDL operation has been performed. All modified pages may not have been flushed to the disk yet.\nPercona XtraBackup will not be able to take a consistent backup. Retry the backup operation.\n</code></pre> <p>Note</p> <p>Redo logging is disabled during a sorted index build</p> <p>To avoid this error, Percona XtraBackup can use metadata locks on tables while they are copied:</p> <ul> <li> <p>To block all DDL operations, use the <code>xtrabackup --lock-ddl</code> option that issues <code>LOCK TABLES FOR BACKUP</code>.</p> </li> <li> <p>If <code>LOCK TABLES FOR BACKUP</code> is not supported, you can block DDL for each table before XtraBackup starts to copy it and until the backup is completed using the <code>xtrabackup --lock-ddl-per-table</code> option.</p> </li> </ul>"},{"location":"glossary.html","title":"Glossary","text":""},{"location":"glossary.html#arm-file","title":".ARM file","text":"<p>Contains the metadata for each Archive Storage Engine table.</p>"},{"location":"glossary.html#arz-file","title":".ARZ file","text":"<p>Contains the data for each Archive Storage Engine table.</p>"},{"location":"glossary.html#csm","title":".CSM","text":"<p>Each table with the CSV Storage Engine has <code>.CSM</code> file which contains the metadata of it.</p>"},{"location":"glossary.html#csv","title":".CSV","text":"<p>Each table with the CSV Storage engine has <code>.CSV</code> file which contains the data of it (which is a standard Comma Separated Value file).</p>"},{"location":"glossary.html#exp","title":".exp","text":"<p>Files with the <code>.exp</code> extension are created by Percona XtraBackup per each InnoDB tablespace when the  <code>--export</code> option is used in the prepare phase. See restoring individual tables.</p>"},{"location":"glossary.html#frm","title":".frm","text":"<p>For each table, the server will create a file with the <code>.frm</code> extension containing the table definition (for all storage engines).</p>"},{"location":"glossary.html#ibd","title":".ibd","text":"<p>On a multiple tablespace setup (innodb_file_per_table enabled), MySQL will store each newly created table in a file with a <code>.ibd</code> extension.</p>"},{"location":"glossary.html#mrg","title":".MRG","text":"<p>Each table using the MERGE storage engine, besides of a .frm file, will have .MRG file containing the names of the MyISAM tables associated with it.</p>"},{"location":"glossary.html#myd","title":".MYD","text":"<p>Each MyISAM table has <code>.MYD</code> (MYData) file which contains the data on it.</p>"},{"location":"glossary.html#myi","title":".MYI","text":"<p>Each MyISAM table has <code>.MYI</code> (MYIndex) file which contains the table\u2019s indexes.</p>"},{"location":"glossary.html#opt","title":".opt","text":"<p>MySQL stores options of a database (like charset) in a file with a <code>.opt</code> extension in the database directory.</p>"},{"location":"glossary.html#par","title":".par","text":"<p>Each partitioned table has .par file which contains metadata about the partitions.</p>"},{"location":"glossary.html#trg","title":".TRG","text":"<p>File containing the triggers associated with a table, for example <code>:file:mytable.TRG</code> With the .TRN file, they represent all the Trigger definitions.</p>"},{"location":"glossary.html#trn","title":".TRN","text":"<p>File containing the names of the triggers that are associated with a table, for example <code>:file:mytable.TRN</code>. With the  <code>.TRG</code> file, they represent all the trigger definitions.</p>"},{"location":"glossary.html#backup","title":"backup","text":"<p>The process of copying data or tables to be stored in a different location.</p>"},{"location":"glossary.html#compression","title":"compression","text":"<p>The method that produces backups in a reduced size.</p>"},{"location":"glossary.html#configuration-file","title":"configuration file","text":"<p>The file that contains the server startup options.</p>"},{"location":"glossary.html#crash","title":"crash","text":"<p>An unexpected shutdown that does not allow the normal server shutdown cleanup activities.</p>"},{"location":"glossary.html#crash-recovery","title":"crash recovery","text":"<p>The actions that occur when MySQL is restarted after a crash.</p>"},{"location":"glossary.html#data-dictionary","title":"data dictionary","text":"<p>The metadata for the tables, indexes, and table columns stored in the InnoDB system tablespace.</p>"},{"location":"glossary.html#datadir","title":"datadir","text":"<p>The directory in which the database server stores its data files. Most Linux distribution use <code>/var/lib/mysql</code> by default.</p>"},{"location":"glossary.html#full-backup","title":"full backup","text":"<p>A backup that contains the complete source data from an instance.</p>"},{"location":"glossary.html#ibdata","title":"ibdata","text":"<p>Default prefix for tablespace files, for example, <code>ibdata1</code> is a 10MB auto-extensible file that MySQL creates for the shared tablespace by default.</p>"},{"location":"glossary.html#incremental-backup","title":"incremental backup","text":"<p>A backup stores data from a specific point in time.</p>"},{"location":"glossary.html#innodb","title":"InnoDB","text":"<p>Storage engine which provides ACID-compliant transactions and foreign key support, among others improvements over MyISAM. It is the default engine for MySQL as of the 8.0 series.</p>"},{"location":"glossary.html#innodb_buffer_pool_size","title":"innodb_buffer_pool_size","text":"<p>The size in bytes of the memory buffer to cache data and indexes of InnoDB\u2019s tables. This aims to reduce disk access to provide better performance. By default:</p> <pre><code>[mysqld]\ninnodb_buffer_pool_size=8MB\n</code></pre>"},{"location":"glossary.html#innodb_data_home_dir","title":"innodb_data_home_dir","text":"<p>The directory (relative to datadir) where the database server stores the files in a shared tablespace setup. This option does not affect the location of innodb_file_per_table. For example:</p> <pre><code>[mysqld]\ninnodb_data_home_dir = ./\n</code></pre>"},{"location":"glossary.html#innodb_data_file_path","title":"innodb_data_file_path","text":"<p>Specifies the names, sizes and location of shared tablespace files:</p> <pre><code>[mysqld]\ninnodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend\n</code></pre>"},{"location":"glossary.html#innodb_file_per_table","title":"innodb_file_per_table","text":"<p>By default, InnoDB creates tables and indexes in a file-per-tablespace. If the <code>innodb_file_per_table</code> variable is disabled, you can enable the variable in your configuration file:</p> <pre><code>[mysqld]\ninnodb_file_per_table\n</code></pre> <p>or start the server with <code>--innodb_file_per_table</code>.</p>"},{"location":"glossary.html#innodb_log_group_home_dir","title":"innodb_log_group_home_dir","text":"<p>Specifies the location of the InnoDB log files:</p> <pre><code>[mysqld]\ninnodb_log_group_home=/var/lib/mysql\n</code></pre>"},{"location":"glossary.html#logical-backup","title":"logical backup","text":"<p>A backup which contains a set of SQL statements. The statements can be used to recreate the databases.</p>"},{"location":"glossary.html#lsn","title":"LSN","text":"<p>Each InnoDB page (usually 16kb in size) contains a log sequence number, or LSN. The LSN is the system version number for the entire database. Each page\u2019s LSN shows how recently it was changed.</p>"},{"location":"glossary.html#mycnf","title":"my.cnf","text":"<p>The database server\u2019s main configuration file. Most Linux distributions place it as <code>/etc/mysql/my.cnf</code> or <code>/etc/my.cnf</code>, but the location and name depends on the particular installation. Note that this is not the only way of configuring the server, some systems does not have one and rely on the command options to start the server and its default values.</p>"},{"location":"glossary.html#myisam","title":"MyISAM","text":"<p>Previous default storage engine for MySQL for versions prior to 5.5. It doesn\u2019t fully support transactions but in some scenarios may be faster than InnoDB. Each table is stored on disk in 3 files: .frm, .MYD, .MYI.</p>"},{"location":"glossary.html#physical-backup","title":"physical backup","text":"<p>A backup that copies the data files.</p>"},{"location":"glossary.html#point-in-time-recovery","title":"point in time recovery","text":"<p>This method allows data to be restored to the state it was in any selected point of time.</p>"},{"location":"glossary.html#prepared-backup","title":"prepared backup","text":"<p>A consistent set of backup data that is ready to be restored.</p>"},{"location":"glossary.html#restore","title":"restore","text":"<p>Copies the database backups taken using the backup command to the original location or a different location. A restore returns data that has been either lost, corrupted, or stolen to the original condition at a specific point in time.</p>"},{"location":"glossary.html#xbcrypt","title":"xbcrypt","text":"<p>To support encryption and decryption of the backups, a new tool xbcrypt was introduced to Percona XtraBackup. This utility has been modeled after the xbstream binary to perform encryption and decryption outside of Percona XtraBackup.</p>"},{"location":"glossary.html#xbstream","title":"xbstream","text":"<p>To support simultaneous compression and streaming, Percona XtraBackup uses the xbstream format. For more information, see <code>--stream</code></p>"},{"location":"glossary.html#xtradb","title":"XtraDB","text":"<p>Percona XtraDB is an enhanced version of the InnoDB storage engine, designed to better scale on modern hardware. Percona XtraDB includes a variety of other features useful in high performance environments. It is fully backwards compatible, and so can be used as a drop-in replacement for standard InnoDB. More information here.</p>"},{"location":"how-tos.html","title":"How-tos and Recipes","text":""},{"location":"how-tos.html#recipes-for-innobackupex","title":"Recipes for innobackupex","text":"<ul> <li> <p>Make a Local Full Backup (Create, Prepare and Restore)</p> </li> <li> <p>Make a Streaming Backup</p> </li> <li> <p>Making an Incremental Backup</p> </li> <li> <p>Making a Compressed Backup</p> </li> <li> <p>Backing Up and Restoring Individual Partitions</p> </li> </ul>"},{"location":"how-tos.html#recipes-for-xtrabackup","title":"Recipes for xtrabackup","text":"<ul> <li> <p>Making a Full Backup</p> </li> <li> <p>Making an Incremental Backup</p> </li> <li> <p>Restoring the Backup</p> </li> </ul>"},{"location":"how-tos.html#how-tos","title":"How-Tos","text":"<ul> <li> <p>How to setup a replica for replication in 6 simple steps with Percona XtraBackup</p> </li> <li> <p>Verifying Backups with replication and pt-checksum</p> </li> <li> <p>How to create a new (or repair a broken) GTID based slave</p> </li> </ul>"},{"location":"how-tos.html#auxiliary-guides","title":"Auxiliary Guides","text":"<ul> <li> <p>Enabling the server to communicate via TCP/IP</p> </li> <li> <p>Privileges and Permissions for Users</p> </li> <li> <p>Installing and configuring a SSH server</p> </li> </ul>"},{"location":"how-tos.html#assumptions-in-this-section","title":"Assumptions in this section","text":"<p>The context should make the recipe or tutorial understandable. To assure that this is true, a list of the assumptions, names and other objects that appears in this section. This items are specified at the beginning of each recipe or tutorial.</p> <p><code>HOST</code></p> <p>A system with a MySQL-based server installed, configured and running. We assume the following about this system:</p> <ul> <li> <p>The MySQL server is able to communicate with others by the  standard TCP/IP port;</p> </li> <li> <p>An SSH server is installed and configured - see here if it is not;</p> </li> <li> <p>You have an user account in the system with the appropriate permissions</p> </li> <li> <p>You have a MySQL\u2019s user account with appropriate Connection and Privileges Needed.</p> </li> </ul> <p><code>USER</code></p> <p>This is a user account with shell access and the appropriate permissions for the task. A guide for checking them is here.</p> <p><code>DB-USER</code></p> <p>This is a user account in the database server with the appropriate privileges for the task. A guide for checking them is here.</p>"},{"location":"how_xtrabackup_works.html","title":"How Percona XtraBackup Works","text":"<p>Percona XtraBackup is based on InnoDB\u2019s crash-recovery functionality. It copies your InnoDB data files, which results in data that is internally inconsistent; but then it performs crash recovery on the files to make them a consistent, usable database again.</p> <p>This works because InnoDB maintains a redo log, also called the transaction log. This contains a record of every change to InnoDB data. When InnoDB starts, it inspects the data files and the transaction log, and performs two steps. It applies committed transaction log entries to the data files, and it performs an undo operation on any transactions that modified data but did not commit.</p> <p>Percona XtraBackup works by remembering the log sequence number (LSN) when it starts, and then copying away the data files. It takes some time to do this, so if the files are changing, then they reflect the state of the database at different points in time. At the same time, Percona XtraBackup runs a background process that watches the transaction log files, and copies changes from it. Percona XtraBackup needs to do this continually because the transaction logs are written in a round-robin fashion, and can be reused. Percona XtraBackup needs the transaction log records for every change to the data files since it began execution.</p> <p>Percona XtraBackup will use Backup locks where available as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code>. This feature is available in Percona Server for MySQL 5.6+. Percona XtraBackup uses this automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables. When backup locks are supported by the server, xtrabackup will first copy InnoDB data, run the <code>LOCK TABLES FOR BACKUP</code> and copy the MyISAM tables and <code>.frm</code> files. Once this is done, the backup of the files will begin. It will backup <code>.frm</code>, <code>.MRG</code>, <code>.MYD</code>, <code>.MYI</code>, <code>.TRG</code>, <code>.TRN</code>, <code>.ARM</code>, <code>.ARZ</code>, <code>.CSM</code>, <code>.CSV</code>, <code>.par</code>, and <code>.opt</code> files.</p> <p>Note</p> <p>Locking is done only for MyISAM and other non-InnoDB tables, and only after Percona XtraBackup is finished backing up all InnoDB/XtraDB data and logs. Percona XtraBackup will use Backup locks where available as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code>. This feature is available in Percona Server for MySQL 5.6+. Percona XtraBackup uses this automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p> <p>After that, xtrabackup will use <code>LOCK BINLOG FOR BACKUP</code> to block all operations that might change either the binary log position or <code>Exec_Master_Log_Pos</code> or <code>Exec_Gtid_Set</code> (i.e. source binary log coordinates corresponding to the current SQL thread state on a replication replica) as reported by <code>SHOW MASTER/SLAVE STATUS</code>. xtrabackup will then finish copying the REDO log files and fetch the binary log coordinates. After this is completed xtrabackup will unlock the binary log and tables.</p> <p>Finally, the binary log position will be printed to <code>STDERR</code> and xtrabackup exits, returning 0 if all went OK.</p> <p>Note that the <code>STDERR</code> of xtrabackup is not written in any file. You will have to redirect it to a file, e.g., <code>xtrabackup OPTIONS 2&gt; backupout.log</code>.</p> <p>It will also create the following files in the directory of the backup.</p> <p>During the prepare phase, Percona XtraBackup performs crash recovery against the copied data files, using the copied transaction log file. After this is done, the database is ready to restore and use.</p> <p>The backed-up MyISAM and InnoDB tables will be eventually consistent with each other, because after the prepare (recovery) process, InnoDB\u2019s data is rolled forward to the point at which the backup completed, not rolled back to the point at which it started. This point in time matches where the <code>FLUSH TABLES WITH READ LOCK</code> was taken, so the MyISAM data and the prepared InnoDB data are in sync.</p> <p>The xtrabackup and innobackupex tools both offer many features not mentioned in the preceding explanation. Each tool\u2019s functionality is explained in more detail further in the manual. In brief, though, the tools permit you to do operations such as streaming and incremental backups with various combinations of copying the data files, copying the log files, and applying the logs to the data.</p>"},{"location":"how_xtrabackup_works.html#restoring-a-backup","title":"Restoring a backup","text":"<p>To restore a backup with xtrabackup you can use the <code>xtrabackup --copy-back</code> or <code>xtrabackup --move-back</code> options.</p> <p>xtrabackup will read from the <code>my.cnf</code> the variables <code>datadir</code>, <code>innodb_data_home_dir</code>, <code>innodb_data_file_path</code>, <code>innodb_log_group_home_dir</code> and check that the directories exist.</p> <p>It will copy the MyISAM tables, indexes, etc. (<code>.frm</code>, <code>.MRG</code>, <code>.MYD</code>, <code>.MYI</code>, <code>.TRG</code>, <code>.TRN</code>, <code>.ARM</code>, <code>.ARZ</code>, <code>.CSM</code>, <code>.CSV</code>, <code>par</code> and .opt files) first, InnoDB tables and indexes next and the log files at last. It will preserve file\u2019s attributes when copying them, you may have to change the files\u2019 ownership to <code>mysql</code> before starting the database server, as they will be owned by the user who created the backup.</p> <p>Alternatively, the <code>xtrabackup --move-back</code> option may be used to restore a backup. This option is similar to <code>xtrabackup --copy-back</code> with the only difference that instead of copying files it moves them to their target locations. As this option removes backup files, use it with caution. It is useful when there is not enough free disk space to hold both the data files and their backup copies.</p>"},{"location":"installation.html","title":"Installing Percona XtraBackup 2.4","text":"<p>Note</p> <p>Install Percona XtraBackup 2.4 using the following methods. The instructions to install Percona XtraBackup 8.0 are available in the Percona XtraBackup 8.0 documentation.</p> <p>We recommend that you install Percona XtraBackup 2.4 from the official Percona software repositories using the appropriate package manager for your system:</p> <ul> <li> <p>Use an APT repo</p> </li> <li> <p>Use a YUM repo</p> </li> </ul>"},{"location":"installation.html#installation-alternatives","title":"Installation alternatives","text":"<p>Percona also provides the following methods:</p> <ul> <li> <p>Download a binary tarball with the required files and binaries for a manual installation</p> </li> <li> <p>Compile from source</p> </li> <li> <p>Run in a Docker Container</p> </li> </ul> <p>Before installing Percona XtraBackup with any of these methods, we recommend that you review the release notes.</p>"},{"location":"intro.html","title":"About Percona XtraBackup","text":"<p>Percona XtraBackup is the world\u2019s only open-source, free MySQL hot backup software that performs non-blocking backups for InnoDB and XtraDB databases. With Percona XtraBackup, you can achieve the following benefits:</p> <ul> <li> <p>Backups that complete quickly and reliably</p> </li> <li> <p>Uninterrupted transaction processing during backups</p> </li> <li> <p>Savings on disk space and network bandwidth</p> </li> <li> <p>Automatic backup verification</p> </li> <li> <p>Higher uptime due to faster restore time</p> </li> </ul> <p>See the compatibility matrix in Percona Software and Platform Lifecycle to find out which versions of MySQL, MariaDB, and Percona Server for MySQL are supported by Percona XtraBackup and supports encryption with any kind of backups.</p> <p>Non-blocking backups of InnoDB, Percona XtraDB Cluster, and HailDB storage engines are supported. In addition, Percona XtraBackup can back up the following storage engines by briefly pausing writes at the end of the backup: MyISAM, <code>Merge &lt;.MRG&gt;</code>, and <code>Archive &lt;.ARM&gt;</code>, including partitioned tables, triggers, and database options. InnoDB tables are still locked while copying non-InnoDB data. Fast incremental backups are supported for Percona Server with Percona XtraDB Cluster changed page tracking enabled.</p> <p>Important</p> <p>Percona XtraBackup 2.4 only supports Percona XtraDB Cluster 5.7. Percona XtraBackup 2.4 does not support the MyRocks storage engine or TokuDB storage engine. Percona XtraBackup is not compatible with MariaDB 10.3 and later.</p> <p>Percona\u2019s enterprise-grade commercial MySQL Support contracts include support for Percona XtraBackup. We recommend support for critical production deployments.</p>"},{"location":"intro.html#what-are-the-features-of-percona-xtrabackup","title":"What are the features of Percona XtraBackup?","text":"<p>Here is a short list of Percona XtraBackup features. See the documentation for more.</p> <ul> <li> <p>Create hot InnoDB backups without pausing your database</p> </li> <li> <p>Make incremental backups of MySQL</p> </li> <li> <p>Stream compressed MySQL backups to another server</p> </li> <li> <p>Move tables between MySQL servers on-line</p> </li> <li> <p>Create new MySQL replication replicas easily</p> </li> <li> <p>Backup MySQL without adding load to the server</p> </li> <li> <p>Backup locks are a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> available in Percona Server 5.6+. Percona XtraBackup uses them automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p> </li> <li> <p>Percona XtraBackup performs throttling based on the number of IO operations per second.</p> </li> <li> <p>Percona XtraBackup skips secondary index pages and recreates them when a compact backup is prepared.</p> </li> <li> <p>Percona XtraBackup can export individual tables even from a full backup, regardless of the InnoDB version.</p> </li> <li> <p>Tables exported with Percona XtraBackup can be imported into Percona Server 5.1, 5.5 or 5.6+, or MySQL 5.6+.</p> </li> </ul>"},{"location":"known_issues.html","title":"Known issues and limitations","text":"<p>There is a number of Percona XtraBackup related issues with compressed InnoDB tables. These issues result from either server-side bugs, or OS configuration and thus, cannot be fixed on the Percona XtraBackup side.</p> <p>Known issues:</p> <ul> <li> <p>For MySQL or Percona Server for MySQL versions 5.1 and 5.5 there are known and unfixed bugs with redo-logging of updates to compressed InnoDB tables. For example, internal Oracle bug #16267120 has been fixed only in MySQL 5.6.12, but not in 5.1 or 5.5. The bug is about compressed page images not being logged on page reorganization and thus, creating a possibility for recovery process to fail in case a different zlib version is being used when replaying a <code>MLOG_ZIP_PAGE_REORGANIZE</code> redo log record.</p> </li> <li> <p>For MySQL or Percona Server for MySQL version 5.6 it is NOT recommended to set <code>innodb_log_compressed_pages=OFF</code> for servers that use compressed InnoDB tables which are backed up with Percona XtraBackup. This option makes InnoDB recovery (and thus, backup prepare) sensible to <code>zlib</code> versions. In case the host where a backup prepare is performed uses a different <code>zlib</code> version than the one that was used by the server during runtime, backup prepare may fail due to differences in compression algorithms.</p> </li> <li> <p>Backed-up table data could not be recovered if backup was taken while running <code>OPTIMIZE TABLE</code> (bug https://bugs.launchpad.net/percona-xtrabackup/+bug/1541763) or <code>ALTER TABLE ...  TABLESPACE</code> (bug PXB-1360) on that table.</p> </li> <li> <p>Compact Backups currently don\u2019t work due to bug PXB-372.</p> </li> <li> <p>Backup fails with <code>Error 24: 'Too many open files'</code>. This usually happens when database being backed up contains large amount of files and Percona XtraBackup can\u2019t open all of them to create a successful backup. In order to avoid this error the operating system should be configured appropriately so that Percona XtraBackup can open all its files. On Linux, this can be done with the <code>ulimit</code> command for specific backup session or by editing the /etc/security/limits.conf to change it globally (NOTE: the maximum possible value that can be set up is <code>1048576</code> which is a hard-coded constant in the Linux kernel).</p> </li> </ul> <p>The <code>xtrabackup</code> binary has some limitations you should be aware of to ensure that your backups go smoothly and are recoverable.</p> <p>Limitations:</p> <ul> <li> <p>The Aria storage engine is part of MariaDB and has been integrated in it for many years and Aria table files backup support has been added to innobackupex in 2011. The issue is that the engine uses recovery log files and an aria_log_control file that are not backed up by xtrabackup. As stated in the documentation, starting MariaDB without the <code>maria_log_control</code> file will mark all the Aria tables as corrupted with this error when doing a <code>CHECK</code> on the table: <code>Table is from another system and must be zerofilled or repaired to be usable on this system</code>. This means that the Aria tables from an xtrabackup backup must be repaired before being usable (this could ben quite long depending on the size of the table). Another option is <code>aria_chk  --zerofil table</code> on all Aria tables present on the backup after the prepare phase.</p> </li> <li> <p>If the <code>xtrabackup_logfile</code> is larger than 4GB, the <code>--prepare</code> step will fail on 32-bit versions of <code>xtrabackup</code>.</p> </li> <li> <p><code>xtrabackup</code> doesn\u2019t understand the very old <code>--set-variable</code> <code>my.cnf</code> syntax that MySQL uses. See Configuring xtrabackup.</p> </li> </ul>"},{"location":"manual.html","title":"Percona XtraBackup User Manual","text":"<p>Percona XtraBackup is a set of following tools:</p> <p>innobackupex</p> <pre><code>innobackupex is the symlink for *xtrabackup*. innobackupex still\nsupports all features and syntax as 2.2 version did, but is now\ndeprecated and will be removed in next major release.\n</code></pre> <p>xtrabackup</p> <pre><code>a compiled *C* binary that provides functionality to backup a whole *MySQL*\ndatabase instance with *MyISAM*, *InnoDB*, and XtraDB tables.\n</code></pre> <p>xbcrypt</p> <pre><code>utility used for encrypting and decrypting backup files.\n</code></pre> <p>xbstream</p> <pre><code>utility that allows streaming and extracting files to/from the\nxbstream format.\n</code></pre> <p>xbcloud</p> <pre><code>utility used for downloading and uploading full or part of xbstream\narchive from/to cloud.\n</code></pre> <p>After Percona XtraBackup 2.3 release the recommend way to take the backup is using the xtrabackup script. More information on script options can be found in how to use xtrabackup.</p>"},{"location":"release-notes.html","title":"Percona XtraBackup 2.4 Release notes index","text":"<ul> <li> <p>Percona XtraBackup 2.4.27 (2022-12-06)</p> </li> <li> <p>Percona XtraBackup 2.4.26 (2022-05-09)</p> </li> <li> <p>Percona XtraBackup 2.4.25 (2022-04-16)</p> </li> <li> <p>Percona XtraBackup 2.4.24 (2021-09-14)</p> </li> <li> <p>Percona XtraBackup 2.4.23 (2021-06-22)</p> </li> <li> <p>Percona XtraBackup 2.4.22 (2021-03-22)</p> </li> <li> <p>Percona XtraBackup 2.4.21 (2020-11-12)</p> </li> <li> <p>Percona XtraBackup 2.4.20 (2020-04-14)</p> </li> <li> <p>Percona XtraBackup 2.4.19 (2020-03-25)</p> </li> <li> <p>Percona XtraBackup 2.4.18 (2019-12-16)</p> </li> <li> <p>Percona XtraBackup 2.4.17 (2019-12-09)</p> </li> <li> <p>Percona XtraBackup 2.4.16 (2019-11-04)</p> </li> <li> <p>Percona XtraBackup 2.4.15 (2019-07-10)</p> </li> <li> <p>Percona XtraBackup 2.4.14 (2019-05-01)</p> </li> <li> <p>Percona XtraBackup 2.4.13 (2019-01-18)</p> </li> <li> <p>Percona XtraBackup 2.4.12 (2018-06-22)</p> </li> <li> <p>Percona XtraBackup 2.4.11 (2018-04-23)</p> </li> <li> <p>Percona XtraBackup 2.4.10 (2018-03-30)</p> </li> <li> <p>Percona XtraBackup 2.4.9 (2017-11-29)</p> </li> <li> <p>Percona XtraBackup 2.4.8 (2017-07-24)</p> </li> <li> <p>Percona XtraBackup 2.4.7-2 (2017-05-29)</p> </li> <li> <p>Percona XtraBackup 2.4.7 (2017-04-17)</p> </li> <li> <p>Percona XtraBackup 2.4.6 (2017-02-22)</p> </li> <li> <p>Percona XtraBackup 2.4.5 (2016-11-29)</p> </li> <li> <p>Percona XtraBackup 2.4.4 (2016-07-25)</p> </li> <li> <p>Percona XtraBackup 2.4.3 (2016-05-23)</p> </li> <li> <p>Percona XtraBackup 2.4.2 (2016-04-01)</p> </li> <li> <p>Percona XtraBackup 2.4.1 (2016-02-16)</p> </li> </ul>"},{"location":"trademark-policy.html","title":"Trademark policy","text":"<p>This Trademark Policy is to ensure that users of Percona-branded products or services know that what they receive has really been developed, approved, tested and maintained by Percona. Trademarks help to prevent confusion in the marketplace, by distinguishing one company\u2019s or person\u2019s products and services from another\u2019s.</p> <p>Percona owns a number of marks, including but not limited to Percona, XtraDB, Percona XtraDB, XtraBackup, Percona XtraBackup, Percona Server, and Percona Live, plus the distinctive visual icons and logos associated with these marks. Both the unregistered and registered marks of Percona are protected.</p> <p>Use of any Percona trademark in the name, URL, or other identifying characteristic of any product, service, website, or other use is not permitted without Percona\u2019s written permission with the following three limited exceptions.</p> <p>First, you may use the appropriate Percona mark when making a nominative fair use reference to a bona fide Percona product.</p> <p>Second, when Percona has released a product under a version of the GNU General Public License (\u201cGPL\u201d), you may use the appropriate Percona mark when distributing a verbatim copy of that product in accordance with the terms and conditions of the GPL.</p> <p>Third, you may use the appropriate Percona mark to refer to a distribution of GPL-released  Percona software that has been modified with minor changes for the sole purpose of allowing the software to operate on an operating system or hardware platform for which Percona has not yet released the software, provided that those third party changes do not affect the behavior, functionality, features, design or performance of the software. Users who acquire this Percona-branded software receive substantially exact implementations of the Percona software.</p> <p>Percona reserves the right to revoke this authorization at any time in its sole discretion. For example, if Percona believes that your modification is beyond the scope of the limited license granted in this Policy or that your use of the Percona mark is detrimental to Percona, Percona will revoke this authorization. Upon revocation, you must immediately cease using the applicable Percona mark. If you do not immediately cease using the Percona mark upon revocation, Percona may take action to protect its rights and interests in the Percona mark. Percona does not grant any license to use any Percona mark for any other modified versions of Percona software; such use will require our prior written permission.</p> <p>Neither trademark law nor any of the exceptions set forth in this Trademark Policy permit you to truncate, modify or otherwise use any Percona mark as part of your own brand. For example, if XYZ creates a modified version of the Percona Server, XYZ may not brand that modification as \u201cXYZ Percona Server\u201d or \u201cPercona XYZ Server\u201d, even if that modification otherwise complies with the third exception noted above.</p> <p>In all cases, you must comply with applicable law, the underlying license, and this Trademark Policy, as amended from time to time. For instance, any mention of Percona trademarks should include the full trademarked name, with proper spelling and capitalization, along with attribution of ownership to Percona LLC and/or its affiliates. For example, the full proper name for XtraBackup is Percona XtraBackup. However, it is acceptable to omit the word \u201cPercona\u201d for brevity on the second and subsequent uses, where such omission does not cause confusion.</p> <p>In the event of doubt as to any of the conditions or exceptions outlined in this Trademark Policy, please contact trademarks@percona.com for assistance and we will do our very best to be helpful.</p>"},{"location":"version-check.html","title":"Version Checking","text":"<p>Some Percona software contains \u201cversion checking\u201d functionality which is a feature that enables Percona software users to be notified of available software updates to improve your environment security and performance. Alongside this, the version check functionality also provides Percona with information relating to which software versions you are running, coupled with the environment confirmation which the software is running within. This helps enable Percona to focus our development effort accordingly based on trends within our customer community.</p> <p>The purpose of this document is to articulate the information that is collected, as well as to provide guidance on how to disable this functionality if desired.</p>"},{"location":"version-check.html#usage","title":"Usage","text":"<p>Version Check was implemented in Percona Toolkit 2.1.4, and was enabled by default in version 2.2.1. Currently it is supported as a <code>--[no]version-check</code> option by a number of tools in Percona Toolkit, Percona XtraBackup, and Percona Monitoring and Management (PMM).</p> <p>When launched with Version Check enabled, the tool that supports this feature connects to a Percona\u2019s version check service via a secure HTTPS channel. It compares the locally installed version for possible updates, and also checks versions of the following software:</p> <ul> <li> <p>Operating System</p> </li> <li> <p>Percona Monitoring and Management (PMM)</p> </li> <li> <p>MySQL</p> </li> <li> <p>Perl</p> </li> <li> <p>MySQL driver for Perl (DBD::mysql)</p> </li> <li> <p>Percona Toolkit</p> </li> </ul> <p>Then it checks for and warns about versions with known problems if they are identified as running in the environment.</p> <p>Each version check request is logged by the server. Stored information consists of the checked system unique ID followed by the software name and version.  The ID is generated either at installation or when the version checking query is submitted for the first time.</p> <p>Note</p> <p>Prior to version 3.0.7 of Percona Toolkit, the system ID was calculated as an MD5 hash of a hostname, and starting from Percona Toolkit 3.0.7 it is generated as an MD5 hash of a random number. Percona XtraBackup continues to use hostname-based MD5 hash.</p> <p>As a result, the content of the sent query is as follows:</p> <pre><code>85624f3fb5d2af8816178ea1493ed41a;DBD::mysql;4.044\nc2b6d625ef3409164cbf8af4985c48d3;MySQL;MySQL Community Server (GPL) 5.7.22-log\n85624f3fb5d2af8816178ea1493ed41a;OS;Manjaro Linux\n85624f3fb5d2af8816178ea1493ed41a;Percona::Toolkit;3.0.11-dev\n85624f3fb5d2af8816178ea1493ed41a;Perl;5.26.2\n</code></pre>"},{"location":"version-check.html#disabling-version-check","title":"Disabling Version Check","text":"<p>Although the version checking feature does not collect any personal information, you might prefer to disable this feature, either one time or permanently.  To disable it one time, use <code>--no-version-check</code> option when invoking the tool from a Percona product which supports it. Here is a simple example which shows running pt-diskstats tool from the Percona Toolkit with version checking turned off:</p> <pre><code>pt-diskstats --no-version-check\n</code></pre> <p>Disabling version checking permanently can be done by placing <code>no-version-check</code> option into the configuration file of a Percona product (see correspondent documentation for exact file name and syntax). For example, in case of Percona Toolkit this can be done in a global configuration file <code>/etc/percona-toolkit/percona-toolkit.conf</code>:</p> <pre><code># Disable Version Check for all tools:\nno-version-check\n</code></pre> <p>In case of Percona XtraBackup this can be done in its configuration file in a similar way:</p> <pre><code>[xtrabackup]\nno-version-check\n</code></pre>"},{"location":"version-check.html#frequently-asked-questions","title":"Frequently Asked Questions","text":""},{"location":"version-check.html#why-is-this-functionality-enabled-by-default","title":"Why is this functionality enabled by default?","text":"<p>We believe having this functionality enabled improves security and performance of environments running Percona Software and it is good choice for majority of the users.</p>"},{"location":"version-check.html#why-not-rely-on-operating-systems-built-in-functionality-for-software-updates","title":"Why not rely on Operating System\u2019s built in functionality for software updates?","text":"<p>In many environments the Operating Systems repositories may not carry the latest version of software and newer versions of software often installed manually, so not being covered by operating system wide check for updates.</p>"},{"location":"version-check.html#why-do-you-send-more-information-than-just-the-version-of-software-being-run-as-a-part-of-version-check-service","title":"Why do you send more information than just the version of software being run as a part of version check service?","text":"<p>Compatibility problems can be caused by versions of various components in the environment, for example problematic versions of Perl, DBD or MySQL could cause operational problems with Percona Toolkit.</p>"},{"location":"xtrabackup-files.html","title":"Index of files created by Percona XtraBackup","text":"<ul> <li> <p>Information related to the backup and the server</p> <ul> <li><code>backup-my.cnf</code></li> </ul> <p>This file contains information to start the mini instance of InnoDB   during the <code>xtrabackup --prepare</code>. This is NOT a backup of   original <code>my.cnf</code>. The InnoDB configuration is read from the file   <code>backup-my.cnf</code> created by innobackupex when the backup was   made. <code>xtrabackup --prepare</code> uses InnoDB configuration from   <code>backup-my.cnf</code> by default, or from   <code>xtrabackup --defaults-file</code>, if specified. InnoDB   configuration in this context means server variables that affect data   format, i.e. <code>innodb_page_size</code> option,   <code>innodb_log_block_size</code>, etc. Location-related variables, like   <code>innodb_log_group_home_dir</code> or <code>innodb_data_file_path</code>   are always ignored by <code>xtrabackup --prepare</code>, so preparing   a backup always works with data files from the backup directory, rather   than any external ones.</p> <ul> <li><code>xtrabackup_checkpoints</code></li> </ul> <p>The type of the backup (e.g. full or incremental), its state (e.g.    prepared) and the LSN range contained in it. This information is used    for incremental backups.    Example of the <code>xtrabackup_checkpoints</code> after taking a full    backup:</p> <p><pre><code>backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 15188961605\nlast_lsn = 15188961605\n</code></pre>    Example of the <code>xtrabackup_checkpoints</code> after taking an incremental backup:</p> <pre><code>backup_type = incremental\nfrom_lsn = 15188961605\nto_lsn = 15189350111\nlast_lsn = 15189350111\n</code></pre> <ul> <li><code>xtrabackup_binlog_info</code></li> </ul> <p>The binary log file used by the server and its position at the moment of   the backup. Result of the <code>SHOW MASTER STATUS</code>.</p> <ul> <li><code>xtrabackup_binlog_pos_innodb</code></li> </ul> <p>The binary log file and its current position for InnoDB or XtraDB   tables.</p> <ul> <li><code>xtrabackup_binary</code></li> </ul> <p>The xtrabackup binary used in the process.</p> <ul> <li><code>xtrabackup_logfile</code></li> </ul> <p>Contains data needed for running the: <code>xtrabackup --prepare</code>.   The bigger this file is the <code>xtrabackup --prepare</code> process   will take longer to finish.</p> <ul> <li><code>&lt;table_name&gt;.delta.meta</code></li> </ul> <p>This file is going to be created when performing the incremental backup.   It contains the per-table delta metadata: page size, size of compressed   page (if the value is 0 it means the tablespace isn\u2019t compressed) and   space id. Example of this file could looks like this:</p> <pre><code>page_size = 16384\nzip_size = 0\nspace_id = 0\n</code></pre> </li> <li> <p>Information related to the replication environment (if using the <code>xtrabackup --slave-info</code> option):</p> <ul> <li><code>xtrabackup_slave_info</code></li> </ul> <p>The <code>CHANGE MASTER</code> statement needed for setting up a slave.</p> </li> <li> <p>Information related to the Galera and Percona XtraDB Cluster (if using the <code>xtrabackup --galera-info</code> option):</p> <ul> <li><code>xtrabackup_galera_info</code></li> </ul> <p>Contains the values of <code>wsrep_local_state_uuid</code> and   <code>wsrep_last_committed</code> status variables</p> </li> </ul>"},{"location":"xtrabackup-version-numbers.html","title":"Understand version numbers","text":"<p>A version number identifies the product release. The product contains the latest Generally Available (GA) features at the time of that release. </p> 2.4 26 Base version Minor build version <p>Percona uses semantic version numbering, which follows the pattern of base version and minor build. Percona assigns unique, non-negative integers in increasing order for each minor build release. The version number combines the base Percona XtraBackup version number and the minor build version.</p> <p>Percona does not release a new version of Percona XtraBackup 2.4 for every release of MySQL 5.7. Percona XtraBackup 2.4 is compatible with newer versions of MySQL 5.7. </p> <p>The version numbers for Percona XtraBackup 2.4.26 define the following information:</p> <ul> <li> <p>Base version - the leftmost number indicates the version of the Percona XtraBackup that is based on MySQL 5.7. An increase in base version resets the minor build version to 0.  </p> </li> <li> <p>Minor build version - an internal number that denotes the version of the software. A build version increases by one each time the Percona XtraBackup is released.</p> </li> </ul>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html","title":"Encrypted InnoDB Tablespace Backups","text":"<p>As of MySQL 5.7.11, InnoDB supports data encryption for InnoDB tables stored in file-per-table tablespaces. This feature provides at-rest encryption for physical tablespace data files.</p> <p>For authenticated user or application to access encrypted tablespace, InnoDB will use master encryption key to decrypt the tablespace key. The master encryption key is stored in a keyring. Two keyring plugins supported by xtrabackup are <code>keyring_file</code> and <code>keyring_vault</code>. These plugins are installed into the plugin directory.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#making-a-backup-using-keyring_file-plugin","title":"Making a Backup Using <code>keyring_file</code> Plugin","text":"<p>Support for encrypted InnoDB tablespace backups with <code>keyring_file</code> has been implemented in Percona XtraBackup 2.4.2 by implementing <code>xtrabackup --keyring-file-data</code> option (and also <code>xtrabackup --server-id</code> option, needed for MySQL prior to 5.7.13). These options are only recognized by xtrabackup binary i.e., innobackupex will not be able to backup and prepare encrypted tablespaces.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#creating-backup","title":"Creating Backup","text":"<p>In order to backup and prepare database containing encrypted InnoDB tablespaces, you must specify the path to keyring file by using the <code>xtrabackup --keyring-file-data</code> option.</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backup/ --user=root \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>With MySQL prior to 5.7.13, use <code>xtrabackup --server-id</code> in the backup creation command:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backup/ --user=root \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring --server-id=1\n</code></pre> <p>After xtrabackup is finished taking the backup you should see the following message:</p> <pre><code>xtrabackup: Transaction log of lsn (5696709) to (5696718) was copied.\n160401 10:25:51 completed OK!\n</code></pre> <p>Warning</p> <p>xtrabackup will not copy keyring file into the backup directory. In order to be prepare the backup, you must make a copy of keyring file yourself. </p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#preparing-backup","title":"Preparing Backup","text":"<p>In order to prepare the backup you\u2019ll need to specify the keyring-file-data (server-id is stored in <code>backup-my.cnf</code> file, so it can be omitted when preparing the backup, regardless of the MySQL version used).</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backup \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>After xtrabackup is finished preparing the backup you should see the following message:</p> <pre><code>InnoDB: Shutdown completed; log sequence number 5697064\n160401 10:34:28 completed OK!\n</code></pre> <p>Backup is now prepared and can be restored with xtrabackup \u2013copy-back option. In case the keyring has been rotated you\u2019ll need to restore the keyring which was used to take and prepare the backup.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#making-backup-using-keyring_vault-plugin","title":"Making Backup Using <code>keyring_vault</code> Plugin","text":"<p>Support for encrypted InnoDB tablespace backups with <code>keyring_vault</code> has been implemented in Percona XtraBackup 2.4.11.  Keyring vault plugin settings are described here.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#creating-backup_1","title":"Creating Backup","text":"<p>The following command creates a backup in the <code>/data/backup</code> directory:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backup --user=root\n</code></pre> <p>After xtrabackup completes taking the backup you should see the following message:</p> <pre><code>xtrabackup: Transaction log of lsn (5696709) to (5696718) was copied.\n160401 10:25:51 completed OK!\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#preparing-the-backup","title":"Preparing the Backup","text":"<p>In order to prepare the backup xtrabackup will need an access to the keyring. Since xtrabackup doesn\u2019t talk to MySQL server and doesn\u2019t read default <code>my.cnf</code> configuration file during prepare, user will need to specify keyring settings via the command line:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backup \\\n--keyring-vault-config=/etc/vault.cnf\n</code></pre> <p>See also</p> <p>Data at Rest Encryption for Percona Server [keyring vault plugin settings] (https://www.percona.com/doc/percona-server/LATEST/management/data_at_rest_encryption.html#keyring-vault-plugin).</p> <p>After xtrabackup completes preparing the backup you should see the following message:</p> <pre><code>InnoDB: Shutdown completed; log sequence number 5697064\n160401 10:34:28 completed OK!\n</code></pre> <p>The backup is now prepared and can be restored with <code>xtrabackup --copy-back</code> option:</p> <pre><code>$ xtrabackup --copy-back --target-dir=/data/backup --datadir=/data/mysql\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#incremental-encrypted-innodb-tablespace-backups-with-keyring_file","title":"Incremental Encrypted InnoDB Tablespace Backups with <code>keyring_file</code>","text":"<p>The process of taking incremental backups with InnoDB tablespace encryption is similar to taking the Incremental Backups with unencrypted tablespace.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#creating-an-incremental-backup","title":"Creating an Incremental Backup","text":"<p>To make an incremental backup, begin with a full backup. The xtrabackup binary writes a file called <code>xtrabackup_checkpoints</code> into the backup\u2019s target directory. This file contains a line showing the <code>to_lsn</code>, which is the database\u2019s <code>LSN</code> at the end of the backup. First you need to create a full backup with the following command:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/base \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>Warning</p> <p>xtrabackup will not copy keyring file into the backup directory. In order to be prepare the backup, you must make a copy of keyring file yourself. If you try to restore the backup after the keyring has been changed you\u2019ll see errors like <code>ERROR 3185 (HY000): Can't find master key from keyring, please check keyring plugin is loaded.</code> when trying to access encrypted table.</p> <p>If you look at the <code>xtrabackup_checkpoints</code> file, you should see some contents similar to the following:</p> <pre><code>backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 7666625\nlast_lsn = 7666634\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>Now that you have a full backup, you can make an incremental backup based on it. Use a command such as the following:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc1 \\\n--incremental-basedir=/data/backups/base \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>Warning</p> <p>xtrabackup will not copy keyring file into the backup directory. In order to be prepare the backup, you must make a copy of keyring file yourself. If the keyring hasn\u2019t been rotated you can use the same as the one you\u2019ve backed-up with the base backup. If the keyring has been rotated you\u2019ll need to back it up otherwise you won\u2019t be able to prepare the backup.</p> <p>The <code>/data/backups/inc1/</code> directory should now contain delta files, such as <code>ibdata1.delta</code> and <code>test/table1.ibd.delta</code>. These represent the changes since the <code>LSN 7666625</code>. If you examine the <code>xtrabackup_checkpoints</code> file in this directory, you should see something similar to the following:</p> <pre><code>backup_type = incremental\nfrom_lsn = 7666625\nto_lsn = 8873920\nlast_lsn = 8873929\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>The meaning should be self-evident. It\u2019s now possible to use this directory as the base for yet another incremental backup:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc2 \\\n--incremental-basedir=/data/backups/inc1 \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#preparing-the-incremental-backups","title":"Preparing the Incremental Backups","text":"<p>The <code>xtrabackup --prepare</code> step for incremental backups is not the same as for normal backups. In normal backups, two types of operations are performed to make the database consistent: committed transactions are replayed from the log file against the data files, and uncommitted transactions are rolled back. You must skip the rollback of uncommitted transactions when preparing a backup, because transactions that were uncommitted at the time of your backup may be in progress, and it\u2019s likely that they will be committed in the next incremental backup. You should use the <code>xtrabackup --apply-log-only</code> option to prevent the rollback phase.</p> <p>Warning</p> <p>If you do not use the <code>xtrabackup --apply-log-only</code> option to prevent the rollback phase, then your incremental backups will be useless. After transactions have been rolled back, further incremental backups cannot be applied.</p> <p>Beginning with the full backup you created, you can prepare it, and then apply the incremental differences to it. Recall that you have the following backups:</p> <pre><code>/data/backups/base\n/data/backups/inc1\n/data/backups/inc2\n</code></pre> <p>To prepare the base backup, you need to run <code>xtrabackup --prepare</code> as usual, but prevent the rollback phase:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/base \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>The output should end with some text such as the following:</p> <pre><code>InnoDB: Shutdown completed; log sequence number 7666643\nInnoDB: Number of pools: 1\n160401 12:31:11 completed OK!\n</code></pre> <p>To apply the first incremental backup to the full backup, you should use the following command:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/base \\\n--incremental-dir=/data/backups/inc1 \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>Warning</p> <p>Backup should be prepared with the keyring that was used when backup was being taken. This means that if the keyring has been rotated between the base and incremental backup that you\u2019ll need to use the keyring that was in use when the first incremental backup has been taken.</p> <p>Preparing the second incremental backup is a similar process: apply the deltas to the (modified) base backup, and you will roll its data forward in time to the point of the second incremental backup:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backups/base \\\n--incremental-dir=/data/backups/inc2 \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>Note</p> <p>xtrabackup <code>--apply-log-only</code> should be used when merging each incremental backup except the last one. That\u2019s why the previous line doesn\u2019t contain <code>xtrabackup --apply-log-only</code>. Even if the <code>xtrabackup --apply-log-only</code> were used on the last step, backup would still be consistent but in that case server would perform the rollback phase.</p> <p>The backup is now prepared and can be restored with <code>xtrabackup --copy-back</code>. In case the keyring has been rotated you\u2019ll need to restore the keyring which was used to take and prepare the backup.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#restoring-backup-when-keyring-is-not-available","title":"Restoring backup when keyring is not available","text":"<p>While described restore method works, it requires an access to the same keyring which server is using. It may not be possible if backup is prepared on different server or at the much later time, when keys in the keyring have been purged, or in case of malfunction when keyring vault server is not available at all.</p> <p>A <code>xtrabackup --transition-key</code> should be used to make it possible for xtrabackup to process the backup without access to the keyring vault server. In this case xtrabackup will derive AES encryption key from specified passphrase and will use it to encrypt tablespace keys of tablespaces being backed up.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#creating-the-backup-with-a-passphrase","title":"Creating the Backup with a Passphrase","text":"<p>The following example illustrates how a backup can be created in this case:</p> <pre><code>$ xtrabackup --backup --user=root -p --target-dir=/data/backup \\\n--transition-key=MySecretKey\n</code></pre> <p>If <code>xtrabackup --transition-key</code> is specified without a value, xtrabackup will ask for it.</p> <p>Note</p> <p><code>xtrabackup --transition-key</code> scrapes the supplied value so that it does not appear in the <code>ps</code> command output.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#preparing-the-backup-with-a-passphrase","title":"Preparing the Backup with a Passphrase","text":"<p>The same passphrase should be specified for the <code>prepare</code> command:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backup \\\n--transition-key=MySecretKey\n</code></pre> <p>There is no <code>keyring-vault</code> or <code>keyring-file</code> here, because xtrabackup does not talk to the keyring in this case.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#restoring-the-backup-with-a-generated-key","title":"Restoring the Backup with a Generated Key","text":"<p>When restoring a backup you will need to generate new master key. Here is the example for <code>keyring_file</code>:</p> <pre><code>$ xtrabackup --copy-back --target-dir=/data/backup --datadir=/data/mysql \\\n--transition-key=MySecetKey --generate-new-master-key \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>In case of <code>keyring_vault</code> it will look like this:</p> <pre><code>$ xtrabackup --copy-back --target-dir=/data/backup --datadir=/data/mysql \\\n--transition-key=MySecetKey --generate-new-master-key \\\n--keyring-vault-config=/etc/vault.cnf\n</code></pre> <p>xtrabackup will generate new master key, store it into target keyring vault server and re-encrypt tablespace keys using this key.</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#making-the-backup-with-a-stored-transition-key","title":"Making the Backup with a Stored Transition Key","text":"<p>Finally, there is an option to store transition key in the keyring. In this case xtrabackup will need access to the same keyring file or vault server during prepare and copy-back, but does not depend on whether the server keys have been purged.</p> <p>The three stages of the backup process are the following:</p>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#backup","title":"Backup","text":"<pre><code>$ xtrabackup --backup --user=root -p --target-dir=/data/backup \\\n--generate-transition-key\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#prepare","title":"Prepare","text":""},{"location":"advanced/encrypted_innodb_tablespace_backups.html#keyring_file-variant","title":"<code>keyring_file</code> variant","text":"<pre><code>$ xtrabackup --prepare --target-dir=/data/backup \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#keyring_vault-variant","title":"<code>keyring_vault</code> variant","text":"<pre><code>$ xtrabackup --prepare --target-dir=/data/backup \\\n--keyring-vault-config=/etc/vault.cnf\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#copy-back","title":"Copy-back","text":""},{"location":"advanced/encrypted_innodb_tablespace_backups.html#keyring_file-variant_1","title":"<code>keyring_file</code> variant","text":"<pre><code>$ xtrabackup --copy-back --target-dir=/data/backup --datadir=/data/mysql \\\n--generate-new-master-key --keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre>"},{"location":"advanced/encrypted_innodb_tablespace_backups.html#keyring_vault-variant_1","title":"<code>keyring_vault</code> variant","text":"<pre><code>$ xtrabackup --copy-back --target-dir=/data/backup --datadir=/data/mysql \\\n--generate-new-master-key --keyring-vault-config=/etc/vault.cnf\n</code></pre>"},{"location":"advanced/lockless_bin-log.html","title":"Lockless binary log information","text":"<p>This feature is exclusive to Percona Server for MySQL starting with version 5.6.26-74.0. It is also used in Percona XtraDB Cluster when the node is being backed up without <code>xtrabackup --galera-info</code>.</p> <p>When the Lockless binary log information feature is available on the server, Percona XtraBackup can trust binary log information stored in the InnoDB system header and avoid executing <code>LOCK BINLOG FOR BACKUP</code> (and thus, blocking commits for the duration of finalizing the <code>REDO</code> log copy) under a number of circumstances:</p> <ul> <li> <p>when the server is not a GTID-enabled Galera cluster node</p> </li> <li> <p>when the replication I/O thread information should not be stored as a part of the backup (i.e. when the <code>xtrabackup --slave-info</code> option is not specified)</p> </li> </ul> <p>If all of the above conditions hold, Percona XtraBackup does not execute the <code>SHOW MASTER STATUS</code> as a part of the backup procedure, does not create the <code>xtrabackup_binlog_info</code> file on backup. Instead, that information is retrieved and the file is created after preparing the backup, along with creating <code>xtrabackup_binlog_pos_innodb</code>, which in this case contains exactly the same information as in <code>xtrabackup_binlog_info</code> and is thus redundant.</p> <p>To make this new functionality configurable, there is now a new Percona XtraBackup option, <code>xtrabackup --binlog-info</code>, which can accept the following values:</p> <ul> <li> <p><code>OFF</code> - This means that Percona XtraBackup will not attempt to retrieve the binary log information at all, neither during the backup creation, nor after preparing it. This can help when a user just wants to copy data without any meta information like binary log or replication coordinates. In this case, <code>xtrabackup --binlog-info=OFF</code> can be passed to Percona XtraBackup and <code>LOCK BINLOG FOR BACKUP</code> will not be executed, even if the backup-safe binlog info feature is not provided by the server (but the backup locks feature is still a requirement).</p> </li> <li> <p><code>ON</code> - This matches the old behavior, i.e. the one before this Percona XtraBackup feature had been implemented. When specified, Percona XtraBackup retrieves the binary log information and uses <code>LOCK BINLOG FOR BACKUP</code> (if available) to ensure its consistency.</p> </li> <li> <p><code>LOCKLESS</code> - This corresponds to the functionality explained above: Percona XtraBackup will not retrieve binary log information during the backup process, will not execute <code>LOCK BINLOG FOR BACKUP</code>, and the <code>xtrabackup_binlog_info</code> file will not be created. The file will be created after preparing the backup using the information stored in the InnoDB system header. If the required server-side functionality is not provided by the server, specifying this <code>xtrabackup --binlog-info</code> value will result in an error. If one of the above mentioned conditions does not hold, <code>LOCK BINLOG FOR BACKUP</code> will still be executed to ensure consistency of other meta data.</p> </li> <li> <p><code>AUTO</code> - This is the default value. When used, Percona XtraBackup will automatically switch to either <code>ON</code> or <code>LOCKLESS</code>, depending on the server-side feature availability, i.e., whether the <code>have_backup_safe_binlog_info</code> server variable is available.</p> </li> </ul>"},{"location":"advanced/locks.html","title":"<code>lock-ddl-per-table</code> Option Improvements","text":"<p>MySQL 5.7 has made improvements to bulk loading, one of these improvements is the ability to disable redo logging, which increased the speed of ADD INDEX operations.</p> <p>To block DDL statements on an instance, Percona Server implemented LOCK TABLES FOR BACKUP. Percona XtraBackup uses this lock for the duration of the backup. This lock does not affect DML statements.</p> <p>Percona XtraBackup has also implemented <code>--lock-ddl-per-table</code>, which blocks DDL statements by using metadata locks (MDL).</p> <p>The following procedures describe a simplified backup operation when using <code>--lock-ddl-per-table</code>:</p> <ol> <li> <p>Parse and copy all redo logs after the checkpoint mark</p> </li> <li> <p>Fork a dedicated thread to continue following new redo log entries</p> </li> <li> <p>List the tablespaces required to copy</p> </li> <li> <p>Iterate through the list. The following steps occur with each listed tablespace:</p> <ul> <li> <p>Query INFORMATION_SCHEMA.INNODB_SYS_TABLES to find which tables belong to the tablespace ID and take a MDL on the underlying table or tables in case there is a shared tablespace.</p> </li> <li> <p>Copy the tablespace <code>.ibd</code> files.</p> </li> </ul> </li> </ol> <p>The backup process may encounter a redo log event, generated by the bulk load operations, which notifies backup tools that data file changes have been omitted from the redo log. This event is an <code>MLOG_INDEX_LOAD</code>. If this event is found by the redo follow thread, the backup continues and assumes the backup is safe because the MDL protects tablespaces already copied and the <code>MLOG_INDEX_LOAD</code> event is for a tablespace that is not copied.</p> <p>These assumptions may not be correct and may lead to inconsistent backups.</p>"},{"location":"advanced/locks.html#-lock-ddl-per-table-redesign","title":"<code>--lock-ddl-per-table</code> redesign","text":"<p>Implemented in Percona XtraBackup version 2.4.21, the <code>--lock-ddl-per-table</code> has been redesigned to minimize inconsistent backups. The following procedure reorders the steps:</p> <ul> <li> <p>Acquire the MDL lock at the beginning of the backup</p> </li> <li> <p>Scan the redo logs. An <code>MLOG_INDEX_LOAD</code> event may be recorded if a <code>CREATE INDEX</code> statement has occurred before the backup starts. At this time, the backup process is safe and can parse and accept the event.</p> </li> <li> <p>After the first scan has completed, the follow redo log thread is initiated This thread stops the backup process if an <code>MLOG_INDEX_LOAD</code> event is found.</p> </li> <li> <p>Gather the tablespace list to copy</p> </li> <li> <p>Copy the <code>.ibd</code> files.</p> </li> </ul>"},{"location":"advanced/locks.html#other-improvements","title":"Other Improvements","text":"<p>The following improvements have been added:</p> <ul> <li> <p>If the <code>.ibd</code> file belongs to a temporary table, the <code>SELECT</code> query is skipped.</p> </li> <li> <p>For a FullText Index, an MDL is acquired on the base table.</p> </li> <li> <p>A <code>SELECT</code> query that acquires an MDL retrieves no data.</p> </li> </ul>"},{"location":"advanced/throttling_backups.html","title":"Throttling Backups","text":"<p>Although xtrabackup does not block your database\u2019s operation, any backup can add load to the system being backed up. On systems that do not have much spare I/O capacity, it might be helpful to throttle the rate at which xtrabackup reads and writes data. You can do this with the <code>xtrabackup --throttle</code> option. This option limits the number of chunks copied per second. The chunk size is 10 MB.</p> <p>The image below shows how throttling works when <code>xtrabackup --throttle</code> is set to 1.</p> <p></p> <p>By default, there is no throttling, and xtrabackup reads and writes data as quickly as possible. If you set too strict of a limit on the IOPS, the backup may slow down so much that it will never catch up with the transaction logs that InnoDB is writing, and the backup might never be complete.</p>"},{"location":"backup_scenarios/compressed_backup.html","title":"Compressed Backup","text":"<p>Percona XtraBackup supports compressed backups: a local or streaming backup can be compressed or decompressed with xbstream.</p>"},{"location":"backup_scenarios/compressed_backup.html#creating-compressed-backups","title":"Creating Compressed Backups","text":"<p>In order to make a compressed backup you\u2019ll need to use the xtrabackup \u2013compress option:</p> <pre><code>$ xtrabackup --backup --compress --target-dir=/data/compressed/\n</code></pre> <p>The <code>xtrabackup --compress</code> uses the <code>qpress</code> tool that you can install via the <code>percona-release</code> package configuration tool as follows:</p> <pre><code>$ sudo percona-release enable tools\n$ sudo apt update\n$ sudo apt install qpress\n</code></pre> <p>Note</p> <p>Enable the repository: <code>percona-release enable-only tools release</code>. If you intend to use Percona XtraBackup in combination with the upstream MySQL Server, you only need to enable the <code>tools</code> repository: <code>percona-release enable-only tools</code>.</p> <p>If you want to speed up the compression you can use the parallel compression, which can be enabled with xtrabackup \u2013compress-threads option. Following example will use four threads for compression:</p> <pre><code>$ xtrabackup --backup --compress --compress-threads=4 \\\n--target-dir=/data/compressed/\n</code></pre> <p>Output should look like this</p> <pre><code>...\n170223 13:00:38 [01] Compressing ./test/sbtest1.frm to /tmp/compressed/test/sbtest1.frm.qp\n170223 13:00:38 [01]        ...done\n170223 13:00:38 [01] Compressing ./test/sbtest2.frm to /tmp/compressed/test/sbtest2.frm.qp\n170223 13:00:38 [01]        ...done\n...\n170223 13:00:39 [00] Compressing xtrabackup_info\n170223 13:00:39 [00]        ...done\nxtrabackup: Transaction log of lsn (9291934) to (9291934) was copied.\n170223 13:00:39 completed OK!\n</code></pre>"},{"location":"backup_scenarios/compressed_backup.html#preparing-the-backup","title":"Preparing the backup","text":"<p>Before you can prepare the backup you must uncompress all the files. Percona XtraBackup has implemented <code>xtrabackup --decompress</code> option that can be used to decompress the backup.</p> <pre><code>$ xtrabackup --decompress --target-dir=/data/compressed/\n</code></pre> <p>Note</p> <p><code>xtrabackup --parallel</code> can be used with <code>xtrabackup --decompress</code> option to decompress multiple files simultaneously.</p> <p>Percona XtraBackup does not automatically remove the compressed files. In order to clean up the backup directory, use the <code>xtrabackup --remove-original</code> option. If the files not removed they are not copied or moved to the datadir if <code>xtrabackup --copy-back</code> or <code>xtrabackup --move-back</code> are used.</p> <p>When the files are uncompressed you can prepare the backup with the <code>xtrabackup --prepare</code> option:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/compressed/\n</code></pre> <p>Check for a confirmation message:</p> <pre><code>InnoDB: Starting shutdown...\nInnoDB: Shutdown completed; log sequence number 9293846\n170223 13:39:31 completed OK!\n</code></pre> <p>Now the files in <code>/data/compressed/</code> are ready to be used by the server.</p>"},{"location":"backup_scenarios/compressed_backup.html#restoring-the-backup","title":"Restoring the backup","text":"<p>xtrabackup has a <code>xtrabackup --copy-back</code> option, which performs the restoration of a backup to the server\u2019s datadir:</p> <pre><code>$ xtrabackup --copy-back --target-dir=/data/backups/\n</code></pre> <p>The option copies all the data-related files back to the server\u2019s <code>datadir</code>, determined by the server\u2019s <code>my.cnf</code> configuration file. Check the last line of the output for a success message:</p> <pre><code>170223 13:49:13 completed OK!\n</code></pre> <p>Verify the file permissions after copying the data back. You may need to adjust the permissions. For example, the following command changes the owner of the file location:</p> <pre><code>$ chown -R mysql:mysql /var/lib/mysql\n</code></pre> <p>Now that the <code>datadir</code> contains the restored data. You are ready to start the server.</p>"},{"location":"backup_scenarios/encrypted_backup.html","title":"Encrypted Backup","text":"<p>Percona XtraBackup has implemented support for encrypted backups. It can be used to encrypt/decrypt local or streaming backup with xbstream option (streaming tar backups are not supported) in order to add another layer of protection to the backups. Encryption is done with the <code>libgcrypt</code> library.</p>"},{"location":"backup_scenarios/encrypted_backup.html#creating-encrypted-backups","title":"Creating Encrypted Backups","text":"<p>To make an encrypted backup following options need to be specified (options <code>xtrabackup --encrypt-key</code> and <code>xtrabackup --encrypt-key-file</code> are mutually exclusive, i.e., just one of them needs to be provided):</p> <ul> <li> <p><code>--encrypt=ALGORITHM</code> - currently supported algorithms are: <code>AES128</code>, <code>AES192</code> and <code>AES256</code></p> </li> <li> <p><code>--encrypt-key=ENCRYPTION_KEY</code> - proper length encryption key to use. It is not recommended to use this option where there is uncontrolled access to the machine as the command line and thus the key can be viewed as part of the process info.</p> </li> <li> <p><code>--encrypt-key-file=KEYFILE</code> - the name of a file where the raw key of the appropriate length can be read from. The file must be a simple binary (or text) file that contains exactly the key to be used.</p> </li> </ul> <p>Both <code>xtrabackup --encrypt-key</code> option  and <code>xtrabackup --encrypt-key-file</code> option can be used to specify the encryption key. Encryption key can be generated with command like:</p> <pre><code>$ openssl rand -base64 24\n</code></pre> <p>Example output of that command should look like this:</p> <pre><code>GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\n</code></pre> <p>This value then can be used as the encryption key</p>"},{"location":"backup_scenarios/encrypted_backup.html#using-the-encrypt-key-option","title":"Using the <code>--encrypt-key</code> option","text":"<p>Example of the xtrabackup command using the <code>xtrabackup --encrypt-key</code> should look like this:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups --encrypt=AES256 \\\n--encrypt-key=\"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\"\n</code></pre>"},{"location":"backup_scenarios/encrypted_backup.html#using-the-encrypt-key-file-option","title":"Using the <code>--encrypt-key-file</code> option","text":"<p>Example of the xtrabackup command using the <code>xtrabackup --encrypt-key-file</code> should look like this:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/ --encrypt=AES256 \\\n--encrypt-key-file=/data/backups/keyfile\n</code></pre> <p>Note</p> <p>Depending on the text editor used for making the <code>KEYFILE</code>, text file in some cases can contain the CRLF and this will cause the key size to grow and thus making it invalid. Suggested way to do this would be to create the file with: <code>echo -n \"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\" &gt; /data/backups/keyfile</code></p>"},{"location":"backup_scenarios/encrypted_backup.html#optimizing-the-encryption-process","title":"Optimizing the encryption process","text":"<p>Two options have been introduced with the encrypted backups that can be used to speed up the encryption process. These are <code>xtrabackup --encrypt-threads</code> and <code>xtrabackup --encrypt-chunk-size</code>. By using the <code>xtrabackup --encrypt-threads</code> option multiple threads can be specified to be used for encryption in parallel. Option <code>xtrabackup --encrypt-chunk-size</code> can be used to specify the size (in bytes) of the working encryption buffer for each encryption thread (default is 64K).</p>"},{"location":"backup_scenarios/encrypted_backup.html#decrypting-encrypted-backups","title":"Decrypting Encrypted Backups","text":"<p>Percona XtraBackup <code>xtrabackup --decrypt</code> option has been implemented that can be used to decrypt the backups:</p> <pre><code>$ xtrabackup --decrypt=AES256 --encrypt-key=\"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\"\\\n--target-dir=/data/backups/\n</code></pre> <p>Percona XtraBackup doesn\u2019t automatically remove the encrypted files. In order to clean up the backup directory users should remove the *.xbcrypt files. In Percona XtraBackup 2.4.6 <code>xtrabackup --remove-original</code> option has been implemented that you can use to remove the encrypted files once they\u2019ve been decrypted. To remove the files once they\u2019re decrypted you should run:</p> <pre><code>$ xtrabackup --decrypt=AES256 --encrypt-key=\"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\"\\\n--target-dir=/data/backups/ --remove-original\n</code></pre> <p>Note</p> <p><code>xtrabackup --parallel</code> can be used with <code>xtrabackup --decrypt</code> option to decrypt multiple files simultaneously.</p> <p>When the files have been decrypted backup can be prepared.</p>"},{"location":"backup_scenarios/encrypted_backup.html#preparing-encrypted-backups","title":"Preparing Encrypted Backups","text":"<p>After the backups have been decrypted, they can be prepared the same way as the standard full backups with the <code>xtrabackup --prepare</code> option:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backups/\n</code></pre>"},{"location":"backup_scenarios/encrypted_backup.html#restoring-encrypted-backups","title":"Restoring Encrypted Backups","text":"<p>xtrabackup has a <code>xtrabackup --copy-back</code> option, which performs the restoration of a backup to the server\u2019s datadir:</p> <pre><code>$ xtrabackup --copy-back --target-dir=/data/backups/\n</code></pre> <p>It will copy all the data-related files back to the server\u2019s <code>datadir</code>, determined by the server\u2019s <code>my.cnf</code> configuration file. You should check the last line of the output for a success message:</p> <pre><code>170214 12:37:01 completed OK!\n</code></pre>"},{"location":"backup_scenarios/encrypted_backup.html#other-reading","title":"Other Reading","text":"<ul> <li>The Libgcrypt Reference Manual</li> </ul>"},{"location":"backup_scenarios/full_backup.html","title":"The Backup Cycle - Full Backups","text":""},{"location":"backup_scenarios/full_backup.html#creating-a-backup","title":"Creating a backup","text":"<p>To create a backup, run <code>xtrabackup</code> with the <code>xtrabackup --backup option</code>. You also need to specify a <code>xtrabackup --target-dir</code> option, which is where the backup will be stored, if the InnoDB data or log files aren\u2019t stored in the same directory, you might need to specify the location of those, too. If the target directory does not exist, xtrabackup creates it. If the directory does exist and is empty, xtrabackup will succeed. xtrabackup will not overwrite existing files, it will fail with operating system error 17, <code>file exists</code>.</p> <p>To start the backup process run:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/\n</code></pre> <p>This will store the backup at <code>/data/backups/</code>. If you specify a relative path, the target directory will be relative to the current directory.</p> <p>During the backup process, you should see a lot of output showing the data files being copied, as well as the log file thread repeatedly scanning the log files and copying from it. Here is an example that shows the log thread scanning the log in the background, and a file copying thread working on the ibdata1 file:</p> <pre><code>160906 10:19:17 Finished backing up non-InnoDB tables and files\n160906 10:19:17 Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...\nxtrabackup: The latest check point (for incremental): '62988944'\nxtrabackup: Stopping log copying thread.\n.160906 10:19:18 &gt;&gt; log scanned up to (137343534)\n160906 10:19:18 Executing UNLOCK TABLES\n160906 10:19:18 All tables unlocked\n160906 10:19:18 Backup created in directory '/data/backups/'\n160906 10:19:18 [00] Writing backup-my.cnf\n160906 10:19:18 [00]        ...done\n160906 10:19:18 [00] Writing xtrabackup_info\n160906 10:19:18 [00]        ...done\nxtrabackup: Transaction log of lsn (26970807) to (137343534) was copied.\n160906 10:19:18 completed OK!\n</code></pre> <p>The last thing you should see is something like the following, where the value of the <code>&lt;LSN&gt;</code> will be a number that depends on your system:</p> <pre><code>xtrabackup: Transaction log of lsn (&lt;SLN&gt;) to (&lt;LSN&gt;) was copied.\n</code></pre> <p>Note</p> <p>Log copying thread checks the transactional log every second to see if there were any new log records written that need to be copied, but there is a chance that the log copying thread might not be able to keep up with the amount of writes that go to the transactional logs, and will hit an error when the log records are overwritten before they could be read.</p> <p>After the backup is finished, the target directory will contain files such as the following, assuming you have a single InnoDB table <code>test.tbl1</code> and you are using MySQL\u2019s <code>innodb_file_per_table</code> option:</p> <p><pre><code>$ ls -lh /data/backups/\n</code></pre> The results are as follows: <pre><code>total 182M\ndrwx------  7 root root 4.0K Sep  6 10:19 .\ndrwxrwxrwt 11 root root 4.0K Sep  6 11:05 ..\n-rw-r-----  1 root root  387 Sep  6 10:19 backup-my.cnf\n-rw-r-----  1 root root  76M Sep  6 10:19 ibdata1\ndrwx------  2 root root 4.0K Sep  6 10:19 mysql\ndrwx------  2 root root 4.0K Sep  6 10:19 performance_schema\ndrwx------  2 root root 4.0K Sep  6 10:19 sbtest\ndrwx------  2 root root 4.0K Sep  6 10:19 test\ndrwx------  2 root root 4.0K Sep  6 10:19 world2\n-rw-r-----  1 root root  116 Sep  6 10:19 xtrabackup_checkpoints\n-rw-r-----  1 root root  433 Sep  6 10:19 xtrabackup_info\n-rw-r-----  1 root root 106M Sep  6 10:19 xtrabackup_logfile\n</code></pre></p> <p>The backup can take a long time, depending on how large the database is. It is safe to cancel at any time, because it does not modify the database.</p> <p>The next step is getting your backup ready to be restored.</p>"},{"location":"backup_scenarios/full_backup.html#preparing-a-backup","title":"Preparing a backup","text":"<p>After you made a backup with the <code>xtrabackup --backup</code> option, you\u2019ll first need to prepare it in order to restore it. Data files are not point-in-time consistent until they\u2019ve been prepared, because they were copied at different times as the program ran, and they might have been changed while this was happening. If you try to start InnoDB with these data files, it will detect corruption and crash itself to prevent you from running on damaged data. The <code>xtrabackup --prepare</code> step makes the files perfectly consistent at a single instant in time, so you can run InnoDB on them.</p> <p>You can run the prepare operation on any machine; it does not need to be on the originating server or the server to which you intend to restore. You can copy the backup to a utility server and prepare it there.</p> <p>Note</p> <p>You can prepare a backup created with older Percona XtraBackup version with a newer one, but not vice versa. Preparing a backup on an unsupported server version should be done with the latest Percona XtraBackup release which supports that server version. For example, if one has a backup of MySQL 5.0 created with Percona XtraBackup 1.6, then preparing the backup with Percona XtraBackup 2.3 is not supported, because support for MySQL 5.0 was removed in Percona XtraBackup 2.1. Instead, the latest release in the 2.0 series should be used.</p> <p>During the <code>prepare</code> operation, xtrabackup boots up a kind of modified InnoDB that\u2019s embedded inside it (the libraries it was linked against). The modifications are necessary to disable InnoDB\u2019s standard safety checks, such as complaining that the log file isn\u2019t the right size, which aren\u2019t appropriate for working with backups. These modifications are only for the xtrabackup binary; you don\u2019t need a modified InnoDB to use xtrabackup for your backups.</p> <p>The prepare step uses this embedded InnoDB to perform crash recovery on the copied data files, using the copied log file. The <code>prepare</code> step is very simple to use: you simply run <code>xtrabackup --prepare</code> option and tell it which directory to prepare, for example, to prepare the previously taken backup run:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backups/\n</code></pre> <p>When this finishes, you should see an <code>InnoDB shutdown</code> with a message such as the following, where again the value of <code>LSN</code> will depend on your system:</p> <pre><code>InnoDB: Shutdown completed; log sequence number 137345046\n160906 11:21:01 completed OK!\n</code></pre> <p>All following prepares will not change the already prepared data files, you\u2019ll see that output says:</p> <pre><code>xtrabackup: This target seems to be already prepared.\nxtrabackup: notice: xtrabackup_logfile was already used to '--prepare'.\n</code></pre> <p>It is not recommended to interrupt xtrabackup process while preparing backup because it may cause data files corruption and backup will become unusable. Backup validity is not guaranteed if prepare process was interrupted.</p> <p>Note</p> <p>If you intend the backup to be the basis for further incremental backups, you should use the <code>xtrabackup --apply-log-only</code> option when preparing the backup, or you will not be able to apply incremental backups to it. See the documentation on preparing [incremental backup] (incremental_backup.md#incremental-backup) for more details.</p>"},{"location":"backup_scenarios/full_backup.html#restoring-a-backup","title":"Restoring a Backup","text":"<p>Warning</p> <p>Backup needs to be prepared before it can be restored.</p> <pre><code>$ xtrabackup --copy-back --target-dir=/data/backups/\n</code></pre> <p>If you don\u2019t want to save your backup, you can use the <code>xtrabackup --move-back</code> option which will move the backed up data to the <code>datadir</code>.</p> <p>If you don\u2019t want to use any of the above options, you can additionally use <code>rsync</code> or <code>cp</code> to restore the files.</p> <p>Note</p> <p>The <code>datadir</code> must be empty before restoring the backup. Also it\u2019s important to note that MySQL server needs to be shut down before restore is performed. You can\u2019t restore to a <code>datadir</code> of a running mysqld instance (except when importing a partial backup).</p> <p>Example of the <code>rsync</code> command that can be used to restore the backup can look like this:</p> <pre><code>$ rsync -avrP /data/backup/ /var/lib/mysql/\n</code></pre> <p>You should check that the restored files have the correct ownership and permissions.</p> <p>As files\u2019 attributes will be preserved, in most cases you will need to change the files\u2019 ownership to <code>mysql</code> before starting the database server, as they will be owned by the user who created the backup:</p> <pre><code>$ chown -R mysql:mysql /var/lib/mysql\n</code></pre> <p>Data is now restored and you can start the server.</p> <p>Note</p> <p>When <code>relay-log-info-repository=TABLE</code> is enabled, the instance recovered from the backup has errors in the error log, like the following:</p> <pre><code>2019-08-09 12:40:02 69297 [ERROR] Failed to open the relay log '/data/mysql-relay-bin.004349' (relay_log_pos 5534092)\n</code></pre> <p>To avoid these types of issues, enable <code>relay_log_recovery</code> or execute <code>RESET SLAVE</code> prior to <code>CHANGE MASTER TO</code>.</p> <p>The relay log information was backed up, but a new relay log has been created, which creates a mismatch during the restore.</p>"},{"location":"backup_scenarios/incremental_backup.html","title":"Incremental Backup","text":"<p>Both the xtrabackup tool and the innobackupex tool support incremental backups. An incremental backup backs up only data that has changed since the last backup.</p> <p>You can take multiple incremental backups between each full backup. For example, you can take a full backup once a week and an incremental backup every day, or a full backup every day and incremental backups each hour.</p> <p>Incremental backups work because each InnoDB page contains a log sequence number (LSN). The <code>LSN</code> is the system version number for the entire database. Each page\u2019s <code>LSN</code> shows how recently it was changed.</p> <p>An incremental backup copies each page whose <code>LSN</code> is newer than the previous incremental or full backup\u2019s <code>LSN</code>. There are two algorithms in use to find the set of such pages to be copied. The first one, available with all the server types and versions, checks the page <code>LSN</code> directly by reading all the data pages. The second one, available with Percona Server for MySQL, enables the changed page tracking feature on the server, which will note the pages as they are being changed. This information will be then written out in a compact separate so-called bitmap file. The xtrabackup binary uses that file to read only the data pages it needs for the incremental backup. This features potentially saves many read requests. The latter algorithm is enabled by default if the xtrabackup binary finds the bitmap file. It is possible to specify <code>xtrabackup --incremental-force-scan</code> to read all the pages even if the bitmap data is available.</p> <p>Important</p> <p>Incremental backups do not compare the data files to the previous backup\u2019s data files. For this reason, running an incremental backup after a partial backup may lead to inconsistent data.</p> <p>Incremental backups read the pages and compare their <code>LSN</code> to the last backup\u2019s <code>LSN</code>. You must have a full backup to recover the incremental changes. Without a full backup to act as a base, the incremental backups are useless.</p> <p>You can use the <code>--incremental-lsn</code> option to perform an incremental backup without even having the previous backup, if you know its <code>LSN</code>.</p> <p>See also: Partial Backups</p>"},{"location":"backup_scenarios/incremental_backup.html#creating-an-incremental-backup","title":"Creating an Incremental Backup","text":"<p>To make an incremental backup, begin with a full backup as usual. The xtrabackup binary writes a file called <code>xtrabackup_checkpoints</code> into the backup\u2019s target directory. This file contains a line showing the <code>to_lsn</code>, which is the database\u2019s <code>LSN</code> at the end of the backup. Create the full backup with a following command:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/base\n</code></pre> <p>If you look at the xtrabackup_checkpoints file, you should see similar content depending on your LSN nuber:</p> <pre><code>backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 1626007\nlast_lsn = 1626007\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>Now that you have a full backup, you can make an incremental backup based on it. Use the following command:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc1 \\\n--incremental-basedir=/data/backups/base\n</code></pre> <p>The /data/backups/inc1/ directory should now contain delta files, such as ibdata1.delta and test/table1.ibd.delta. These represent the changes since the <code>LSN 1626007</code>. If you examine the <code>xtrabackup_checkpoints</code> file in this directory, you should see similar content to the following:</p> <pre><code>backup_type = incremental\nfrom_lsn = 1626007\nto_lsn = 4124244\nlast_lsn = 4124244\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p><code>from_lsn</code> is the starting LSN of the backup and for incremental it has to be the same as <code>to_lsn</code> (if it is the last checkpoint) of the previous/base backup.</p> <p>It\u2019s now possible to use this directory as the base for yet another incremental backup:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc2 \\\n--incremental-basedir=/data/backups/inc1\n</code></pre> <p>This folder also contains the <code>xtrabackup_checkpoints</code>:</p> <pre><code>backup_type = incremental\nfrom_lsn = 4124244\nto_lsn = 6938371\nlast_lsn = 7110572\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>Note</p> <p>In this case you can see that there is a difference between the <code>to_lsn</code> (last checkpoint LSN) and <code>last_lsn</code> (last copied LSN), this means that there was some traffic on the server during the backup process.</p>"},{"location":"backup_scenarios/incremental_backup.html#preparing-the-incremental-backups","title":"Preparing the Incremental Backups","text":"<p>The <code>xtrabackup --prepare</code> step for incremental backups is not the same as for full backups. In full backups, two types of operations are performed to make the database consistent: committed transactions are replayed from the log file against the data files, and uncommitted transactions are rolled back. You must skip the rollback of uncommitted transactions when preparing an incremental backup, because transactions that were uncommitted at the time of your backup may be in progress, and it\u2019s likely that they will be committed in the next incremental backup. You should use the xtrabackup <code>--apply-log-only</code> option to prevent the rollback phase.</p> <p>Note</p> <p>If you do not use the <code>xtrabackup --apply-log-only</code> option to prevent the rollback phase, then your incremental backup is useless.After the transactions have been rolled back, further incremental backups cannot be applied.</p> <p>Beginning with the full backup you created, you can prepare it, and then apply the incremental differences to it. Recall that you have the following backups:</p> <pre><code>/data/backups/base\n/data/backups/inc1\n/data/backups/inc2\n</code></pre> <p>To prepare the base backup, you need to run xtrabackup \u2013prepare as usual, but prevent the rollback phase:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/base\n</code></pre> <p>The output should end with text similar to the following:</p> <pre><code>InnoDB: Shutdown completed; log sequence number 1626007\n161011 12:41:04 completed OK!\n</code></pre> <p>The log sequence number should match the <code>to_lsn</code> of the base backup, which you saw previously.</p> <p>Note</p> <p>This backup is safe to restore, even though the operation skipped the rollback phase. If you restore it and start MySQL, InnoDB detects that the rollback phase was not performed, and it will do that in the background. This operation is the same as a crash recovery upon start. In addition, MySQL notifies you that the database was not shut down normally.</p> <p>To apply the first incremental backup to the full backup, run the following command:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/base \\\n--incremental-dir=/data/backups/inc1\n</code></pre> <p>This applies the delta files to the files in <code>/data/backups/base</code>, which rolls them forward in time to the time of the incremental backup. It then applies the redo log as usual to the result. The final data is in <code>/data/backups/base</code>, not in the incremental directory. You should see an output similar to:</p> <pre><code>incremental backup from 1626007 is enabled.\nxtrabackup: cd to /data/backups/base\nxtrabackup: This target seems to be already prepared with --apply-log-only.\nxtrabackup: xtrabackup_logfile detected: size=2097152, start_lsn=(4124244)\n...\nxtrabackup: page size for /tmp/backups/inc1/ibdata1.delta is 16384 bytes\nApplying /tmp/backups/inc1/ibdata1.delta to ./ibdata1...\n...\n161011 12:45:56 completed OK!\n</code></pre> <p>Again, the LSN should match what you saw from your earlier inspection of the first incremental backup. If you restore the files from <code>/data/backups/base</code>, you should see the state of the database as of the first incremental backup.</p> <p>Warning</p> <p>Percona XtraBackup does not support using the same incremental backup directory to prepare two copies of backup. Do not run <code>xtrabackup --prepare</code> with the same incremental backup directory (the value of <code>--incremental-dir</code>) more than once.</p> <p>Preparing the second incremental backup is a similar process: apply the deltas to the (modified) base backup, and you will roll its data forward in time to the point of the second incremental backup:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backups/base \\\n--incremental-dir=/data/backups/inc2\n</code></pre> <p>Note</p> <p><code>xtrabackup --apply-log-only</code> should be used when merging all incrementals except the last one. That\u2019s why the previous line doesn\u2019t contain the xtrabackup <code>--apply-log-only</code> option. Even if the <code>xtrabackup --apply-log-only</code> was used on the last step, backup would still be consistent but in that case server would perform the rollback phase.</p> <p>Once prepared, incremental backups are the same as the full backups and they can be restored in the same way.</p>"},{"location":"howtos/backup_verification.html","title":"Verifying Backups with replication and pt-checksum","text":"<p>One way to verify if the backup is consistent is by setting up the replication and running pt-table-checksum. This can be used to verify any type of backups, but before setting up replication, backup should be prepared and be able to run (this means that incremental backups should be merged to full backups, encrypted backups decrypted etc.).</p>"},{"location":"howtos/backup_verification.html#setting-up-the-replication","title":"Setting up the replication","text":"<p>How to setup a replica for replication in 6 simple steps with Percona XtraBackup guide provides a detailed instructions on how to take the backup and set up the replication.</p> <p>For checking the backup consistency you can use either the original server where the backup was taken, or another test server created by using a different backup method (such as cold backup, mysqldump or LVM snapshots) as the source server in the replication setup.</p>"},{"location":"howtos/backup_verification.html#using-pt-table-checksum","title":"Using pt-table-checksum","text":"<p>This tool is part of the Percona Toolkit. It performs an online replication consistency check by executing checksum queries on the source, which produces different results on replicas that are inconsistent with the source.</p> <p>After you confirmed that replication has been set up successfully, you can install or download pt-table-checksum. This example shows downloading the latest version of pt-table-checksum:</p> <pre><code>$ wget percona.com/get/pt-table-checksum\n</code></pre> <p>Note</p> <p>In order for pt-table-checksum to work correctly <code>libdbd-mysql-perl</code> will need to be installed on Debian/Ubuntu systems or <code>perl-DBD-MySQL</code> on RHEL/CentOS. If you installed the percona-toolkit package from the Percona repositories package manager should install those libraries automatically.</p> <p>After this command has been run, pt-table-checksum will be downloaded to your current working directory.</p> <p>Running the pt-table-checksum on the source will create <code>percona</code> database with the <code>checksums</code> table which will be replicated to the replicas as well. Example of the pt-table-checksum will look like this:</p> <pre><code>$ ./pt-table-checksum\n</code></pre> <p>You should see results similar to the following:</p> <pre><code>TS ERRORS  DIFFS     ROWS  CHUNKS SKIPPED    TIME TABLE\n04-30T11:31:50      0      0   633135       8       0   5.400 exampledb.aka_name\n04-30T11:31:52      0      0   290859       1       0   2.692 exampledb.aka_title\nChecksumming exampledb.user_info:  16% 02:27 remain\nChecksumming exampledb.user_info:  34% 01:58 remain\nChecksumming exampledb.user_info:  50% 01:29 remain\nChecksumming exampledb.user_info:  68% 00:56 remain\nChecksumming exampledb.user_info:  86% 00:24 remain\n04-30T11:34:38      0      0 22187768     126       0 165.216 exampledb.user_info\n04-30T11:38:09      0      0        0       1       0   0.033 mysql.time_zone_name\n04-30T11:38:09      0      0        0       1       0   0.052 mysql.time_zone_transition\n04-30T11:38:09      0      0        0       1       0   0.054 mysql.time_zone_transition_type\n04-30T11:38:09      0      0        8       1       0   0.064 mysql.user\n</code></pre> <p>If all the values in the <code>DIFFS</code> column are 0 that means that backup is consistent with the current setup.</p> <p>In case backup wasn\u2019t consistent  pt-table-checksum should spot the difference and point to the table that doesn\u2019t match. Following example shows adding new user on the backed up replica in order to simulate the inconsistent backup:</p> <pre><code>mysql&gt; GRANT usage ON exampledb.* to exampledb@localhost IDENTIFIED BY 'thisisnewpassword';\n</code></pre> <p>If we run the pt-table-checksum now difference should be spotted</p> <p><pre><code>$ ./pt-table-checksum\n</code></pre> You should see results similar to the following:</p> <pre><code>TS ERRORS  DIFFS     ROWS  CHUNKS SKIPPED    TIME TABLE\n04-30T11:31:50      0      0   633135       8       0   5.400 exampledb.aka_name\n04-30T11:31:52      0      0   290859       1       0   2.692 exampledb.aka_title\nChecksumming exampledb.user_info:  16% 02:27 remain\nChecksumming exampledb.user_info:  34% 01:58 remain\nChecksumming exampledb.user_info:  50% 01:29 remain\nChecksumming exampledb.user_info:  68% 00:56 remain\nChecksumming exampledb.user_info:  86% 00:24 remain\n04-30T11:34:38      0      0 22187768     126       0 165.216 exampledb.user_info\n04-30T11:38:09      0      0        0       1       0   0.033 mysql.time_zone_name\n04-30T11:38:09      0      0        0       1       0   0.052 mysql.time_zone_transition\n04-30T11:38:09      0      0        0       1       0   0.054 mysql.time_zone_transition_type\n04-30T11:38:09      1      0        8       1       0   0.064 mysql.user\n</code></pre> <p>This output shows that source and the replica are not in a consistent state and that the difference is in the <code>mysql.user</code> table.</p> <p>More information on different options that pt-table-checksum provides can be found in the pt-table-checksum documentation.</p>"},{"location":"howtos/enabling_tcp.html","title":"Enabling the server to communicate via TCP/IP","text":"<p>Most of the Linux distributions do not enable by default to accept TCP/IP connections from outside in their MySQL or Percona Server packages.</p> <p>You can check it with <code>netstat</code> on a shell:</p> <p><pre><code>$ netstat -lnp | grep mysql\n</code></pre> You should see results similar to the following: <pre><code>tcp         0        0 0.0.0.0:3306 0.0.0.0:* LISTEN 2480/mysqld\nunix 2 [ ACC ] STREAM LISTENING 8101 2480/mysqld /tmp/mysql.sock\n</code></pre></p> <p>You should check two things:</p> <ul> <li> <p>there is a line starting with <code>tcp</code> (the server is indeed accepting TCP connections) and</p> </li> <li> <p>the first address (<code>0.0.0.0:3306</code> in this example) is different than <code>127.0.0.1:3306</code> (the bind address is not localhost\u2019s).</p> </li> </ul> <p>In the first case, the first place to look is the <code>my.cnf</code> file. If you find the option <code>skip-networking</code>, comment it out or just delete it. Also check that if the variable <code>bind_address</code> is set, then it shouldn\u2019t be set to localhost\u2019s but to the host\u2019s IP. Then restart the MySQL server and check it again with <code>netstat</code>. If the changes you did had no effect, then you should look at your distribution\u2019s startup scripts (like <code>rc.mysqld</code>). You should comment out flags like <code>--skip-networking</code> and/or change the <code>bind-address</code>.</p> <p>After you get the server listening to remote TCP connections properly, the last thing to do is checking that the port (3306 by default) is indeed open. Check your firewall configurations (<code>iptables -L</code>) and that you are allowing remote hosts on that port (in <code>/etc/hosts.allow</code>).</p> <p>And we\u2019re done! We have a MySQL server running which is able to communicate with the world through TCP/IP.</p>"},{"location":"howtos/permissions.html","title":"Privileges and Permissions for Users","text":"<p>We will be referring to <code>permissions</code> to the ability of a user to access and perform changes on the relevant parts of the host\u2019s filesystem, starting/stopping services and installing software.</p> <p>By <code>privileges</code> we refer to the abilities of a database user to perform different kinds of actions on the database server.</p>"},{"location":"howtos/permissions.html#at-a-system-level","title":"At a system level","text":"<p>There are many ways for checking the permission on a file or directory. For example, <code>ls -ls /path/to/file</code> or <code>stat /path/to/file | grep Access</code> will do the job:</p> <pre><code>$ stat /etc/mysql | grep Access\n</code></pre> <p>You should see results similar to the following:</p> <pre><code>Access: (0755/drwxr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)\nAccess: 2011-05-12 21:19:07.129850437 -0300\n$ ls -ld /etc/mysql/my.cnf\n-rw-r--r-- 1 root root 4703 Apr  5 06:26 /etc/mysql/my.cnf\n</code></pre> <p>As in this example, <code>my.cnf</code> is owned by <code>root</code> and not writable for anyone else. Assuming that you do not have <code>root</code> \u2018s password, you can check what permissions you have on this types of files with <code>sudo -l</code>:</p> <p><pre><code>$ sudo -l\n</code></pre> You should see results similar to the following:</p> <pre><code>Password:\nYou may run the following commands on this host:\n(root) /usr/bin/\n(root) NOPASSWD: /etc/init.d/mysqld\n(root) NOPASSWD: /bin/vi /etc/mysql/my.cnf\n(root) NOPASSWD: /usr/local/bin/top\n(root) NOPASSWD: /usr/bin/ls\n(root) /bin/tail\n</code></pre> <p>Being able to execute with <code>sudo</code> scripts in <code>/etc/init.d/</code>, <code>/etc/rc.d/</code> or <code>/sbin/service</code> is the ability to start and stop services.</p> <p>Also, If you can execute the package manager of your distribution, you can install or remove software with it. If not, having <code>rwx</code> permission over a directory will let you do a local installation of software by compiling it there. This is a typical situation in many hosting companies\u2019 services.</p> <p>There are other ways for managing permissions, such as using PolicyKit, Extended ACLs or SELinux, which may be preventing or allowing your access. You should check them in that case.</p>"},{"location":"howtos/permissions.html#at-a-database-server-level","title":"At a database server level","text":"<p>To query the privileges that your database user has been granted, at a console of the server execute:</p> <pre><code>mysql&gt; SHOW GRANTS;\n</code></pre> <p>or for a particular user with:</p> <pre><code>mysql&gt; SHOW GRANTS FOR 'db-user'@'host';\n</code></pre> <p>It will display the privileges using the same format as for the  SHOW-GRANT  statement.</p> <p>Note that privileges may vary across versions of the server. To list the exact list of privileges that your server support (and a brief description of them) execute:</p> <pre><code>mysql&gt; SHOW PRIVILEGES;\n</code></pre>"},{"location":"howtos/recipes_ibkx_compressed.html","title":"Making a Compressed Backup","text":"<p>In order to make a compressed backup you\u2019ll need to use <code>innobackupex --compress</code></p> <pre><code>$ innobackupex --compress /data/backup\n</code></pre> <p>If you want to speed up the compression you can use the parallel compression, which can be enabled with <code>innobackupex --compress-threads</code> option. Following example will use four threads for compression:</p> <pre><code>$ innobackupex --compress --compress-threads=4 /data/backup\n</code></pre> <p>Output should look like this</p> <pre><code>...\n[01] Compressing ./imdb/comp_cast_type.ibd to /data/backup/2013-08-01_11-24-04/./imdb/comp_cast_type.ibd.qp\n[01]        ...done\n[01] Compressing ./imdb/aka_name.ibd to /data/backup/2013-08-01_11-24-04/./imdb/aka_name.ibd.qp\n[01]        ...done\n...\n130801 11:50:24  innobackupex: completed OK\n</code></pre>"},{"location":"howtos/recipes_ibkx_compressed.html#preparing-the-backup","title":"Preparing the backup","text":"<p>Before you can prepare the backup you\u2019ll need to uncompress all the files with qpress (which is available from Percona Software repositories). You can use following one-liner to uncompress all the files:</p> <pre><code>$ for bf in `find . -iname \"*\\.qp\"`; do qpress -d $bf $(dirname $bf) &amp;&amp; rm $bf; done\n</code></pre> <p>In Percona XtraBackup 2.1.4 new <code>innobackupex --decompress</code> option has been implemented that can be used to decompress the backup:</p> <pre><code>$ innobackupex --decompress /data/backup/2013-08-01_11-24-04/\n</code></pre> <p>Note</p> <p>In order to successfully use the <code>innobackupex --decompress</code> option,qpress binary needs to installed and within the path. <code>innobackupex --parallel</code> can be used with <code>innobackupex --decompress</code> option to decompress multiple files simultaneously.</p> <p>When the files are uncompressed you can prepare the backup with innobackupex \u2013apply-log:</p> <pre><code>$ innobackupex --apply-log /data/backup/2013-08-01_11-24-04/\n</code></pre> <p>You should check for a confirmation message:</p> <pre><code>130802 02:51:02  innobackupex: completed OK!\n</code></pre> <p>Now the files in /data/backups/2013-08-01_11-24-04 is ready to be used by the server.</p> <p>Note</p> <p>Percona XtraBackup doesn\u2019t automatically remove the compressed files. In order to clean up the backup directory users should remove the <code>\\*.qp</code> files.</p>"},{"location":"howtos/recipes_ibkx_compressed.html#restoring-the-backup","title":"Restoring the backup","text":"<p>Once the backup has been prepared you can use the <code>innobackupex --copy-back</code> to restore the backup.</p> <pre><code>$ innobackupex --copy-back /data/backups/2013-08-01_11-24-04/\n</code></pre> <p>This will copy the prepared data back to its original location as defined by the <code>datadir</code> in your <code>my.cnf</code>.</p> <p>After the confirmation message:</p> <pre><code>130802 02:58:44  innobackupex: completed OK!\n</code></pre> <p>you should check the file permissions after copying the data back. You may need to adjust them with something like:</p> <pre><code>$ chown -R mysql:mysql /var/lib/mysql\n</code></pre> <p>Now the <code>datadir</code> contains the restored data. You are ready to start the server.</p>"},{"location":"howtos/recipes_ibkx_gtid.html","title":"How to create a new (or repair a broken) GTID based slave","text":"<p>MySQL 5.6 introduced the new Global Transaction ID (GTID) support in replication. Percona XtraBackup automatically stores the <code>GTID</code> value in the xtrabackup_binlog_info when doing the backup of MySQL and Percona Server for MySQL 5.7 with the <code>GTID</code> mode enabled. This information can be used to create a new (or repair a broken) <code>GTID</code> based replica.</p>"},{"location":"howtos/recipes_ibkx_gtid.html#step-1-take-a-backup-from-any-server-on-the-replication-environment-source-or-replica","title":"STEP 1: Take a backup from any server on the replication environment, source or replica.","text":"<p>The following command takes a backup and saves it in the /data/backups/$TIMESTAMP folder:</p> <pre><code>$ innobackupex /data/backups/\n</code></pre> <p>In the destination folder, there will be a file with the name <code>xtrabackup_binlog_info</code>. This file contains both binary log coordinates and the <code>GTID</code> information.</p> <pre><code>$ cat xtrabackup_binlog_info\n</code></pre> <p>The results should be similar to the following:</p> <pre><code>mysql-bin.000002    1232     c777888a-b6df-11e2-a604-080027635ef5:1-4\n</code></pre> <p>That information is also printed by innobackupex after taking the backup:</p> <pre><code>innobackupex: MySQL binlog position: filename 'mysql-bin.000002', position 1232, GTID of the last change 'c777888a-b6df-11e2-a604-080027635ef5:1-4'\n</code></pre>"},{"location":"howtos/recipes_ibkx_gtid.html#step-2-prepare-the-backup","title":"STEP 2: Prepare the backup","text":"<p>The backup will be prepared with the following command:</p> <pre><code>TheMaster$ innobackupex --apply-log /data/backups/$TIMESTAMP/\n</code></pre> <p>You need to select the path where your snapshot has been taken, for example <code>/data/backups/2013-05-07_08-33-33</code>. If everything is ok you should get the same OK message. Now, the transaction logs are applied to the data files, and new ones are created: your data files are ready to be used by the MySQL server.</p>"},{"location":"howtos/recipes_ibkx_gtid.html#step-3-move-the-backup-to-the-destination-server","title":"STEP 3: Move the backup to the destination server","text":"<p>Use <code>rsync</code> or <code>scp</code> to copy the data to the destination server. If you are synchronizing the data directly to the already running replica\u2019s data directory it is advised to stop the MySQL server there.</p> <pre><code>$ rsync -avprP -e ssh /path/to/backupdir/$TIMESTAMP NewSlave:/path/to/mysql/\n</code></pre> <p>After you copy the data over, make sure MySQL has proper permissions to access them.</p> <pre><code>$ chown mysql:mysql /path/to/mysql/datadir\n</code></pre>"},{"location":"howtos/recipes_ibkx_gtid.html#step-4-configure-and-start-replication","title":"STEP 4: Configure and start replication","text":"<p>Set the gtid_purged variable to the <code>GTID</code> from <code>xtrabackup_binlog_info</code>. Then, update the information about the source node and, finally, start the replica.</p> <pre><code># Using the mysql shell\nNewSlave &gt; SET SESSION wsrep_on = 0;\nNewSlave &gt; RESET MASTER;\nNewSlave &gt; SET SESSION wsrep_on = 1;\nNewSlave &gt; SET GLOBAL gtid_purged='&lt;gtid_string_found_in_xtrabackup_binlog_info&gt;';\nNewSlave &gt; CHANGE MASTER TO\nMASTER_HOST=\"$masterip\",\nMASTER_USER=\"repl\",\nMASTER_PASSWORD=\"$slavepass\",\nMASTER_AUTO_POSITION = 1;\nNewSlave &gt; START SLAVE;\n</code></pre> <p>Note</p> <p>The example above is applicable to Percona XtraDB Cluster. The <code>wsrep_on</code> variable is set to 0 before resetting the source (<code>RESET MASTER</code>). The reason is that Percona XtraDB Cluster will not allow resetting the source if <code>wsrep_on=1</code>.</p>"},{"location":"howtos/recipes_ibkx_gtid.html#step-5-check-the-replication-status","title":"STEP 5: Check the replication status","text":"<p>Following command will show the replica status:</p> <p><pre><code>NewSlave &gt; SHOW SLAVE STATUS\\G\n</code></pre> The results should be similar to as follows:</p> <pre><code>Slave_IO_Running: Yes\nSlave_SQL_Running: Yes\n[...]\nRetrieved_Gtid_Set: c777888a-b6df-11e2-a604-080027635ef5:5\nExecuted_Gtid_Set: c777888a-b6df-11e2-a604-080027635ef5:1-5\n</code></pre> <p>We can see that the replica has retrieved a new transaction with number 5, so transactions from 1 to 5 are already on this replica.</p> <p>That\u2019s all, we have created a new replica in our <code>GTID</code> based replication environment.</p>"},{"location":"howtos/recipes_ibkx_inc.html","title":"Making an Incremental Backup","text":"<p>Every incremental backup starts with a full one, which we will call the base backup:</p> <pre><code>$ innobackupex --user=USER --password=PASSWORD /path/to/backup/dir/\n</code></pre> <p>Note that the full backup will be in a timestamped subdirectory of <code>/path/to/backup/dir/</code> (e.g., <code>/path/to/backup/dir/2011-12-24_23-01-00/</code>).</p> <p>Assuming that variable <code>$FULLBACKUP</code> contains /path/to/backup/dir/2011-5-23_23-01-18, let\u2019s do an incremental backup an hour later:</p> <pre><code>innobackupex --incremental /path/to/inc/dir \\\n--incremental-basedir=$FULLBACKUP --user=USER --password=PASSWORD\n</code></pre> <p>Now, the incremental backup should be in <code>/path/to/inc/dir/2011-12-25_00-01-00/</code>. Let\u2019s call <code>$INCREMENTALBACKUP=2011-5-23_23-50-10</code>.</p> <p>Preparing incremental backups is a bit different from full ones:</p> <p>First you have to replay the committed transactions on each backup,</p> <pre><code>$ innobackupex --apply-log --redo-only $FULLBACKUP \\\n--use-memory=1G --user=USER --password=PASSWORD\n</code></pre> <p>Note</p> <p>In the <code>prepare</code> phase, the <code>--use-memory</code> parameter speeds up the process if the amount of RAM assigned to the option is available. Use the parameter only in the <code>prepare</code> phase. In the other phases the parameter makes the application lazy allocate this memory (reserve) but does not affect database pages.</p> <p>If everything went fine, you should see an output similar to:</p> <pre><code>111225 01:10:12 InnoDB: Shutdown completed; log sequence number 91514213\n</code></pre> <p>Now apply the incremental backup to the base backup, by issuing:</p> <pre><code>$ innobackupex --apply-log --redo-only $FULLBACKUP\n--incremental-dir=$INCREMENTALBACKUP\n--use-memory=1G --user=DVADER --password=D4RKS1D3\n</code></pre> <p>Note the <code>$INCREMENTALBACKUP</code>.</p> <p>The final data will be in the base backup directory, not in the incremental one. In this example, <code>/path/to/backup/dir/2011-12-24_23-01-00</code> or <code>$FULLBACKUP</code>.</p> <p>If you want to apply more incremental backups, repeat this step with the next one. It is important that you do this in the chronological order in which the backups were done.</p> <p>You can check the file xtrabackup_checkpoints at the directory of each one.</p> <p>They should look like: (in the base backup)</p> <pre><code>backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 1291135\n</code></pre> <p>and in the incremental ones:</p> <pre><code>backup_type = incremental\nfrom_lsn = 1291135\nto_lsn = 1291340\n</code></pre> <p>The <code>to_lsn</code> number must match the <code>from_lsn</code> of the next one.</p> <p>Once you put all the parts together, you can prepare again the full backup (base + incrementals) once again to rollback the pending transactions:</p> <pre><code>$ innobackupex-1.5.1 --apply-log $FULLBACKUP --use-memory=1G \\\n--user=$USERNAME --password=$PASSWORD\n</code></pre> <p>Now your backup is ready to be used immediately after restoring it. This preparation step is optional, as if you restore it without doing it, the database server will assume that a crash occurred and will begin to roll back the uncommitted transaction (causing some downtime which can be avoided).</p>"},{"location":"howtos/recipes_ibkx_local.html","title":"Make a Local Full Backup (Create, Prepare and Restore)","text":""},{"location":"howtos/recipes_ibkx_local.html#create-the-backup","title":"Create the Backup","text":"<p>This is the simplest use case. It copies all your MySQL data into the specified directory. Here is how to make a backup of all the databases in the <code>datadir</code> specified in your <code>my.cnf</code>. It will put the backup in a time stamped subdirectory of /data/backups/, in this case, <code>/data/backups/2010-03-13_02-42-44</code>,</p> <pre><code>$ innobackupex /data/backups\n</code></pre> <p>There is a lot of output, but you need to make sure you see this at the end of the backup. If you don\u2019t see this output, then your backup failed:</p> <pre><code>100313 02:43:07  innobackupex: completed OK!\n</code></pre>"},{"location":"howtos/recipes_ibkx_local.html#prepare-the-backup","title":"Prepare the Backup","text":"<p>To prepare the backup use the <code>innobackupex --apply-log</code> option and specify the timestamped subdirectory of the backup. To speed up the apply-log process, use the <code>innobackupex --use-memory</code>:</p> <pre><code>$ innobackupex --use-memory=4G --apply-log /data/backups/2010-03-13_02-42-44/\n</code></pre> <p>You should check for a confirmation message:</p> <pre><code>100313 02:51:02  innobackupex: completed OK!\n</code></pre> <p>Now the files in <code>/data/backups/2010-03-13_02-42-44</code> is ready to be used by the server.</p>"},{"location":"howtos/recipes_ibkx_local.html#restore-the-backup","title":"Restore the Backup","text":"<p>To restore the already-prepared backup, first stop the server and then use the <code>innobackupex --copy-back</code> function of innobackupex:</p> <pre><code>$ innobackupex --copy-back /data/backups/2010-03-13_02-42-44/\n## Use chmod to correct the permissions, if necessary!\n</code></pre> <p>This will copy the prepared data back to its original location as defined by the <code>datadir</code> in your <code>my.cnf</code>.</p> <p>Note</p> <p>The <code>datadir</code> must be empty; Percona XtraBackup <code>innobackupex --copy-back</code> option will not copy over existing files unless <code>innobackupex --force-non-empty-directories</code> option is specified. Also it\u2019s important to note that MySQL server needs to be shut down before restore is performed. You can\u2019t restore to a <code>datadir</code> of a running mysqld instance (except when importing a partial backup).</p> <p>After the confirmation message:</p> <pre><code>100313 02:58:44  innobackupex: completed OK!\n</code></pre> <p>you should check the file permissions after copying the data back. You may need to adjust them with something like:</p> <pre><code>$ chown -R mysql:mysql /var/lib/mysql\n</code></pre> <p>Now the <code>datadir</code> contains the restored data. You are ready to start the server.</p>"},{"location":"howtos/recipes_ibkx_partition.html","title":"Back up and restore individual partitions","text":"<p>Percona XtraBackup features partial backups, which means that you may backup individual partitions as well because from the storage engines perspective partitions are regular tables with specially formatted names. The only requirement for this feature is having the <code>innodb_file_per_table</code> option enabled in the server.</p> <p>There is only one caveat about using this kind of backup: you can\u2019t copy back the prepared backup. Restoring partial backups should be done by importing the tables, and not by using the traditional <code>innobackupex --copy-back</code> option. Although there are some scenarios where restoring can be done by copying back the files, this may be lead to database inconsistencies in many cases and it is not the recommended way to do it.</p>"},{"location":"howtos/recipes_ibkx_partition.html#create-the-backup","title":"Create the backup","text":"<p>There are three ways of specifying which part of the whole data will be backed up: regular expressions (<code>innobackupex --include</code>), enumerating the tables in a file (<code>innobackupex --tables-file</code>) or providing a list of databases (<code>innobackupex --databases</code>). In this example <code>innobackupex --include</code> option will be used.</p> <p>The regular expression provided to this option will be matched against the fully qualified tablename, including the database name, in the form <code>databasename.tablename</code>.</p> <p>For example, this will back up the partition <code>p4</code> from the table <code>name</code> located in the database <code>imdb</code>:</p> <pre><code>$ innobackupex --include='^imdb[.]name#P#p4' /mnt/backup/\n</code></pre> <p>This will create a timestamped directory with the usual files that innobackupex creates, but only the data files related to the tables matched.</p> <p>Output of the innobackupex will list the skipped tables</p> <pre><code>...\n[01] Skipping ./imdb/person_info.ibd\n[01] Skipping ./imdb/name#P#p5.ibd\n[01] Skipping ./imdb/name#P#p6.ibd\n...\nimdb.person_info.frm is skipped because it does not match ^imdb[.]name#P#p4.\nimdb.title.frm is skipped because it does not match ^imdb[.]name#P#p4.\nimdb.company_type.frm is skipped because it does not match ^imdb[.]name#P#p4.\n...\n</code></pre> <p>Note that this option is passed to <code>xtrabackup --tables</code> and is matched against each table of each database, the directories of each database will be created even if they are empty.</p>"},{"location":"howtos/recipes_ibkx_partition.html#prepare-the-backup","title":"Prepare the backup","text":"<p>For preparing partial backups, the procedure is analogous to restoring individual tables: apply the logs and use <code>innobackupex --export</code>:</p> <pre><code>$ innobackupex --apply-log --export /mnt/backup/2012-08-28_10-29-09\n</code></pre> <p>You may see warnings in the output about tables that don\u2019t exist. This is because InnoDB-based engines stores its data dictionary inside the tablespace files besides the <code>.frm</code> files. innobackupex will use xtrabackup to remove the missing tables (those that haven\u2019t been selected in the partial backup) from the data dictionary in order to avoid future warnings or errors:</p> <pre><code>InnoDB: in InnoDB data dictionary has tablespace id 51,\nInnoDB: but tablespace with that id or name does not exist. It will be removed from data dictionary.\n120828 10:25:28  InnoDB: Waiting for the background threads to start\n120828 10:25:29 Percona XtraDB (http://www.percona.com) 1.1.8-20.1 started; log sequence number 10098323731\nxtrabackup: export option is specified.\nxtrabackup:     name=PRIMARY, id.low=73, page=3\n</code></pre> <p>Finally, check the for the confirmation message in the output:</p> <pre><code>120828 19:25:38  innobackupex: completed OK!\n</code></pre>"},{"location":"howtos/recipes_ibkx_partition.html#restore-from-the-backups","title":"Restore from the backups","text":"<p>Restoring should be done by importing the tables in the partial backup to the server.</p> <p>Note</p> <p>Improved table/partition import is only available in Percona Server for MySQL and MySQL 5.6, this means that partitions which were backed up from different server can be imported as well. For versions older than MySQL 5.6 only partitions from that server can be imported with some important limitations. There should be no DROP/CREATE/TRUNCATE/ALTER TABLE commands issued between taking the backup and importing the partition.</p> <p>First step is to create new table in which data will be restored</p> <pre><code>mysql&gt; CREATE TABLE name_p4 (\nid int(11) NOT NULL AUTO_INCREMENT,\nname text NOT NULL,\nimdb_index varchar(12) DEFAULT NULL,\nimdb_id int(11) DEFAULT NULL,\nname_pcode_cf varchar(5) DEFAULT NULL,\nname_pcode_nf varchar(5) DEFAULT NULL,\nsurname_pcode varchar(5) DEFAULT NULL,\nPRIMARY KEY (id)\n) ENGINE=InnoDB AUTO_INCREMENT=2812744 DEFAULT CHARSET=utf8\n</code></pre> <p>To restore the partition from the backup tablespace needs to be discarded for that table:</p> <pre><code>mysql&gt;  ALTER TABLE name_p4 DISCARD TABLESPACE;\n</code></pre> <p>The next step is to copy the <code>ibd</code> file from the backup to MySQL data directory:</p> <pre><code>$ cp /mnt/backup/2012-08-28_10-29-09/imdb/name#P#p4.ibd /var/lib/mysql/imdb/name_p4.ibd\n</code></pre> <p>Note</p> <p>Make sure that the copied files can be accessed by the user running the MySQL.</p> <p>The last step is to import the tablespace:</p> <pre><code>mysql&gt;  ALTER TABLE name_p4 IMPORT TABLESPACE;\n</code></pre>"},{"location":"howtos/recipes_ibkx_partition.html#restoring-from-the-backups-in-version-56","title":"Restoring from the backups in version 5.6","text":"<p>The problem with server versions up to 5.5 is that there is no server support to import either individual partitions or all partitions of a partitioned table, so partitions could only be imported as independent tables. In MySQL and Percona Server for MySQL 5.6 it is possible to exchange individual partitions with independent tables through <code>ALTER TABLE</code> \u2026 <code>EXCHANGE PARTITION</code> command.</p> <p>Note</p> <p>In Percona Server for MySQL 5.6, the variable <code>innodb_import_table_from_xtrabackup</code> was removed in favor of MySQL Transportable Tablespaces implementation.</p> <p>When importing an entire partitioned table, first import all (sub)partitions as independent tables:</p> <pre><code>mysql&gt; CREATE TABLE `name_p4` (\n`id` int(11) NOT NULL AUTO_INCREMENT,\n`name` text NOT NULL,\n`imdb_index` varchar(12) DEFAULT NULL,\n`imdb_id` int(11) DEFAULT NULL,\n`name_pcode_cf` varchar(5) DEFAULT NULL,\n`name_pcode_nf` varchar(5) DEFAULT NULL,\n`surname_pcode` varchar(5) DEFAULT NULL,\nPRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2812744 DEFAULT CHARSET=utf8\n</code></pre> <p>To restore the partition from the backup tablespace needs to be discarded for that table:</p> <pre><code>mysql&gt;  ALTER TABLE name_p4 DISCARD TABLESPACE;\n</code></pre> <p>The next step is to copy the <code>.cfg</code> and <code>.ibd</code> files from the backup to MySQL data directory:</p> <pre><code>$ cp /mnt/backup/2013-07-18_10-29-09/imdb/name#P#p4.cfg /var/lib/mysql/imdb/name_p4.cfg\n$ cp /mnt/backup/2013-07-18_10-29-09/imdb/name#P#p4.ibd /var/lib/mysql/imdb/name_p4.ibd\n</code></pre> <p>The last step is to import the tablespace:</p> <pre><code>mysql&gt;  ALTER TABLE name_p4 IMPORT TABLESPACE;\n</code></pre> <p>We can now create the empty partitioned table with exactly the same schema as the table being imported:</p> <pre><code>mysql&gt; CREATE TABLE name2 LIKE name;\n</code></pre> <p>Then swap empty partitions from the newly created table with individual tables corresponding to partitions that have been exported/imported on the previous steps:</p> <pre><code>mysql&gt; ALTER TABLE name2 EXCHANGE PARTITION p4 WITH TABLE name_p4;\n</code></pre> <p>In order for this operation to be successful following conditions have to be met.</p>"},{"location":"howtos/recipes_ibkx_stream.html","title":"Make a Streaming Backup","text":"<p>Stream mode sends the backup to <code>STDOUT</code> in the xbstream format instead of copying it to the directory named by the first argument. You can pipe the output to <code>gzip</code>, or across the network, to another server.</p> <p>To extract the resulting xbstream file, you must use the xbstream utility: <code>xbstream -x &lt;  backup.xbstream</code>.</p> <p>Here are some examples of using the <code>xbstream</code> option for streaming:</p> Action Command Stream the backup into a xbstream archived named \u2018backup.xbstream\u2019 <code>$ xtrabackup --backup --stream=xbstream ./ &gt; backup.xbstream</code> Stream the backup into a xbstream archived named \u2018backup.xbstream\u2019 and compress it <code>$ xtrabackup --backup --stream=xbstream --compress ./ &gt; backup.xbstream</code> Encrypt the backup <code>$ xtrabackup --backup --stream=xbstream ./ &gt; backup.xbstream gzip - | openssl des3 -salt -k \"password\" &gt; backup.xbstream.gz.des3</code> Send the backup to another server and unpack it <code>$ xtrabackup --backup --compress --stream=xbstream ./ | ssh user@otherhost \"xbstream -x\"</code> Send the backup to another server using <code>netcat</code> On the destination host:<code>$ nc -l 9999 | cat - &gt; /data/backups/backup.xbstream</code>On the source host:<code>$ xtrabackup --backup --stream=xbstream ./ | nc desthost 9999</code> Send the backup to another server using a one-liner <code>$ ssh user@desthost \"( nc -l 9999 &gt; /data/backups/backup.xbstream &amp; )\" &amp;&amp; xtrabackup --backup --stream=xbstream ./ |  nc desthost 9999</code> Throttle the throughput to 10MB/sec using the <code>pipe viewer</code> tool 1 <code>$ xtrabackup --backup --stream=xbstream ./ | pv -q -L10m ssh user@desthost \"cat - &gt; /data/backups/backup.xbstream\"</code> Checksumming the backup during the streaming On the destination host:<code>$ nc -l 9999 | tee &gt;(sha1sum &gt; destination_checksum) &gt; /data/backups/backup.xbstream</code>On the source host:<code>$ xtrabackup --backup --stream=xbstream ./ | tee &gt;(sha1sum &gt; source_checksum) | nc desthost 9999</code>Compare the checksums on the source host:<code>$ cat source_checksum 65e4f916a49c1f216e0887ce54cf59bf3934dbad</code>Compare the checksums on the destination host:<code>$ cat destination_checksum 65e4f916a49c1f216e0887ce54cf59bf3934dbad</code> Parallel compression with parallel copying backup <code>$ xtrabackup --backup --compress --compress-threads=8 --stream=xbstream --parallel=4 ./ &gt; backup.xbstream</code> <ol> <li> <p>Install from the official site or from the distribution package (<code>apt install pv</code>).\u00a0\u21a9</p> </li> </ol>"},{"location":"howtos/recipes_xbk_full.html","title":"Making a Full Backup","text":"<p>Backup the InnoDB data and log files - located in <code>/var/lib/mysql/</code> - to <code>/data/backups/mysql/</code> (destination). Then, prepare the backup files to be ready to restore or use (make the data files consistent).</p>"},{"location":"howtos/recipes_xbk_full.html#make-a-backup","title":"Make a backup:","text":"<pre><code>$ xtrabackup --backup --target-dir=/data/backups/mysql/\n</code></pre>"},{"location":"howtos/recipes_xbk_full.html#prepare-the-backup-twice","title":"Prepare the backup twice:","text":"<pre><code>$ xtrabackup --prepare --target-dir=/data/backups/mysql/\n$ xtrabackup --prepare --target-dir=/data/backups/mysql/\n</code></pre>"},{"location":"howtos/recipes_xbk_full.html#success-criterion","title":"Success Criterion","text":"<ul> <li> <p>The exit status of xtrabackup is 0.</p> </li> <li> <p>In the second xtrabackup \u2013prepare step, you should see InnoDB print messages similar to <code>Log file ./ib_logfile0 did not exist: new to be created</code>, followed by a line indicating the log file was created (creating new logs is the purpose of the second preparation).</p> </li> </ul>"},{"location":"howtos/recipes_xbk_full.html#notes","title":"Notes","text":"<ul> <li> <p>You might want to set the <code>xtrabackup --use-memory</code> option to something similar to the size of your buffer pool, if you are on a dedicated server that has enough free memory. More details here.</p> </li> <li> <p>For a more detailed explanation, see Creating a backup</p> </li> </ul>"},{"location":"howtos/recipes_xbk_inc.html","title":"Making an Incremental Backup","text":"<p>Backup all the InnoDB data and log files - located in <code>/var/lib/mysql/</code> - once, then make two daily incremental backups in <code>/data/backups/mysql/</code> (destination). Finally, prepare the backup files to be ready to restore or use.</p>"},{"location":"howtos/recipes_xbk_inc.html#create-one-full-backup","title":"Create one full backup","text":"<p>Making an incremental backup requires a full backup as a base:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/mysql/\n</code></pre> <p>It is important that you do not run the <code>xtrabackup --prepare</code> command yet.</p>"},{"location":"howtos/recipes_xbk_inc.html#create-two-incremental-backups","title":"Create two incremental backups","text":"<p>Suppose the full backup is on Monday, and you will create an incremental one on Tuesday:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc/tue/ \\\n--incremental-basedir=/data/backups/mysql/\n</code></pre> <p>and the same policy is applied on Wednesday:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc/wed/ \\\n--incremental-basedir=/data/backups/inc/tue/\n</code></pre>"},{"location":"howtos/recipes_xbk_inc.html#prepare-the-base-backup","title":"Prepare the base backup","text":"<p>Prepare the base backup (Monday\u2019s backup):</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/mysql/\n</code></pre>"},{"location":"howtos/recipes_xbk_inc.html#roll-forward-the-base-data-to-the-first-increment","title":"Roll forward the base data to the first increment","text":"<p>Roll Monday\u2019s data forward to the state on Tuesday:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/mysql/ \\\n--incremental-dir=/data/backups/inc/tue/\n</code></pre>"},{"location":"howtos/recipes_xbk_inc.html#roll-forward-again-to-the-second-increment","title":"Roll forward again to the second increment","text":"<p>Roll forward again to the state on Wednesday:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/mysql/ \\\n--incremental-dir=/data/backups/inc/wed/\n</code></pre>"},{"location":"howtos/recipes_xbk_inc.html#prepare-the-whole-backup-to-be-ready-to-use","title":"Prepare the whole backup to be ready to use","text":"<p>Create the new logs by preparing it:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backups/mysql/\n</code></pre>"},{"location":"howtos/recipes_xbk_inc.html#notes","title":"Notes","text":"<ul> <li> <p>You might want to set the <code>xtrabackup --use-memory</code> to speed up the process if you are on a dedicated server that has enough free memory. More details here.</p> </li> <li> <p>A more detailed explanation is here.</p> </li> </ul>"},{"location":"howtos/recipes_xbk_restore.html","title":"Restoring the Backup","text":"<p>Because <code>xtrabackup</code> does not copy MyISAM files, <code>.frm</code> files, and  the rest of the database, you might need to back those up separately. To restore the InnoDB data, simply do something like the following after preparing:</p> <pre><code>cd /data/backups/mysql/\nrsync -rvt --exclude 'xtrabackup_checkpoints' --exclude 'xtrabackup_logfile' \\\n./ /var/lib/mysql\nchown -R mysql:mysql /var/lib/mysql/\n</code></pre>"},{"location":"howtos/setting_up_replication.html","title":"How to setup a replica for replication in 6 simple steps with Percona XtraBackup","text":"<p>Data is, by far, the most valuable part of a system. Having a backup done systematically and available for a rapid recovery in case of failure is admittedly essential to a system. However, it is not common practice because of its costs, infrastructure needed or even the boredom associated to the task. Percona XtraBackup is designed to solve this problem.</p> <p>You can have almost real-time backups in 6 simple steps by setting up a replication environment with Percona XtraBackup.</p> <p>Percona XtraBackup is a tool for backing up your data without interruption. It performs \u201chot backups\u201d on unmodified versions of MySQL servers (5.1, 5.5 and 5.6), as well as MariaDB and Percona Server for MySQL. It is a totally free and open source software distributed only under the GPLv2 license.</p>"},{"location":"howtos/setting_up_replication.html#all-the-things-you-will-need","title":"All the things you will need","text":"<p>Setting up a replica for replication with Percona XtraBackup is a straightforward procedure. You must have the following things to complete the steps:</p> <ul> <li> <p><code>Source</code> A system with a MySQL-based server installed, configured and running. This system is called the <code>Source</code>, and is where your data is stored and used for replication. We assume the following about this server:</p> <ul> <li> <p>Communication enabled with others by the standard TCP/IP port</p> </li> <li> <p>Installed and configured SSH server</p> </li> <li> <p>Configured user account in the system with the appropriate permissions and privileges</p> </li> <li> <p>Enabled binlogs and the server-id set up to 1</p> </li> </ul> </li> <li> <p><code>Replica</code> MySQL-based server installed on another server. This server is called the <code>Replica</code>. We assume the same configuration as the <code>Source</code>, except that the server-id on the <code>Replica</code> is 2.</p> </li> <li> <p><code>Percona XtraBackup</code> The backup tool should be installed in both servers for convenience.</p> </li> </ul> <p>Note</p> <p>It is not recommended to mix MySQL variants (Percona Server, MySQL, MariaDB) in your replication setup.  This may produce incorrect <code>xtrabackup_slave_info</code> file when adding a new replica.</p>"},{"location":"howtos/setting_up_replication.html#step-1-make-a-backup-on-the-source-and-prepare-it","title":"STEP 1: Make a backup on the <code>Source</code> and prepare it","text":"<p>On the <code>Source</code>, issue the following command to a shell:</p> <pre><code>$ xtrabackup --backup --user=yourDBuser --password=MaGiCdB1 --target-dir=/path/to/backupdir\n</code></pre> <p>After this is finished you should see:</p> <pre><code>xtrabackup: completed OK!\n</code></pre> <p>This action copies your MySQL data dir to the <code>/path/to/backupdir</code> directory. You have told Percona XtraBackup to connect to the database server using your database user and password, and do a hot backup of all your data in it (all MyISAM, InnoDB tables and indexes in them).</p> <p>On the <code>Source</code>, to make the snapshot consistent, prepare the data:</p> <pre><code>$ xtrabackup --user=yourDBuser --password=MaGiCdB1 \\\n--prepare --target-dir=/path/to/backupdir\n</code></pre> <p>Select the path where your snapshot has been taken. If everything is ok you should see the same OK message.  Now the transaction logs are applied to the data files, and new ones are created: your data files are ready to be used by the MySQL server.</p> <p>Percona XtraBackup knows where your data is by reading your my.cnf. If you have your configuration file in a non-standard place, use the flag <code>xtrabackup --defaults-file</code> <code>=/location/of/my.cnf</code>.</p> <p>If you want to skip writing the user name and password every time you want to access MySQL, set the information in <code>.mylogin.cnf</code> as follows:</p> <pre><code>$ mysql_config_editor set --login-path=client --host=localhost \n--user=root --password\n</code></pre> <p>This setting provides root access to MySQL.</p> <p>See also</p> <p>MySQL Documentaiton: MySQL Configuration Utility</p>"},{"location":"howtos/setting_up_replication.html#step-2-copy-backed-up-data-to-the-replica","title":"STEP 2:  Copy backed up data to the <code>Replica</code>","text":"<p>Use <code>rsync</code> or <code>scp</code> to copy the data from Source to Replica. If you\u2019re syncing the data directly to replica\u2019s data directory it\u2019s advised to stop the mysqld there. On the <code>Source</code>, run the following command:</p> <pre><code>$ rsync -avpP -e ssh /path/to/backupdir Replica:/path/to/mysql/\n</code></pre> <p>After data has been copied you can back up the original or previously installed MySQL <code>datadir</code> (NOTE: Make sure mysqld is shut down before you move the contents of its datadir, or move the snapshot into its datadir.). Run the following command on the <code>Replica</code>:</p> <pre><code>$ mv /path/to/mysql/datadir /path/to/mysql/datadir_bak\n</code></pre> <p>and, on the <code>Replica</code>, move the snapshot from the <code>Source</code> in its place:</p> <pre><code>$ xtrabackup --move-back --target-dir=/path/to/mysql/backupdir\n</code></pre> <p>After you have copied data to the <code>Replica</code>, make sure the <code>Replica</code> MySQL has the proper permissions:</p> <pre><code>$ chown mysql:mysql /path/to/mysql/datadir\n</code></pre> <p>In case the ibdata and iblog files are located in different directories outside the datadir, put them in their proper place after the logs have been applied.</p>"},{"location":"howtos/setting_up_replication.html#step-3-configure-the-source-mysql-server","title":"STEP 3: Configure the <code>Source</code> MySQL server","text":"<p>On the <code>Source</code>, add the appropriate grant to allow the replica to connect to the source:</p> <pre><code> &gt; GRANT REPLICATION SLAVE ON *.*  TO 'repl'@'$replicaip'\nIDENTIFIED BY '$replicapass';\n</code></pre> <p>Also make sure that firewall rules are correct and that the <code>Replica</code> can connect to the <code>Source</code>. Test that you can run the mysql client on the <code>Replica</code>, connect to the <code>Source</code>, and authenticate.</p> <pre><code>$ mysql --host=Source --user=repl --password=$replicapass\n</code></pre> <p>Verify the privileges.</p> <pre><code>mysql&gt; SHOW GRANTS;\n</code></pre>"},{"location":"howtos/setting_up_replication.html#step-4-configure-the-replica-mysql-server","title":"STEP 4: Configure the <code>Replica</code> MySQL server","text":"<p>Copy the <code>my.cnf</code> file from the <code>Source</code> to the <code>Replica</code>. On the <code>Replica</code>, run the following:</p> <pre><code>$ scp user@Source:/etc/mysql/my.cnf /etc/mysql/my.cnf\n</code></pre> <p>then change the following options in /etc/mysql/my.cnf:</p> <pre><code>server-id=2\n</code></pre> <p>and start/restart <code>mysqld</code> on the <code>Replica</code>.</p> <p>In case you\u2019re using init script on Debian based system to start mysqld, be sure that the password for <code>debian-sys-maint</code> user has been updated and is the same as the user\u2019s password on the <code>Source</code>. This password can be seen and updated in <code>/etc/mysql/debian.cnf</code>.</p>"},{"location":"howtos/setting_up_replication.html#step-5-start-the-replication","title":"STEP 5: Start the replication","text":"<p>On the <code>Replica</code>, look at the content of the file <code>xtrabackup_binlog_info</code>, it will be something like:</p> <pre><code> $ cat /var/lib/mysql/xtrabackup_binlog_info\nSource-bin.000001     481\n</code></pre> <p>Execute the <code>CHANGE MASTER</code> statement on a MySQL console and use the username and password you\u2019ve set up in STEP 3:</p> <pre><code>TheSlave*mysql&gt; CHANGE MASTER TO\nMASTER_HOST='$sourceip',\nMASTER_USER='repl',\nMASTER_PASSWORD='$replicapass',\nMASTER_LOG_FILE='Source-bin.000001',\nMASTER_LOG_POS=481;\n</code></pre> <p>and start the replica:</p> <pre><code>&gt; START SLAVE;\n</code></pre>"},{"location":"howtos/setting_up_replication.html#step-6-check","title":"STEP 6: Check","text":"<p>On the <code>Replica</code>, check that everything went OK with:</p> <p><pre><code>TheSlave|mysql&gt; SHOW SLAVE STATUS \\G\n</code></pre> The results should look like the following:</p> <pre><code> ...\n Slave_IO_Running: Yes\n Slave_SQL_Running: Yes\n ...\n Seconds_Behind_Master: 13\n ...\n</code></pre> <p>Both <code>IO</code> and <code>SQL</code> threads need to be running. The <code>Seconds_Behind_Master</code> means the <code>SQL</code> currently being executed has a <code>current_timestamp</code> of 13 seconds ago. It is an estimation of the lag between the <code>Source</code> and the <code>Replica</code>. Note that at the beginning, a high value could be shown because the <code>Replica</code> has to \u201ccatch up\u201d with the <code>Source</code>.</p>"},{"location":"howtos/setting_up_replication.html#adding-more-replicas-to-the-source","title":"Adding more replicas to the Source","text":"<p>You can use this procedure with slight variation to add new replicas to a source. We will use Percona XtraBackup to clone an already configured replica. We will continue using the previous scenario for convenience but we will add the <code>NewReplica</code> to the plot.</p> <p>At the <code>Replica</code>, do a full backup:</p> <pre><code> $ xtrabackup --user=yourDBuser --password=MaGiCiGaM \\\n--backup --slave-info --target-dir=/path/to/backupdir\n</code></pre> <p>By using the <code>xtrabackup --slave-info</code> Percona XtraBackup creates additional file called xtrabackup_slave_info.</p> <p>On the <code>Replica</code>, apply the logs:</p> <pre><code>$ xtrabackup --prepare --use-memory=2G --target-dir=/path/to/backupdir/\n</code></pre> <p>Note</p> <p>In the <code>prepare</code> phase, the <code>--use-memory</code> parameter speeds up the process if the amount of RAM assigned to the option is available. Use the parameter only in the <code>prepare</code> phase. In the other phases the parameter makes the application lazy allocate this memory (reserve) but does not affect database pages.</p> <p>Copy the directory from the <code>Replica</code> to the <code>NewReplica</code> (NOTE: Make sure mysqld is shut down on the <code>NewReplica</code> before you copy the contents the snapshot into its <code>datadir</code>.):</p> <pre><code>rsync -avprP -e ssh /path/to/backupdir NewReplica:/path/to/mysql/datadir\n</code></pre> <p>On the <code>Source</code>, add additional grant on the source:</p> <pre><code>&gt; GRANT REPLICATION SLAVE ON *.*  TO 'repl'@'$newreplicaip'\nIDENTIFIED BY '$replicapass';\n</code></pre> <p>Copy the configuration file from the <code>Replica</code>. On the <code>NewReplica</code>, run the following command:</p> <pre><code>$ scp user@Replica:/etc/mysql/my.cnf /etc/mysql/my.cnf\n</code></pre> <p>Make sure you change the server-id variable in <code>/etc/mysql/my.cnf</code> to 3 and disable the replication on start:</p> <pre><code>skip-slave-start\nserver-id=3\n</code></pre> <p>After setting <code>server_id</code>, start <code>mysqld</code>.</p> <p>Fetch the master_log_file and master_log_pos from the file <code>xtrabackup_slave_info</code>, execute the statement for setting up the source and the log file for the <code>NewReplica</code>:</p> <pre><code>TheNEWSlave|mysql&gt; CHANGE MASTER TO\nMASTER_HOST='$sourceip',\nMASTER_USER='repl',\nMASTER_PASSWORD='$replicapass',\nMASTER_LOG_FILE='Source-bin.000001',\nMASTER_LOG_POS=481;\n</code></pre> <p>and start the replica:</p> <pre><code>&gt; START SLAVE;\n</code></pre> <p>If both IO and SQL threads are running when you check the the <code>NewReplica</code>, server is replicating the <code>Source</code>.</p> <p>See also</p> <p>How to create a new (or repair a broken) GTID based slave</p>"},{"location":"howtos/ssh_server.html","title":"Installing and configuring a SSH server","text":"<p>Many Linux distributions only install the ssh client by default. If you don\u2019t have the ssh server installed already, the easiest way of doing it is by using your distribution\u2019s packaging system.</p> <p>Using apt, run the following:</p> <pre><code>$ sudo apt install openssh-server\n</code></pre> <p>Using Red Hat Linux or a derivative, use the following:</p> <pre><code>$ sudo yum install openssh-server\n</code></pre> <p>Review your distribution\u2019s documentation on how to configure the server.</p>"},{"location":"innobackupex/creating_a_backup_ibk.html","title":"Creating a Backup with innobackupex","text":"<p>innobackupex is the tool which provides functionality to backup a whole MySQL database instance using the xtrabackup in combination with tools like xbstream and xbcrypt.</p> <p>To create a full backup, invoke the script with the options needed to connect to the server and only one argument: the path to the directory where the backup will be stored</p> <pre><code>$ innobackupex --user=DBUSER --password=DBUSERPASS /path/to/BACKUP-DIR/\n</code></pre> <p>and check the last line of the output for a confirmation message:</p> <pre><code>innobackupex: Backup created in directory '/path/to/BACKUP-DIR/2013-03-25_00-00-09'\ninnobackupex: MySQL binlog position: filename 'mysql-bin.000003', position 1946\n111225 00:00:53  innobackupex: completed OK!\n</code></pre> <p>The backup will be stored within a time stamped directory created in the provided path, <code>/path/to/BACKUP-DIR/2013-03-25_00-00-09</code> in this particular example.</p>"},{"location":"innobackupex/creating_a_backup_ibk.html#under-the-hood","title":"Under the hood","text":"<p>innobackupex called xtrabackup binary to backup all the data of InnoDB tables (see Creating a backup for details on this process) and copied all the table definitions in the database (.frm files), data and files related to MyISAM, MERGE &lt;.MRG&gt; (reference to other tables), <code>CSV &lt;.CSV&gt;</code> and <code>ARCHIVE &lt;.ARM&gt;</code> tables, along with <code>triggers &lt;.TRG&gt;</code> and <code>database configuration information &lt;.opt&gt;</code> to a time stamped directory created in the provided path.</p> <p>It will also create the following files for convenience on the created directory.</p>"},{"location":"innobackupex/creating_a_backup_ibk.html#innobackupex-no-timestamp","title":"<code>innobackupex --no-timestamp</code>","text":"<p>This option tells innobackupex not to create a time stamped directory to store the backup:</p> <pre><code>innobackupex --user=DBUSER --password=DBUSERPASS /path/to/BACKUP-DIR/ --no-timestamp\n</code></pre> <p>innobackupex will create the <code>BACKUP-DIR</code> subdirectory (or fail if exists) and store the backup inside of it.</p>"},{"location":"innobackupex/creating_a_backup_ibk.html#innobackupex-defaults-file","title":"<code>innobackupex --defaults-file</code>","text":"<p>You can provide another configuration file to innobackupex with this option. The only limitation is that it has to be the first option passed:</p> <pre><code>$ innobackupex --defaults-file=/tmp/other-my.cnf --user=DBUSER --password=DBUSERPASS /path/to/BACKUP-DIR/\n</code></pre>"},{"location":"innobackupex/encrypted_backups_innobackupex.html","title":"Encrypted Backups","text":"<p>Percona XtraBackup has implemented support for encrypted backups. It can be used to encrypt/decrypt local or streaming backup with xbstream option (streaming tar backups are not supported) in order to add another layer of protection to the backups. Encryption is done with the <code>libgcrypt</code> library.</p>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#creating-encrypted-backups","title":"Creating Encrypted Backups","text":"<p>To make an encrypted backup following options need to be specified (options <code>innobackupex --encrypt-key</code> and <code>innobackupex --encrypt-key-file</code> are mutually exclusive, i.e. just one of them needs to be provided):</p> <ul> <li> <p>innobackupex \u2013encrypt</p> </li> <li> <p>innobackupex \u2013encrypt-key</p> </li> <li> <p>innobackupex \u2013encrypt-key-file</p> </li> </ul> <p>Both <code>innobackupex --encrypt-key</code> option and <code>innobackupex --encrypt-key-file</code> option can be used to specify the encryption key. Encryption key can be generated with a command like:</p> <pre><code>$ openssl rand -base64 24\n</code></pre> <p>Example output of that command should look like this:</p> <pre><code>GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\n</code></pre> <p>This value then can be used as the encryption key</p>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#using-innobackupex-encrypt-key","title":"Using <code>innobackupex --encrypt-key</code>","text":"<p>Example of the innobackupex command using the innobackupex \u2013encrypt-key should look like this</p> <pre><code>$ innobackupex --encrypt=AES256 --encrypt-key=\"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\" /data/backups\n</code></pre>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#using-innobackupex-encrypt-key-file","title":"Using <code>innobackupex --encrypt-key-file</code>","text":"<p>Example of the innobackupex command using the <code>innobackupex --encrypt-key-file</code> should look like this:</p> <pre><code>$ innobackupex --encrypt=AES256 --encrypt-key-file=/data/backups/keyfile /data/backups\n</code></pre> <p>Note</p> <p>Depending on the text editor used for making the <code>KEYFILE</code>, text file in some cases can contain the CRLF and this will cause the key size to grow and thus making it invalid. Suggested way to do this would be to create the file with: <code>echo -n \"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\" &gt; /data/backups/keyfile</code></p> <p>Both of these examples will create a timestamped directory in <code>/data/backups</code> containing the encrypted backup.</p> <p>Note</p> <p>You can use the innobackupex \u2013no-timestamp option to override this behavior and the backup will be created in the given directory.</p>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#optimizing-the-encryption-process","title":"Optimizing the encryption process","text":"<p>Two new options have been introduced with the encrypted backups that can be used to speed up the encryption process. These are <code>innobackupex --encrypt-threads</code> and <code>innobackupex --encrypt-chunk-size</code>. By using the <code>innobackupex --encrypt-threads</code> option multiple threads can be specified to be used for encryption in parallel. Option <code>innobackupex --encrypt-chunk-size</code> can be used to specify the size (in bytes) of the working encryption buffer for each encryption thread (default is 64K).</p>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#decrypting-encrypted-backups","title":"Decrypting Encrypted Backups","text":"<p>Backups can be decrypted with The xbcrypt binary. The following one-liner can be used to encrypt the whole folder:</p> <pre><code>$ for i in `find . -iname \"*\\.xbcrypt\"`; do xbcrypt -d --encrypt-key-file=/root/secret_key --encrypt-algo=AES256 &lt; $i &gt; $(dirname $i)/$(basename $i .xbcrypt) &amp;&amp; rm $i; done\n</code></pre> <p>Percona XtraBackup <code>innobackupex --decrypt</code> option has been implemented that can be used to decrypt the backups:</p> <pre><code>$ innobackupex --decrypt=AES256 --encrypt-key=\"GCHFLrDFVx6UAsRb88uLVbAVWbK+Yzfs\" /data/backups/2015-03-18_08-31-35/\n</code></pre> <p>Percona XtraBackup doesn\u2019t automatically remove the encrypted files. In order to clean up the backup directory users should remove the <code>\\*.xbcrypt</code> files.</p> <p>Note</p> <p><code>innobackupex --parallel</code> can be used with <code>innobackupex --decrypt</code> option to decrypt multiple files simultaneously.</p> <p>When the files have been decrypted backup can be prepared.</p>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#preparing-encrypted-backups","title":"Preparing Encrypted Backups","text":"<p>After the backups have been decrypted, they can be prepared the same way as the standard full backups with the <code>innobackupex --apply-log</code> option:</p> <pre><code>$ innobackupex --apply-log /data/backups/2015-03-18_08-31-35/\n</code></pre> <p>Note</p> <p>Percona XtraBackup doesn\u2019t automatically remove the encrypted files. In order to clean up the backup directory users should remove the <code>\\*.xbcrypt</code> files.</p>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#restoring-encrypted-backups","title":"Restoring Encrypted Backups","text":"<p>innobackupex has a <code>innobackupex --copy-back</code> option, which performs the restoration of a backup to the server\u2019s <code>datadir</code></p> <pre><code>$ innobackupex --copy-back /path/to/BACKUP-DIR\n</code></pre> <p>It will copy all the data-related files back to the server\u2019s <code>datadir</code>, determined by the server\u2019s <code>my.cnf</code> configuration file. You should check the last line of the output for a success message:</p> <pre><code>innobackupex: Finished copying back files.\n150318 11:08:13  innobackupex: completed OK!\n</code></pre>"},{"location":"innobackupex/encrypted_backups_innobackupex.html#other-reading","title":"Other Reading","text":"<ul> <li>The Libgcrypt Reference Manual</li> </ul>"},{"location":"innobackupex/how_innobackupex_works.html","title":"How innobackupex Works","text":"<p>From Percona XtraBackup version 2.3 <code>innobackupex</code> is has been rewritten in C and set up as a symlink to the <code>xtrabackup</code>. innobackupex supports all features and syntax as 2.2 version did, but it is now deprecated and will be removed in next major release. Syntax for new features will not be added to the innobackupex, only to the xtrabackup.</p> <p>The following describes the rationale behind <code>innobackupex</code> actions.</p>"},{"location":"innobackupex/how_innobackupex_works.html#making-a-backup","title":"Making a Backup","text":"<p>If no mode is specified, innobackupex will assume the backup mode.</p> <p>By default, it runs <code>xtrabackup</code> and lets it copy the InnoDB data files. When <code>xtrabackup</code> finishes that, innobackupex sees it create the <code>xtrabackup_suspended_2</code> file and executes <code>FLUSH TABLES WITH READ LOCK</code>. <code>xtrabackup</code> will use Backup locks where available as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code>. This feature is available in Percona Server 5.6+. Percona XtraBackup uses this automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables. Then it begins copying the rest of the files.</p> <p>innobackupex will then check MySQL variables to determine which features are supported by server. Special interest are backup locks, changed page bitmaps, GTID mode, etc. If everything goes well, the binary is started as a child process.</p> <p>innobackupex will wait for replicas in a replication setup if the option <code>innobackupex --safe-slave-backup</code> is set and will flush all tables with READ LOCK, preventing all MyISAM tables from writing (unless option <code>innobackupex --no-lock</code> is specified).</p> <p>Note</p> <p>Locking is done only for MyISAM and other non-InnoDB tables, and only after Percona XtraBackup is finished backing up all InnoDB/XtraDB data and logs. Percona XtraBackup will use <code>backup locks</code> where available as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code>. This feature is available in Percona Server for MySQL 5.6+. Percona XtraBackup uses this automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p> <p>Once this is done, the backup of the files will begin. It will backup <code>.frm</code>, <code>.MRG</code>, <code>.MYD</code>, <code>.MYI</code>, <code>.TRG</code>, <code>.TRN</code>, <code>.ARM</code>, <code>.ARZ</code>, <code>.CSM</code>, <code>.CSV</code>, <code>.par</code>, and <code>.opt</code> files.</p> <p>When all the files are backed up, it resumes <code>ibbackup</code> and wait until it finishes copying the transactions done while the backup was done. Then, the tables are unlocked, the replica is started (if the option <code>innobackupex --safe-slave-backup</code> was used) and the connection with the server is closed. Then, it removes the <code>xtrabackup_suspended_2</code> file and permits <code>xtrabackup</code> to exit.</p> <p>It will also create the following files in the directory of the backup:</p> <p><code>xtrabackup_checkpoints</code></p> <pre><code>containing the `LSN` and the type of backup;\n</code></pre> <p><code>xtrabackup_binlog_info</code></p> <pre><code>containing the position of the binary log at the moment of backing up;\n</code></pre> <p><code>xtrabackup_binlog_pos_innodb</code></p> <pre><code>containing the position of the binary log at the moment of backing up relative to *InnoDB* transactions;\n</code></pre> <p><code>xtrabackup_slave_info</code></p> <pre><code>containing the MySQL binlog position of the source server in a replication setup via `SHOW SLAVE STATUS` if the innobackupex \u2013slave-info option is passed;\n</code></pre> <p><code>backup-my.cnf</code></p> <pre><code>containing only the my.cnf options required for the backup. For example, innodb_data_file_path, innodb_log_files_in_group, innodb_log_file_size, innodb_fast_checksum, innodb_page_size, innodb_log_block_size;\n</code></pre> <p><code>xtrabackup_binary</code></p> <pre><code>containing the binary used for the backup;\n</code></pre> <p><code>mysql-stderr</code></p> <pre><code>containing the `STDERR` of mysqld during the process and\n</code></pre> <p><code>mysql-stdout</code></p> <pre><code>containing the `STDOUT` of the server.\n</code></pre> <p>Finally, the binary log position will be printed to <code>STDERR</code> and innobackupex will exit returning 0 if all went OK.</p> <p>Note that the <code>STDERR</code> of innobackupex is not written in any file. You will have to redirect it to a file, e.g., <code>innobackupex OPTIONS 2&gt; backupout.log</code>.</p>"},{"location":"innobackupex/how_innobackupex_works.html#restoring-a-backup","title":"Restoring a backup","text":"<p>To restore a backup with innobackupex the <code>innobackupex --copy-back</code> option must be used.</p> <p>innobackupex will read from the <code>my.cnf</code> the variables <code>datadir</code>, <code>innodb_data_home_dir</code>, <code>innodb_data_file_path</code>, <code>innodb_log_group_home_dir</code> and check that the directories exist.</p> <p>It will copy the MyISAM tables, indexes, etc. (<code>.frm</code>, <code>.MRG</code>, <code>.MYD</code>, <code>.MYI</code>, <code>.TRG</code>, <code>.TRN</code>, <code>.ARM</code>, <code>.ARZ</code>, <code>.CSM</code>, <code>.CSV</code>, <code>par</code> and <code>.opt</code> files) first, InnoDB tables and indexes next and the log files at last. It will preserve file\u2019s attributes when copying them, you may have to change the files\u2019 ownership to <code>mysql</code> before starting the database server, as they will be owned by the user who created the backup.</p> <p>Alternatively, the <code>innobackupex --move-back</code> option may be used to restore a backup. This option is similar to <code>innobackupex --copy-back</code> with the only difference that instead of copying files it moves them to their target locations. As this option removes backup files, it must be used with caution. It is useful in cases when there is not enough free disk space to hold both data files and their backup copies.</p>"},{"location":"innobackupex/improved_ftwrl.html","title":"Improved <code>FLUSH TABLES WITH READ LOCK</code> handling","text":"<p>When taking backups, <code>FLUSH TABLES WITH READ LOCK</code> is being used before the non-InnoDB files are being backed up to ensure backup is being consistent. <code>FLUSH TABLES WITH READ LOCK</code> can be run even though there may be a running query that has been executing for hours. In this case everything will be locked up in <code>Waiting for table flush</code> or <code>Waiting for master to send event</code> states. Killing the <code>FLUSH TABLES WITH READ LOCK</code> does not correct this issue either. In this case the only way to get the server operating normally again is to kill off the long running queries that blocked it to begin with. This means that if there are long running queries <code>FLUSH TABLES WITH READ LOCK</code> can get stuck, leaving server in read-only mode until waiting for these queries to complete.</p> <p>Note</p> <p>All described in this section has no effect when backup locks are used. Percona XtraBackup will use Backup locks where available as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code>. This feature is available in Percona Server for MySQL 5.6+. Percona XtraBackup uses this automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p> <p>In order to prevent this from happening two things have been implemented:</p> <ul> <li> <p>innobackupex can wait for a good moment to issue the global lock.</p> </li> <li> <p>innobackupex can kill all or only SELECT queries which are preventing the global lock from being acquired</p> </li> </ul>"},{"location":"innobackupex/improved_ftwrl.html#waiting-for-queries-to-finish","title":"Waiting for queries to finish","text":"<p>Good moment to issue a global lock is the moment when there are no long queries running. But waiting for a good moment to issue the global lock for extended period of time isn\u2019t always good approach, as it can extend the time needed for backup to take place. To prevent innobackupex from waiting to issue <code>FLUSH TABLES WITH READ LOCK</code> for too long, new option has been implemented: innobackupex \u2013ftwrl-wait-timeout option can be used to limit the waiting time. If the good moment to issue the lock did not happen during this time, innobackupex will give up and exit with an error message and backup will not be taken. Zero value for this option turns off the feature (which is default).</p> <p>Another possibility is to specify the type of query to wait on. In this case <code>innobackupex --ftwrl-wait-query-type</code>. Possible values are <code>all</code> and <code>update</code>. When <code>all</code> is used innobackupex will wait for all long running queries (execution time longer than allowed by <code>innobackupex --ftwrl-wait-threshold</code>) to finish before running the <code>FLUSH TABLES WITH READ LOCK</code>. When <code>update</code> is used innobackupex will wait on <code>UPDATE/ALTER/REPLACE/INSERT</code> queries to finish.</p> <p>Although time needed for specific query to complete is hard to predict, we can assume that queries that are running for a long time already will likely not be completed soon, and queries which are running for a short time will likely be completed shortly. innobackupex can use the value of <code>innobackupex --ftwrl-wait-threshold</code> option to specify which query is long running and will likely block global lock for a while. In order to use this option xtrabackup user should have <code>PROCESS</code> and <code>SUPER</code> privileges.</p>"},{"location":"innobackupex/improved_ftwrl.html#killing-the-blocking-queries","title":"Killing the blocking queries","text":"<p>Second option is to kill all the queries which prevent global lock from being acquired. In this case all the queries which run longer than <code>FLUSH TABLES WITH READ LOCK</code> are possible blockers. Although all queries can be killed, additional time can be specified for the short running queries to complete. This can be specified by <code>innobackupex --kill-long-queries-timeout</code> option. This option specifies the time for queries to complete, after the value is reached, all the running queries will be killed. Default value is zero, which turns this feature off.</p> <p><code>innobackupex --kill-long-query-type</code> option can be used to specify all or only <code>SELECT</code> queries that are preventing global lock from being acquired. In order to use this option xtrabackup user should have <code>PROCESS</code> and <code>SUPER</code> privileges.</p>"},{"location":"innobackupex/improved_ftwrl.html#options-summary","title":"Options summary","text":"<ul> <li> <p><code>innobackupex --ftwrl-wait-timeout</code> (seconds) - how long to wait for a good moment. Default is 0, not to wait.</p> </li> <li> <p><code>innobackupex --ftwrl-wait-query-type</code> - which long queries should be finished before <code>FLUSH TABLES WITH READ LOCK</code> is run. Default is all.</p> </li> <li> <p><code>innobackupex --ftwrl-wait-threshold</code> (seconds) - how long query should be running before we consider it long running and potential blocker of global lock.</p> </li> <li> <p><code>innobackupex --kill-long-queries-timeout</code> (seconds) - how many time we give for queries to complete after <code>FLUSH TABLES WITH READ LOCK</code> is issued before start to kill. Default if <code>0</code>, not to kill.</p> </li> <li> <p><code>innobackupex --kill-long-query-type</code> - which queries should be killed once <code>kill-long-queries-timeout</code> has expired.</p> </li> </ul>"},{"location":"innobackupex/improved_ftwrl.html#example","title":"Example","text":"<p>Running the innobackupex with the following options will cause innobackupex to spend no longer than 3 minutes waiting for all queries older than 40 seconds to complete.</p> <pre><code>$ innobackupex --ftwrl-wait-threshold=40 --ftwrl-wait-query-type=all --ftwrl-wait-timeout=180 --kill-long-queries-timeout=20 --kill-long-query-type=all /data/backups/\n</code></pre> <p>After <code>FLUSH TABLES WITH READ LOCK</code> is issued, innobackupex will wait 20 seconds for lock to be acquired. If lock is still not acquired after 20 seconds, it will kill all queries which are running longer that the <code>FLUSH TABLES WITH READ LOCK</code>.</p>"},{"location":"innobackupex/incremental_backups_innobackupex.html","title":"Incremental Backups with innobackupex","text":"<p>As not all information changes between each backup, the incremental backup strategy uses this to reduce the storage needs and the duration of making a backup.</p> <p>This can be done because each InnoDB page has a log sequence number, LSN, which acts as a version number of the entire database. Every time the database is modified, this number gets incremented.</p> <p>An incremental backup copies all pages since a specific LSN.</p> <p>Once the pages have been put together in their respective order, applying the logs will recreate the process that affected the database, yielding the data at the moment of the most recently created backup.</p>"},{"location":"innobackupex/incremental_backups_innobackupex.html#creating-an-incremental-backups-with-innobackupex","title":"Creating an Incremental Backups with innobackupex","text":"<p>First, you need to make a full backup as the BASE for subsequent incremental backups:</p> <pre><code>$ innobackupex /data/backups\n</code></pre> <p>This will create a timestamped directory in <code>/data/backups</code>. Assuming that the backup is done last day of the month, <code>BASEDIR</code> would be <code>/data/backups/2013-03-31_23-01-18</code>, for example.</p> <p>Note</p> <p>You can use the <code>innobackupex --no-timestamp</code> option to override this behavior and the backup will be created in the given directory.</p> <p>If you check at the <code>xtrabackup-checkpoints</code> file in <code>BASE-DIR</code>, you should see something like:</p> <pre><code>backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 1626007\nlast_lsn = 1626007\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>To create an incremental backup the next day, use <code>innobackupex --incremental</code> and provide the BASEDIR:</p> <pre><code>$ innobackupex --incremental /data/backups --incremental-basedir=BASEDIR\n</code></pre> <p>Another timestamped directory will be created in <code>/data/backups</code>, in this example, <code>/data/backups/2013-04-01_23-01-18</code> containing the incremental backup. We will call this <code>INCREMENTAL-DIR-1</code>.</p> <p>If you check at the <code>xtrabackup-checkpoints</code> file in <code>INCREMENTAL-DIR-1</code>, you should see something like:</p> <pre><code>backup_type = incremental\nfrom_lsn = 1626007\nto_lsn = 4124244\nlast_lsn = 4124244\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>Creating another incremental backup the next day will be analogous, but this time the previous incremental one will be base:</p> <pre><code>$ innobackupex --incremental /data/backups --incremental-basedir=INCREMENTAL-DIR-1\n</code></pre> <p>Yielding (in this example) <code>/data/backups/2013-04-02_23-01-18</code>. We will use <code>INCREMENTAL-DIR-2</code> instead for simplicity.</p> <p>At this point, the xtrabackup-checkpoints file in <code>INCREMENTAL-DIR-2</code> should contain something like:</p> <pre><code>backup_type = incremental\nfrom_lsn = 4124244\nto_lsn = 6938371\nlast_lsn = 7110572\ncompact = 0\nrecover_binlog_info = 1\n</code></pre> <p>As it was said before, an incremental backup only copy pages with a LSN greater than a specific value. Providing the LSN would have produced directories with the same data inside:</p> <pre><code>innobackupex --incremental /data/backups --incremental-lsn=4124244\ninnobackupex --incremental /data/backups --incremental-lsn=6938371\n</code></pre> <p>This is a very useful way of doing an incremental backup, since not always the base or the last incremental will be available in the system.</p> <p>Warning</p> <p>This procedure only affects XtraDB or InnoDB-based tables. Other tables with a different storage engine, e.g. MyISAM, will be copied entirely each time an incremental backup is performed.</p>"},{"location":"innobackupex/incremental_backups_innobackupex.html#preparing-an-incremental-backup-with-innobackupex","title":"Preparing an Incremental Backup with innobackupex","text":"<p>Preparing incremental backups is a bit different than full backups. This is, perhaps, the stage where more attention is needed:</p> <ul> <li> <p>First, only the committed transactions must be replayed on each backup. This will merge the base full backup with the incremental ones.</p> </li> <li> <p>Then, the uncommitted transaction must be rolled back in order to have ready-to-use backup.</p> </li> </ul> <p>If you replay the committed transactions and rollback the uncommitted ones on the base backup, you will not be able to add the incremental ones. If you do this on an incremental one, you won\u2019t be able to add data from that moment and the remaining increments.</p> <p>Having this in mind, the procedure is very straight-forward using the <code>innobackupex --redo-only</code> option, starting with the base backup:</p> <pre><code>$ innobackupex --apply-log --redo-only BASE-DIR\n</code></pre> <p>You should see an output similar to:</p> <pre><code>160103 22:00:12 InnoDB: Shutdown completed; log sequence number 4124244\n160103 22:00:12 innobackupex: completed OK!\n</code></pre> <p>Then, the first incremental backup can be applied to the base backup, by issuing:</p> <pre><code>$ innobackupex --apply-log --redo-only BASE-DIR \n--incremental-dir=INCREMENTAL-DIR-1\n</code></pre> <p>You should see an output similar to the previous one but with corresponding LSN:</p> <pre><code>160103 22:08:43 InnoDB: Shutdown completed; log sequence number 6938371\n160103 22:08:43 innobackupex: completed OK!\n</code></pre> <p>If no <code>innobackupex --incremental-dir</code> is set, innobackupex will use the most recent subdirectory created in the basedir.</p> <p>At this moment, <code>BASE-DIR</code> contains the data up to the moment of the first incremental backup. Note that the full data will always be in the directory of the base backup, as we are appending the increments to it.</p> <p>Repeat the procedure with the second one:</p> <pre><code>$ innobackupex --apply-log BASE-DIR --incremental-dir=INCREMENTAL-DIR-2\n</code></pre> <p>If the completed OK! message was shown, the final data will be in the base backup directory, <code>BASE-DIR</code>.</p> <p>Note</p> <p><code>innobackupex --redo-only</code> should be used when merging all incrementals except the last one. That\u2019s why the previous line doesn\u2019t contain the <code>innobackupex --redo-only</code> option. Even if the <code>innobackupex --redo-only</code> was used on the last step, backup would still be consistent but in that case server would perform the rollback phase.</p> <p>You can use this procedure to add more increments to the base, as long as you do it in the chronological order that the backups were done. If you merge the incremental backups in the wrong order, the backup will be useless. If you  have doubts about the order that they must be applied, you can check the file <code>xtrabackup_checkpoints</code> at the directory of each one, as shown in the beginning of this section.</p> <p>Once you merge the base with all the increments, you can prepare it to roll back the uncommitted transactions:</p> <pre><code>$ innobackupex --apply-log BASE-DIR\n</code></pre> <p>Now your backup is ready to be used immediately after restoring it. This preparation step is optional. However, if you restore without doing the prepare, the database server will begin to rollback uncommitted transactions, the same work it would do if a crash had occurred. This results in delay as the database server starts, and you can avoid the delay if you do the prepare.</p> <p>Note that the <code>iblog\\*</code> files will not be created by innobackupex, if you want them to be created, use <code>xtrabackup --prepare</code> on the directory. Otherwise, the files will be created by the server once started.</p>"},{"location":"innobackupex/incremental_backups_innobackupex.html#restoring-incremental-backups-with-innobackupex","title":"Restoring Incremental Backups with innobackupex","text":"<p>After preparing the incremental backups, the base directory contains the same data as the full backup. For restoring it, you can use the <code>xtrabackup --copy-back</code> parameter:</p> <pre><code>$ xtrabackup --copy-back --target-dir=BASE-DIR\n</code></pre> <p>If the incremental backup was created using the <code>xtrabackup --compress</code> option, then you need to run <code>xtrabackup --decompress</code> followed by <code>xtrabackup --copy-back</code>.</p> <pre><code>$ xtrabackup --decompress --target-dir=BASE-DIR\n$ xtrabackup --copy-back --target-dir=BASE-DIR\n</code></pre> <p>You may have to change the ownership as detailed on Restoring a Full Backup with innobackupex.</p>"},{"location":"innobackupex/incremental_backups_innobackupex.html#incremental-streaming-backups-using-xbstream-and-tar","title":"Incremental Streaming Backups using xbstream and tar","text":"<p>Incremental streaming backups can be performed with the xbstream streaming option. Currently backups are packed in custom xbstream format. With this feature, you need to take a BASE backup as well.</p>"},{"location":"innobackupex/incremental_backups_innobackupex.html#taking-a-base-backup","title":"Taking a base backup","text":"<pre><code>$ innobackupex /data/backups\n</code></pre>"},{"location":"innobackupex/incremental_backups_innobackupex.html#taking-a-local-backup","title":"Taking a local backup","text":"<pre><code>$ innobackupex --incremental --incremental-lsn=LSN-number --stream=xbstream ./ &gt; incremental.xbstream\n</code></pre>"},{"location":"innobackupex/incremental_backups_innobackupex.html#unpacking-the-backup","title":"Unpacking the backup","text":"<pre><code>$ xbstream -x &lt; incremental.xbstream\n</code></pre>"},{"location":"innobackupex/incremental_backups_innobackupex.html#taking-a-local-backup-and-streaming-it-to-the-remote-server-and-unpacking-it","title":"Taking a local backup and streaming it to the remote server and unpacking it","text":"<pre><code>$ innobackupex  --incremental --incremental-lsn=LSN-number --stream=xbstream ./ | \\\nssh user@hostname \" cat - | xbstream -x -C &gt; /backup-dir/\"\n</code></pre>"},{"location":"innobackupex/innobackupex_option_reference.html","title":"The innobackupex Option Reference","text":"<p>This page documents all the command-line options for the <code>innobackupex</code>.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#options","title":"Options","text":""},{"location":"innobackupex/innobackupex_option_reference.html#-apply-log","title":"\u2013apply-log","text":"<p>Prepare a backup in <code>BACKUP-DIR</code> by applying the transaction log file named <code>xtrabackup_logfile</code> located in the same directory. Also, create new transaction logs. The InnoDB configuration is read from the file <code>backup-my.cnf</code> created by innobackupex when the backup was made. <code>innobackupex --apply-log</code> uses InnoDB configuration from <code>backup-my.cnf</code> by default, or from <code>--defaults-file</code>, if specified. InnoDB configuration in this context means server variables that affect data format, i.e. <code>innodb_page_size</code>, <code>innodb_log_block_size</code>, etc. Location-related variables, like <code>innodb_log_group_home_dir</code> or <code>innodb_data_file_path</code> are always ignored by <code>--apply-log</code>, so preparing a backup always works with data files from the backup directory, rather than any external ones.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-backup-locks","title":"\u2013backup-locks","text":"<p>This option controls if backup locks should be used instead of <code>FLUSH TABLES WITH READ LOCK</code> on the backup stage. The option has no effect when backup locks are not supported by the server. This option is enabled by default, disable with <code>--no-backup-locks</code>.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-no-backup-locks","title":"\u2013no-backup-locks","text":"<p>Explicity disables the option <code>\u2013-backup-locks</code> which is enabled by default.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-close-files","title":"\u2013close-files","text":"<p>Do not keep files opened. This option is passed directly to xtrabackup. When xtrabackup opens tablespace it normally doesn\u2019t close its file handle in order to handle the DDL operations correctly. However, if the number of tablespaces is really huge and can not fit into any limit, there is an option to close file handles once they are no longer accessed. Percona XtraBackup can produce inconsistent backups with this option enabled. Use at your own risk.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-compress","title":"\u2013compress","text":"<p>This option instructs xtrabackup to compress backup copies of InnoDB data files. It is passed directly to the xtrabackup child process. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-compress-threads","title":"\u2013compress-threads=","text":"<p>This option specifies the number of worker threads that will be used for parallel compression. It is passed directly to the xtrabackup child process. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-compress-chunk-size","title":"\u2013compress-chunk-size=","text":"<p>This option specifies the size of the internal working buffer for each compression thread, measured in bytes. It is passed directly to the xtrabackup child process. The default value is 64K. See the <code>xtrabackup</code> documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-copy-back","title":"\u2013copy-back","text":"<p>Copy all the files in a previously made backup from the backup directory to their original locations. Percona XtraBackup <code>innobackupex --copy-back</code> option will not copy over existing files unless <code>innobackupex --force-non-empty-directories</code> option is specified.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-databaseslist","title":"\u2013databases=LIST","text":"<p>This option specifies the list of databases that innobackupex should back up. The option accepts a string argument or path to file that contains the list of databases to back up. The list is of the form \u201cdatabasename1[.table_name1] databasename2[.table_name2] \u2026\u201d. If this option is not specified, all databases containing MyISAM and InnoDB tables will be backed up. Please make sure that \u2013databases contains all of the InnoDB databases and tables, so that all of the innodb.frm files are also backed up. In case the list is very long, this can be specified in a file, and the full path of the file can be specified instead of the list. (See option \u2013tables-file.)</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-decompress","title":"\u2013decompress","text":"<p>Decompresses all files with the .qp extension in a backup previously made with the <code>innobackupex --compress</code> option. The <code>innobackupex --parallel</code> option will allow multiple files to be decrypted and/or decompressed simultaneously. In order to decompress, the qpress utility MUST be installed and accessible within the path. Percona XtraBackup doesn\u2019t automatically remove the compressed files. In order to clean up the backup directory users should remove the <code>\\*.qp</code> files manually.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-decryptencryption-algorithm","title":"\u2013decrypt=ENCRYPTION-ALGORITHM","text":"<p>Decrypts all files with the .xbcrypt extension in a backup previously made with \u2013encrypt option. The <code>innobackupex --parallel</code> option will allow multiple files to be decrypted and/or decompressed simultaneously.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-defaults-filemycnf","title":"\u2013defaults-file=[MY.CNF]","text":"<p>This option accepts a string argument that specifies what file to read the default MySQL options from. Must be given as the first option on the command-line.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-defaults-extra-filemycnf","title":"\u2013defaults-extra-file=[MY.CNF]","text":"<p>This option specifies what extra file to read the default MySQL options from before the standard defaults-file. Must be given as the first option on the command-line.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-defaults-groupgroup-name","title":"\u2013defaults-group=GROUP-NAME","text":"<p>This option accepts a string argument that specifies the group which should be read from the configuration file. This is needed if you use mysqld_multi. This can also be used to indicate groups other than mysqld and xtrabackup.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-encryptencryption_algorithm","title":"\u2013encrypt=ENCRYPTION_ALGORITHM","text":"<p>This option instructs xtrabackup to encrypt backup copies of InnoDB data files using the algorithm specified in the ENCRYPTION_ALGORITHM. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p> <p>Currently, the following algorithms are supported: <code>AES128</code>, <code>AES192</code> and <code>AES256</code>.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-encrypt-keyencryption_key","title":"\u2013encrypt-key=ENCRYPTION_KEY","text":"<p>This option instructs xtrabackup to use the given proper length encryption key as the ENCRYPTION_KEY when using the \u2013encrypt option. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p> <p>It is not recommended to use this option where there is uncontrolled access to the machine as the command line and thus the key can be viewed as part of the process info.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-encrypt-key-fileencryption_key_file","title":"\u2013encrypt-key-file=ENCRYPTION_KEY_FILE","text":"<p>This option instructs xtrabackup to use the encryption key stored in the given ENCRYPTION_KEY_FILE when using the \u2013encrypt option. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p> <p>The file must be a simple binary (or text) file that contains exactly the key to be used.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-encrypt-threads","title":"\u2013encrypt-threads=","text":"<p>This option specifies the number of worker threads that will be used for parallel encryption. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-encrypt-chunk-size","title":"\u2013encrypt-chunk-size=","text":"<p>This option specifies the size of the internal working buffer for each encryption thread, measured in bytes. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-export","title":"\u2013export","text":"<p>This option is passed directly to <code>xtrabackup --export</code> option. It enables exporting individual tables for import into another server. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-extra-lsndirdirectory","title":"\u2013extra-lsndir=DIRECTORY","text":"<p>This option accepts a string argument that specifies the directory in which to save an extra copy of the <code>xtrabackup_checkpoints</code> file. It is passed directly to xtrabackup\u2019s <code>innobackupex --extra-lsndir</code> option. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-force-non-empty-directories","title":"\u2013force-non-empty-directories","text":"<p>When specified, it makes <code>innobackupex --copy-back</code> option or <code>innobackupex --move-back</code> option transfer files to non-empty directories. No existing files will be overwritten. If \u2013copy-back or \u2013move-back has to copy a file from the backup directory which already exists in the destination directory, it will still fail with an error.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-galera-info","title":"\u2013galera-info","text":"<p>This options creates the <code>xtrabackup_galera_info</code> file which contains the local node state at the time of the backup. Option should be used when performing the backup of Percona-XtraDB-Cluster. Has no effect when backup locks are used to create the backup.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-help","title":"\u2013help","text":"<p>This option displays a help screen and exits.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-historyname","title":"\u2013history=NAME","text":"<p>This option enables the tracking of backup history in the <code>PERCONA_SCHEMA.xtrabackup_history</code> table. An optional history series name may be specified that will be placed with the history record for the current backup being taken.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-hosthost","title":"\u2013host=HOST","text":"<p>This option accepts a string argument that specifies the host to use when connecting to the database server with TCP/IP. It is passed to the mysql child process without alteration. See <code>mysql --help</code> for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-ibbackupibbackup-binary","title":"\u2013ibbackup=IBBACKUP-BINARY","text":"<p>This option specifies which xtrabackup binary should be used. The option accepts a string argument. IBBACKUP-BINARY should be the command used to run Percona XtraBackup. The option can be useful if the xtrabackup binary is not in your search path or working directory. If this option is not specified, innobackupex attempts to determine the binary to use automatically.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-includeregexp","title":"\u2013include=REGEXP","text":"<p>This option is a regular expression to be matched against table names in <code>databasename.tablename</code> format. It is passed directly to xtrabackup\u2019s <code>xtrabackup --tables</code> option. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-incremental","title":"\u2013incremental","text":"<p>This option tells xtrabackup to create an incremental backup, rather than a full one. It is passed to the xtrabackup child process. When this option is specified, either <code>innobackupex --incremental-lsn</code> or <code>innobackupex --incremental-basedir</code> can also be given. If neither option is given, option <code>innobackupex --incremental-basedir</code> is passed to <code>xtrabackup</code> by default, set to the first timestamped backup directory in the backup base directory.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-incremental-basedirdirectory","title":"\u2013incremental-basedir=DIRECTORY","text":"<p>This option accepts a string argument that specifies the directory containing the full backup that is the base dataset for the incremental backup. It is used with the <code>innobackupex --incremental</code> option.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-incremental-dirdirectory","title":"\u2013incremental-dir=DIRECTORY","text":"<p>This option accepts a string argument that specifies the directory where the incremental backup will be combined with the full backup to make a new full backup. It is used with the <code>innobackupex --incremental</code> option.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-incremental-history-namename","title":"\u2013incremental-history-name=NAME","text":"<p>This option specifies the name of the backup series stored in the PERCONA_SCHEMA.xtrabackup_history history record to base an incremental backup on. Percona Xtrabackup will search the history table looking for the most recent (highest innodb_to_lsn), successful backup in the series and take the to_lsn value to use as the starting lsn for the incremental backup. This will be mutually exclusive with <code>innobackupex --incremental-history-uuid</code>, <code>innobackupex --incremental-basedir</code> and <code>innobackupex --incremental-lsn</code>. If no valid lsn can be found (no series by that name, no successful backups by that name) xtrabackup will return with an error. It is used with the <code>innobackupex --incremental</code> option.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-incremental-history-uuiduuid","title":"\u2013incremental-history-uuid=UUID","text":"<p>This option specifies the UUID of the specific history record stored in the PERCONA_SCHEMA.xtrabackup_history to base an incremental backup on. <code>innobackupex --incremental-history-name</code>, <code>innobackupex --incremental-basedir\\</code> and <code>innobackupex --incremental-lsn</code>. If no valid lsn can be found (no success record with that uuid) xtrabackup will return with an error. It is used with the <code>innobackupex --incremental</code> option.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-incremental-lsnlsn","title":"\u2013incremental-lsn=LSN","text":"<p>This option accepts a string argument that specifies the log sequence number (<code>LSN</code>) to use for the incremental backup. It is used with the <code>innobackupex --incremental</code> option. It is used instead of specifying <code>innobackupex --incremental-basedir</code>. For databases created by MySQL and Percona Server 5.0-series versions, specify the as two 32-bit integers in high:low format. For databases created in 5.1 and later, specify the LSN as a single 64-bit integer.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-kill-long-queries-timeoutseconds","title":"\u2013kill-long-queries-timeout=SECONDS","text":"<p>This option specifies the number of seconds innobackupex waits between starting <code>FLUSH TABLES WITH READ LOCK</code> and killing those queries that block it. Default is 0 seconds, which means innobackupex will not attempt to kill any queries. In order to use this option xtrabackup user should have <code>PROCESS</code> and <code>SUPER</code> privileges. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-kill-long-query-typeallselect","title":"\u2013kill-long-query-type=all|select","text":"<p>This option specifies which types of queries should be killed to unblock the global lock. Default is \u201call\u201d.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-ftwrl-wait-timeoutseconds","title":"\u2013ftwrl-wait-timeout=SECONDS","text":"<p>This option specifies time in seconds that innobackupex should wait for queries that would block <code>FLUSH TABLES WITH READ LOCK</code> before running it. If there are still such queries when the timeout expires, innobackupex terminates with an error. Default is 0, in which case innobackupex does not wait for queries to complete and starts <code>FLUSH TABLES WITH READ LOCK</code> immediately. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-ftwrl-wait-thresholdseconds","title":"\u2013ftwrl-wait-threshold=SECONDS","text":"<p>This option specifies the query run time threshold which is used by innobackupex to detect long-running queries with a non-zero value of <code>innobackupex \u2013ftwrl-wait-timeout</code>. <code>FLUSH TABLES WITH READ LOCK</code> is not started until such long-running queries exist. This option has no effect if \u2013ftwrl-wait-timeout is 0. Default value is 60 seconds. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-ftwrl-wait-query-typeallupdate","title":"\u2013ftwrl-wait-query-type=all|update","text":"<p>This option specifies which types of queries are allowed to complete before innobackupex will issue the global lock. Default is all.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-log-copy-interval","title":"\u2013log-copy-interval=","text":"<p>This option specifies time interval between checks done by log copying thread in milliseconds.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-move-back","title":"\u2013move-back","text":"<p>Move all the files in a previously made backup from the backup directory to their original locations. As this option removes backup files, it must be used with caution.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-no-lock","title":"\u2013no-lock","text":"<p>Use this option to disable table lock with <code>FLUSH TABLES WITH READ LOCK</code>. Use it only if ALL your tables are InnoDB and you DO NOT CARE about the binary log position of the backup. This option shouldn\u2019t be used if there are any <code>DDL</code> statements being executed or if any updates are happening on non-InnoDB tables (this includes the system MyISAM tables in the mysql database), otherwise it could lead to an inconsistent backup. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.  If you are considering to use <code>innobackupex --no-lock because</code> your backups are failing to acquire the lock, this could be because of incoming replication events preventing the lock from succeeding. Please try using <code>innobackupex --safe-slave-backup</code> to momentarily stop the replication replica thread, this may help the backup to succeed and you then don\u2019t need to resort to using this option.  <code>xtrabackup_binlog_info</code> is not created when \u2013no-lock option is used (because <code>SHOW MASTER STATUS</code> may be inconsistent), but under certain conditions <code>xtrabackup_binlog_pos_innodb</code> can be used instead to get consistent binlog coordinates as described in Working with Binary Logs.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-no-timestamp","title":"\u2013no-timestamp","text":"<p>This option prevents creation of a time-stamped subdirectory of the <code>BACKUP-ROOT-DIR</code> given on the command line. When it is specified, the backup is done in <code>BACKUP-ROOT-DIR</code> instead.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-no-version-check","title":"\u2013no-version-check","text":"<p>This option disables the version check. If you do not pass this option, the automatic version check is enabled implicitly when <code>xtrabackup</code> runs in the <code>--backup</code> mode. To disable the version check, explicitly pass the <code>--no-version-check</code> option when invoking <code>xtrabackup</code>.  When the automatic version check is enabled,|program| performs a version check against the server on the backup stage after creating a server connection. </p> <p><code>xtrabackup</code> sends the following information to the server:</p> <ul> <li> <p>MySQL flavour and version</p> </li> <li> <p>Operating system name</p> </li> <li> <p>Percona Toolkit version</p> </li> <li> <p>Perl version</p> </li> </ul> <p>Each piece of information has a unique identifier which is an MD5 hash value that Percona Toolkit uses to obtain statistics about how it is used. This value is a random UUID; no client information is either collected or stored.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-parallelnumber-of-threads","title":"\u2013parallel=NUMBER-OF-THREADS","text":"<p>This option accepts an integer argument that specifies the number of threads the <code>xtrabackup</code> child process should use to back up files concurrently.  Note that this option works on file level, that is, if you have several .ibd files, they will be copied in parallel. If your tables are stored together in a single tablespace file, it will have no effect. This option will allow multiple files to be decrypted and/or decompressed simultaneously. In order to decompress, the qpress utility MUST be installed and accessable within the path. This process will remove the original compressed/encrypted files and leave the results in the same location. It is passed directly to xtrabackup\u2019s <code>xtrabackup --parallel</code> option. See the <code>xtrabackup</code> documentation for details</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-passwordpassword","title":"\u2013password=PASSWORD","text":"<p>This option accepts a string argument specifying the password to use when connecting to the database. It is passed to the <code>mysql</code> child process without alteration. See <code>mysql --help</code> for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-portport","title":"\u2013port=PORT","text":"<p>This option accepts a string argument that specifies the port to use when connecting to the database server with TCP/IP. It is passed to the <code>mysql</code> child process. It is passed to the <code>mysql</code> child process without alteration. See <code>mysql --help</code> for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-rebuild-indexes","title":"\u2013rebuild-indexes","text":"<p>This option only has effect when used together with the <code>--apply-log &lt;innobackupex --apply-log&gt;</code> option and is passed directly to xtrabackup. When used, makes xtrabackup rebuild all secondary indexes after applying the log. This option is normally used to prepare compact backups. See the <code>xtrabackup</code> documentation for more information.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-rebuild-threadsnumber-of-threads","title":"\u2013rebuild-threads=NUMBER-OF-THREADS","text":"<p>This option only has effect when used together with the <code>innobackupex --apply-log</code> and <code>innobackupex --rebuild-indexes</code> option and is passed directly to xtrabackup. When used, xtrabackup processes tablespaces in parallel with the specified number of threads when rebuilding indexes. See the <code>xtrabackup</code> documentation for more information.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-redo-only","title":"\u2013redo-only","text":"<p>This option should be used when preparing the base full backup and when merging all incrementals except the last one. It is passed directly to xtrabackup\u2019s <code>xtrabackup --apply-log-only</code> option. This forces <code>xtrabackup</code> to skip the \u201crollback\u201d phase and do a \u201credo\u201d only. This is necessary if the backup will have incremental changes applied to it later. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-rsync","title":"\u2013rsync","text":"<p>Uses the <code>rsync</code> utility to optimize local file transfers. When this option is specified, <code>innobackupex</code> uses <code>rsync</code> to copy all non-InnoDB files instead of spawning a separate <code>cp</code> for each file, which can be much faster for servers with a large number of databases or tables.  This option cannot be used together with <code>innobackupex --stream</code>.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-safe-slave-backup","title":"\u2013safe-slave-backup","text":"<p>When specified, innobackupex will stop the replica SQL thread just before running <code>FLUSH TABLES WITH READ LOCK</code> and wait to start backup until <code>Slave_open_temp_tables</code> in <code>SHOW STATUS</code> is zero. If there are no open temporary tables, the backup will take place, otherwise the SQL thread will be started and stopped until there are no open temporary tables. The backup will fail if <code>Slave_open_temp_tables</code> does not become zero after <code>innobackupex --safe-slave-backup-timeout</code> seconds. The replica SQL thread will be restarted when the backup finishes.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-safe-slave-backup-timeoutseconds","title":"\u2013safe-slave-backup-timeout=SECONDS","text":"<p>How many seconds <code>innobackupex --safe-slave-backup</code> should wait for <code>Slave_open_temp_tables</code> to become zero. Defaults to 300 seconds.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-slave-info","title":"\u2013slave-info","text":"<p>This option is useful when backing up a replication replica server. It prints the binary log position and name of the source server. It also writes this information to the <code>xtrabackup_slave_info</code> file as a <code>CHANGE MASTER</code> command. A new replica for this source can be set up by starting a replica server on this backup and issuing a <code>CHANGE MASTER</code> command with the binary log position saved in the <code>xtrabackup_slave_info</code> file.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-socket","title":"\u2013socket","text":"<p>This option accepts a string argument that specifies the socket to use when connecting to the local database server with a UNIX domain socket. It is passed to the mysql child process without alteration. See <code>mysql --help</code> for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-streamstreamname","title":"\u2013stream=STREAMNAME","text":"<p>This option accepts a string argument that specifies the format in which to do the streamed backup. The backup will be done to <code>STDOUT</code> in the specified format. Currently, supported formats are <code>tar</code> and <code>xbstream</code>. Uses xbstream, which is available in Percona XtraBackup distributions. If you specify a path after this option, it will be interpreted as the value of <code>tmpdir</code></p>"},{"location":"innobackupex/innobackupex_option_reference.html#-tables-filefile","title":"\u2013tables-file=FILE","text":"<p>This option accepts a string argument that specifies the file in which there are a list of names of the form <code>database.table</code>, one per line. The option is passed directly to <code>xtrabackup</code> \u2018s <code>innobackupex --tables-file</code> option.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-throttle","title":"\u2013throttle=","text":"<p>This option limits the number of chunks copied per second. The chunk size is 10 MB. To limit the bandwidth to 10 MB/s, set the option to 1: <code>--throttle=1</code>.</p> <p>See also</p> <p>More information about how to throttle a backup Throttling Backups.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-tmpdirdirectory","title":"\u2013tmpdir=DIRECTORY","text":"<p>This option accepts a string argument that specifies the location where a temporary file will be stored. It may be used when <code>innobackupex --stream</code> is specified. For these options, the transaction log will first be stored to a temporary file, before streaming or copying to a remote host. This option specifies the location where that temporary file will be stored. If the option is not specified, the default is to use the value of <code>tmpdir</code> read from the server configuration. innobackupex is passing the tmpdir value specified in my.cnf as the <code>--target-dir</code> option to the xtrabackup binary. Both [mysqld] and [xtrabackup] groups are read from my.cnf. If there is tmpdir in both, then the value being used depends on the order of those group in my.cnf.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-use-memory","title":"\u2013use-memory=","text":"<p>This option accepts a string argument that specifies the amount of memory in bytes for <code>xtrabackup</code> to use for crash recovery while preparing a backup. Multiples are supported providing the unit (e.g. 1MB, 1M, 1GB, 1G). It is used only with the option <code>innobackupex --apply-log</code>. It is passed directly to xtrabackup\u2019s <code>xtrabackup --use-memory</code> option. See the xtrabackup documentation for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-useruser","title":"\u2013user=USER","text":"<p>This option accepts a string argument that specifies the user (i.e., the MySQL username used when connecting to the server) to login as, if that\u2019s not the current user. It is passed to the mysql child process without alteration. See <code>mysql --help</code> for details.</p>"},{"location":"innobackupex/innobackupex_option_reference.html#-version","title":"\u2013version","text":"<p>This option displays the innobackupex version and copyright notice and then exits.</p>"},{"location":"innobackupex/innobackupex_script.html","title":"The innobackupex Program","text":"<p>The innobackupex program is a symlink to the xtrabackup C program. It lets you perform point-in-time backups of InnoDB / XtraDB tables together with the schema definitions, MyISAM tables, and other portions of the server. In previous versions innobackupex was implemented as a Perl script.</p> <p>This manual section explains how to use innobackupex in detail.</p> <p>Warning</p> <p>The innobackupex program is deprecated. Please switch to xtrabackup.</p>"},{"location":"innobackupex/innobackupex_script.html#the-backup-cycle-full-backups","title":"The Backup Cycle - Full Backups","text":"<ul> <li> <p>Creating a Backup with innobackupex</p> </li> <li> <p>Preparing a Full Backup with innobackupex</p> </li> <li> <p>Restoring a Full Backup with innobackupex</p> </li> </ul>"},{"location":"innobackupex/innobackupex_script.html#other-types-of-backup","title":"Other Types of Backup","text":"<ul> <li> <p>Incremental Backups with innobackupex</p> </li> <li> <p>Partial Backups</p> </li> <li> <p>Encrypted Backups</p> </li> </ul>"},{"location":"innobackupex/innobackupex_script.html#advanced-features","title":"Advanced Features","text":"<ul> <li> <p>Streaming and Compressing Backups</p> </li> <li> <p>Taking Backups in Replication Environments</p> </li> <li> <p>Accelerating the backup process</p> </li> <li> <p>Throttling backups with innobackupex</p> </li> <li> <p>Restoring Individual Tables</p> </li> <li> <p>Point-In-Time recovery</p> </li> <li> <p>Improved <code>FLUSH TABLES WITH READ LOCK</code> handling</p> </li> <li> <p>Store backup history on the server</p> </li> </ul>"},{"location":"innobackupex/innobackupex_script.html#implementation","title":"Implementation","text":"<ul> <li>How innobackupex Works</li> </ul>"},{"location":"innobackupex/innobackupex_script.html#references","title":"References","text":"<ul> <li>The innobackupex Option Reference</li> </ul>"},{"location":"innobackupex/parallel_copy_ibk.html","title":"Accelerating the backup process","text":""},{"location":"innobackupex/parallel_copy_ibk.html#accelerating-with-innobackupex-parallel-copy-and-compress-threads","title":"Accelerating with <code>innobackupex --parallel</code> copy and <code>--compress-threads</code>","text":"<p>When performing a local backup or the streaming backup with xbstream option, multiple files can be copied concurrently by using the <code>innobackupex --parallel</code> option. This option specifies the number of threads created by xtrabackup to copy data files.</p> <p>To take advantage of this option either the multiple tablespaces option must be enabled (<code>innodb_file_per_table</code>) or the shared tablespace must be stored in multiple <code>ibdata</code> files with the <code>innodb_data_file_path</code> option. Having multiple files for the database (or splitting one into many) doesn\u2019t have a measurable impact on performance.</p> <p>As this feature is implemented at a file level, concurrent file transfer can sometimes increase I/O throughput when doing a backup on highly fragmented data files, due to the overlap of a greater number of random read requests. You should consider tuning the filesystem also to obtain the maximum performance (e.g. checking fragmentation).</p> <p>If the data is stored on a single file, this option will have no effect.</p> <p>To use this feature, simply add the option to a local backup, for example:</p> <pre><code>$ innobackupex --parallel=4 /path/to/backup\n</code></pre> <p>By using the xbstream in streaming backups you can additionally speed up the compression process by using the <code>innobackupex --compress-threads</code> option. This option specifies the number of threads created by xtrabackup for  for parallel data compression. The default value for this option is 1.</p> <p>To use this feature, simply add the option to a local backup, for example</p> <pre><code>$ innobackupex --stream=xbstream --compress --compress-threads=4 ./ &gt; backup.xbstream\n</code></pre> <p>Before applying logs, compressed files will need to be uncompressed.</p>"},{"location":"innobackupex/parallel_copy_ibk.html#accelerating-with-innobackupex-rsync","title":"Accelerating with <code>innobackupex --rsync</code>","text":"<p>In order to speed up the backup process and to minimize the time <code>FLUSH TABLES WITH READ LOCK</code> is blocking the writes, option <code>innobackupex --rsync</code> should be used. When this option is specified, innobackupex uses <code>rsync</code> to copy all non-InnoDB files instead of spawning a separate <code>cp</code> for each file, which can be much faster for servers with a large number of databases or tables. innobackupex will call the <code>rsync</code> twice, once before the <code>FLUSH TABLES WITH READ LOCK</code> and once during to minimize the time the read lock is being held. During the second <code>rsync</code> call, it will only synchronize the changes to non-transactional data (if any) since the first call performed before the <code>FLUSH TABLES WITH READ LOCK</code>. Note that Percona XtraBackup will use Backup locks where available as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code>. This feature is available in Percona Server for MySQL 5.6+. Percona XtraBackup uses this automatically to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p> <p>Note</p> <p>This option cannot be used together with the <code>innobackupex --stream</code> option.</p>"},{"location":"innobackupex/partial_backups_innobackupex.html","title":"Partial Backups","text":"<p>Percona XtraBackup features partial backups, which means that you may backup only some specific tables or databases. The tables you back up must be in separate tablespaces, as a result of being created or altered after you enabled the <code>innodb_file_per_table</code> option on the server.</p> <p>There is only one caveat about partial backups: do not copy back the prepared backup. Restoring partial backups should be done by importing the tables, not by using the traditional <code>innobackupex --copy-back</code> option. Although there are some scenarios where restoring can be done by copying back the files, this may be lead to database inconsistencies in many cases and it is not the recommended way to do it.</p>"},{"location":"innobackupex/partial_backups_innobackupex.html#creating-partial-backups","title":"Creating Partial Backups","text":"<p>There are three ways of specifying which part of the whole data will be backed up: regular expressions (<code>innobackupex --include</code>), enumerating the tables in a file (<code>innobackupex --tables-file</code>) or providing a list of databases (<code>innobackupex --databases</code>).</p>"},{"location":"innobackupex/partial_backups_innobackupex.html#using-innobackupex-include","title":"Using <code>innobackupex --include</code>","text":"<p>The regular expression provided to this will be matched against the fully qualified table name, including the database name, in the form <code>databasename.tablename</code>.</p> <p>For example,</p> <pre><code>$ innobackupex --include='^mydatabase[.]mytable' /path/to/backup\n</code></pre> <p>The command above will create a timestamped directory with the usual files that innobackupex creates, but only the data files related to the tables matched.</p> <p>Note that this option is passed to <code>xtrabackup --tables</code> and is matched against each table of each database, the directories of each database will be created even if they are empty.</p>"},{"location":"innobackupex/partial_backups_innobackupex.html#using-innobackupex-tables-file","title":"Using <code>innobackupex --tables-file</code>","text":"<p>The text file provided (the path) to this option can contain multiple table names, one per line, in the <code>databasename.tablename</code> format.</p> <p>For example,</p> <pre><code>$ echo \"mydatabase.mytable\" &gt; /tmp/tables.txt\n$ innobackupex --tables-file=/tmp/tables.txt /path/to/backup\n</code></pre> <p>The command above will create a timestamped directory with the usual files that innobackupex creates, but only containing the data-files related to the tables specified in the file.</p> <p>This option is passed to <code>xtrabackup --tables-file</code> and, unlike the <code>--tables &lt;xtrabackup \u2013tables&gt;</code> option, only directories of databases of the selected tables will be created.</p>"},{"location":"innobackupex/partial_backups_innobackupex.html#using-innobackupex-databases","title":"Using <code>innobackupex --databases</code>","text":"<p>This option accepts either a space-separated list of the databases and tables to backup - in the <code>databasename[.tablename]</code> form.</p> <p>For example,</p> <pre><code>$ innobackupex --databases=\"mydatabase.mytable mysql\" /path/to/backup\n</code></pre> <p>The command above will create a timestamped directory with the usual files that innobackupex creates, but only containing the datafiles related to <code>mytable</code> in the <code>mydatabase</code> directory and the <code>mysql</code> directory with the entire <code>mysql</code> database.</p> <p>The <code>--databases-file</code> option specifies the path to a text file which contains a case-sensitive list of databases and tables to be backed up. The file can contain the names of multiple databases and tables in a <code>databasename[.tablename]</code> format with one element for each line. Only the named databases and tables are backed up. The names must match exactly. There is no pattern matching or regular expression matching.</p>"},{"location":"innobackupex/partial_backups_innobackupex.html#preparing-partial-backups","title":"Preparing Partial Backups","text":"<p>For preparing partial backups, the procedure is analogous to restoring individual tables : apply the logs and use the <code>innobackupex --export</code> option:</p> <pre><code>$ innobackupex --apply-log --export /path/to/partial/backup\n</code></pre> <p>You may see warnings in the output about tables that don\u2019t exist. This is because InnoDB -based engines stores its data dictionary inside the tablespace files besides the <code>.frm</code> files. innobackupex will use xtrabackup to remove the missing tables (those who weren\u2019t selected in the partial backup) from the data dictionary in order to avoid future warnings or errors:</p> <pre><code>111225  0:54:06  InnoDB: Error: table 'mydatabase/mytablenotincludedinpartialb'\nInnoDB: in InnoDB data dictionary has tablespace id 6,\nInnoDB: but tablespace with that id or name does not exist. It will be removed from data dictionary.\n</code></pre> <p>You should also see the notification of the creation of a file needed for importing (.exp file) for each table included in the partial backup:</p> <pre><code>xtrabackup: export option is specified.\nxtrabackup: export metadata of table 'employees/departments' to file `.//departments.exp` (2 indexes)\nxtrabackup:     name=PRIMARY, id.low=80, page=3\nxtrabackup:     name=dept_name, id.low=81, page=4\n</code></pre> <p>Note that you can use the <code>innobackupex --export</code> option with <code>innobackupex --apply-log</code> to an already-prepared backup in order to create the <code>.exp</code> files.</p> <p>Finally, check for the confirmation message in the output:</p> <pre><code>111225 00:54:18  innobackupex: completed OK!\n</code></pre>"},{"location":"innobackupex/partial_backups_innobackupex.html#restoring-partial-backups","title":"Restoring Partial Backups","text":"<p>Restoring should be done by restoring individual tables in the partial backup to the server.</p> <p>It can also be done by copying back the prepared backup to a \u201cclean\u201d <code>datadir</code> (in that case, make sure to include the <code>mysql</code> database). System database can be created with:</p> <pre><code>$ sudo mysql_install_db --user=mysql\n</code></pre>"},{"location":"innobackupex/pit_recovery_ibk.html","title":"Point-In-Time recovery","text":"<p>Recovering up to particular moment in database\u2019s history can be done  with innobackupex and the binary logs of the server.</p> <p>Note that the binary log contains the operations that modified the database from a point in the past. You need a full <code>datadir</code> as a base, and then you can apply a series of operations from the binary log to make the data match what it was at the point in time you want.</p> <p>For taking the snapshot, we will use innobackupex for a full backup:</p> <pre><code>$ innobackupex /path/to/backup --no-timestamp\n</code></pre> <p>(the <code>innobackupex --no-timestamp</code> option is for convenience in this example) and we will prepare it to be ready for restoration:</p> <pre><code>$ innobackupex --apply-log /path/to/backup\n</code></pre> <p>For more details on these procedures, see Creating a Backup with innobackupex and Preparing a Full Backup with innobackupex.</p> <p>Now, suppose that time has passed, and you want to restore the database to a certain point in the past, having in mind that there is the constraint of the point where the snapshot was taken.</p> <p>To find out what is the situation of binary logging in the server, execute the following queries:</p> <p><pre><code>mysql&gt; SHOW BINARY LOGS;\n</code></pre> The result is similar to the following:</p> <pre><code>+------------------+-----------+\n| Log_name         | File_size |\n+------------------+-----------+\n| mysql-bin.000001 |       126 |\n| mysql-bin.000002 |      1306 |\n| mysql-bin.000003 |       126 |\n| mysql-bin.000004 |       497 |\n+------------------+-----------+\n</code></pre> <p>and</p> <p><pre><code>mysql&gt; SHOW MASTER STATUS;\n</code></pre> The result is similar to the following: <pre><code>+------------------+----------+--------------+------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |\n+------------------+----------+--------------+------------------+\n| mysql-bin.000004 |      497 |              |                  |\n+------------------+----------+--------------+------------------+\n</code></pre></p> <p>The first query will tell you which files contain the binary log and the second one which file is currently being used to record changes, and the current position within it. Those files are stored usually in the <code>datadir</code> (unless other location is specified when the server is started with the <code>--log-bin=</code> option).</p> <p>To find out the position of the snapshot taken, see the <code>xtrabackup_binlog_info</code> at the backup\u2019s directory:</p> <p><pre><code>$ cat /path/to/backup/xtrabackup_binlog_info\n</code></pre> The result is similar to the following:</p> <pre><code>mysql-bin.000003      57\n</code></pre> <p>This will tell you which file was used at moment of the backup for the binary log and its position. That position will be the effective one when you restore the backup:</p> <pre><code>$ innobackupex --copy-back /path/to/backup\n</code></pre> <p>As the restoration will not affect the binary log files (you may need to adjust file permissions, see Restoring a Full Backup with innobackupex), the next step is extracting the queries from the binary log with <code>mysqlbinlog</code> starting from the position of the snapshot and redirecting it to a file</p> <pre><code>$ mysqlbinlog /path/to/datadir/mysql-bin.000003 /path/to/datadir/mysql-bin.000004 \\\n--start-position=57 &gt; mybinlog.sql\n</code></pre> <p>Note that if you have multiple files for the binary log, as in the example, you have to extract the queries with one process, as shown above.</p> <p>Inspect the file with the queries to determine which position or date corresponds to the point-in-time wanted. Once determined, pipe it to the server. Assuming the point is <code>11-12-25 01:00:00</code>:</p> <pre><code>$ mysqlbinlog /path/to/datadir/mysql-bin.000003 /path/to/datadir/mysql-bin.000004 \\\n--start-position=57 --stop-datetime=\"11-12-25 01:00:00\" * mysql -u root -p\n</code></pre> <p>and the database will be rolled forward up to that Point-In-Time.</p>"},{"location":"innobackupex/preparing_a_backup_ibk.html","title":"Preparing a Full Backup with innobackupex","text":"<p>The purpose of the prepare stage is to perform any pending operations and make the data consistent. After creating a backup, for example, uncommitted transactions must be undone or log transactions must be replayed. After this stage has finished, the data is ready.</p> <p>To prepare a backup with innobackupex you have to use the <code>innobackupex --apply-log</code> option and full path to the backup directory as an argument:</p> <pre><code>$ innobackupex --apply-log /path/to/BACKUP-DIR\n</code></pre> <p>and check the last line of the output for a confirmation on the process:</p> <pre><code>150806 01:01:57  InnoDB: Shutdown completed; log sequence number 1609228\n150806 01:01:57  innobackupex: completed OK!\n</code></pre> <p>If it succeeded, innobackupex performed all operations needed, leaving the data ready to use immediately.</p>"},{"location":"innobackupex/preparing_a_backup_ibk.html#under-the-hood","title":"Under the hood","text":"<p>innobackupex started the prepare process by reading the configuration from the <code>backup-my.cnf</code> file in the backup directory.</p> <p>After that, innobackupex replayed the committed transactions in the log files (some transactions could have been done while the backup was being done) and rolled back the uncommitted ones. Once this is done, all the information lay in the tablespace (the InnoDB files), and the log files are re-created.</p> <p>This implies calling <code>innobackupex --apply-log</code> twice. More details of this process are shown in the xtrabackup section.</p> <p>Note that this preparation is not suited for incremental backups. If you perform it on the base of an incremental backup, you will not be able to \u201cadd\u201d the increments. See Incremental Backups with innobackupex.</p>"},{"location":"innobackupex/preparing_a_backup_ibk.html#other-options-to-consider","title":"Other options to consider","text":""},{"location":"innobackupex/preparing_a_backup_ibk.html#innobackupex-use-memory","title":"<code>innobackupex --use-memory</code>","text":"<p>The preparing process can be sped up by using more memory in it. It depends on the free or available <code>RAM</code> on your system, it defaults to <code>100MB</code>. In general, the more memory available to the process, the better. The amount of memory used in the process can be specified by multiples of bytes:</p> <pre><code>$ innobackupex --apply-log --use-memory=4G /path/to/BACKUP-DIR\n</code></pre>"},{"location":"innobackupex/replication_ibk.html","title":"Taking Backups in Replication Environments","text":"<p>There are options specific to back up from a replication replica.</p>"},{"location":"innobackupex/replication_ibk.html#innobackupex-slave-info","title":"<code>innobackupex --slave-info</code>","text":"<p>This option is useful when backing up a replication replica server. It prints the binary log position and name of the source server. It also writes this information to the <code>xtrabackup_slave_info</code> file as a <code>CHANGE MASTER</code> statement.</p> <p>This is useful for setting up a new replica for this source can be set up by starting a replica server on this backup and issuing the statement saved in the <code>xtrabackup_slave_info</code> file. More details of this procedure can be found in How to setup a replica for replication in 6 simple steps with Percona XtraBackup.</p>"},{"location":"innobackupex/replication_ibk.html#innobackupex-safe-slave-backup","title":"innobackupex \u2013safe-slave-backup","text":"<p>In order to assure a consistent replication state, this option stops the replica SQL thread and waits to start backing up until <code>Slave_open_temp_tables</code> in <code>SHOW STATUS</code> is zero. If there are no open temporary tables, the backup will take place, otherwise the SQL thread will be started and stopped until there are no open temporary tables. The backup will fail if <code>Slave_open_temp_tables</code> does not become zero after <code>innobackupex \u2013safe-slave-backup-timeout</code> seconds (defaults to 300 seconds). The replica SQL thread will be restarted when the backup finishes.</p> <p>Using this option is always recommended when taking backups from a replica server.</p> <p>Note</p> <p>Make sure your replica is a true replica of the source before using it as a source for backup. A good tool to validate a replica is pt-table-checksum.</p>"},{"location":"innobackupex/restoring_a_backup_ibk.html","title":"Restoring a Full Backup with innobackupex","text":"<p>For convenience, innobackupex has a <code>innobackupex --copy-back</code> option, which performs the restoration of a backup to the server\u2019s <code>datadir</code>:</p> <pre><code>$ innobackupex --copy-back /path/to/BACKUP-DIR\n</code></pre> <p>It will copy all the data-related files back to the server\u2019s <code>datadir</code>, determined by the server\u2019s <code>my.cnf</code> configuration file. You should check the last line of the output for a success message:</p> <pre><code>innobackupex: Finished copying back files.\n\n111225 01:08:13  innobackupex: completed OK!\n</code></pre> <p>Note</p> <p>The <code>datadir</code> must be empty; Percona XtraBackup <code>innobackupex --copy-back</code> option will not copy over existing files unless <code>innobackupex --force-non-empty-directories</code> option is specified. Also it is important to note that MySQL server needs to be shut down before restore is performed. You can\u2019t restore to a <code>datadir</code> of a running mysqld instance (except when importing a partial backup).</p> <p>As files\u2019 attributes will be preserved, in most cases you will need to change the files\u2019 ownership to <code>mysql</code> before starting the database server, as they will be owned by the user who created the backup:</p> <pre><code>$ chown -R mysql:mysql /var/lib/mysql\n</code></pre> <p>Also note that all of these operations will be done as the user calling innobackupex, you will need write permissions on the server\u2019s <code>datadir</code>.</p>"},{"location":"innobackupex/restoring_individual_tables_ibk.html","title":"Restoring Individual Tables","text":"<p>In server versions prior to 5.6, it is not possible to copy tables between servers by copying the files, even with <code>innodb_file_per_table</code>. However, with the Percona XtraBackup, you can export individual tables from any InnoDB database, and import them into Percona Server with XtraDB or MySQL 5.6 (The source doesn\u2019t have to be XtraDB or or MySQL 5.6, but the destination does). This only works on individual <code>.ibd</code> files, and cannot export a table that is not contained in its own <code>.ibd</code> file.</p> <p>Note</p> <p>If you\u2019re running Percona Server version older than 5.5.10-20.1, variable innodb_expand_import should be used instead of innodb_import_table_from_xtrabackup.</p>"},{"location":"innobackupex/restoring_individual_tables_ibk.html#exporting-tables","title":"Exporting tables","text":"<p>Exporting is done in the preparation stage, not at the moment of creating the backup. Once a full backup is created, prepare it with the <code>innobackupex --export</code> option:</p> <pre><code>$ innobackupex --apply-log --export /path/to/backup\n</code></pre> <p>This will create for each InnoDB with its own tablespace a file with <code>.exp</code> extension. An output of this procedure would contain:</p> <pre><code>..\nxtrabackup: export option is specified.\nxtrabackup: export metadata of table 'mydatabase/mytable' to file\n`./mydatabase/mytable.exp` (1 indexes)\n..\n</code></pre> <p>Now you should see a <code>.exp</code> file in the target directory:</p> <pre><code>$ find /data/backups/mysql/ -name export_test.*\n</code></pre> <p>The result should be similar to the following:</p> <pre><code>/data/backups/mysql/test/export_test.exp\n/data/backups/mysql/test/export_test.ibd\n/data/backups/mysql/test/export_test.cfg\n</code></pre> <p>These three files are all you need to import the table into a server running Percona Server for MySQL with XtraDB or MySQL 5.6.</p> <p>Note</p> <p>MySQL uses <code>.cfg</code> file which contains InnoDB dictionary dump in special format. This format is different from the <code>.exp</code> one which is used in XtraDB for the same purpose. Strictly speaking, a <code>.cfg</code> file is not required to import a tablespace to MySQL 5.6 or Percona Server for MySQL 5.6. A tablespace will be imported successfully even if it is from another server, but InnoDB will do schema validation if the corresponding <code>.cfg</code> file is present in the same directory.</p> <p>Each <code>.exp</code> (or <code>.cfg</code>)  file will be used for importing that table.</p> <p>Note</p> <p>InnoDB does a slow shutdown (i.e. full purge + change buffer merge) on \u2013export, otherwise the tablespaces wouldn\u2019t be consistent and thus couldn\u2019t be imported. All the usual performance considerations apply: sufficient buffer pool (i.e. <code>--use-memory</code>, 100MB by default) and fast enough storage, otherwise it can take a prohibitive amount of time for export to complete.</p>"},{"location":"innobackupex/restoring_individual_tables_ibk.html#importing-tables","title":"Importing tables","text":"<p>To import a table to other server, first create a new table with the same structure as the one that will be imported at that server:</p> <pre><code>OTHERSERVER|mysql&gt; CREATE TABLE mytable (...) ENGINE=InnoDB;\n</code></pre> <p>then discard its tablespace:</p> <pre><code>OTHERSERVER|mysql&gt; ALTER TABLE mydatabase.mytable DISCARD TABLESPACE;\n</code></pre> <p>Next, copy <code>mytable.ibd</code> and <code>mytable.exp</code> ( or <code>mytable.cfg</code> if importing to MySQL 5.6) files to database\u2019s home, and import its tablespace:</p> <pre><code>OTHERSERVER|mysql&gt; ALTER TABLE mydatabase.mytable IMPORT TABLESPACE;\n</code></pre> <p>Set the owner and group of the files:</p> <pre><code>$ chown -R mysql:mysql /datadir/db_name/table_name.*\n</code></pre> <p>After running this command, data in the imported table will be available.</p>"},{"location":"innobackupex/storing_history.html","title":"Store backup history on the server","text":"<p>Percona XtraBackup supports storing the backups history on the server. This feature was implemented in Percona XtraBackup 2.2. Storing backup history on the server was implemented to provide users with additional information about backups that are being taken. Backup history information will be stored in the PERCONA_SCHEMA.XTRABACKUP_HISTORY table.</p> <p>To use this feature three new innobackupex options have been implemented:</p> <ul> <li> <p><code>innobackupex --history</code> = : This option enables the history feature and allows the user to specify a backup series name that will be placed within the history record. <li> <p><code>innobackupex --incremental-history-name</code> = : This option allows an incremental backup to be made based on a specific history series by name. innobackupex will search the history table looking for the most recent (highest <code>to_lsn</code>) backup in the series and take the <code>to_lsn</code> value to use as it\u2019s starting lsn. This is mutually exclusive with <code>innobackupex --incremental-history-uuid</code>, <code>innobackupex --incremental-basedir</code> and <code>innobackupex --incremental-lsn</code> options. If no valid LSN can be found (no series by that name) innobackupex will return with an error. <li> <p><code>innobackupex --incremental-history-uuid</code> = : Allows an incremental backup to be made based on a specific history record identified by UUID. innobackupex will search the history table looking for the record matching UUID and take the <code>to_lsn</code> value to use as it\u2019s starting LSN. This options is mutually exclusive with <code>innobackupex --incremental-basedir</code>, <code>innobackupex --incremental-lsn</code> and <code>innobackupex --incremental-history-name</code> options. If no valid LSN can be found (no record by that UUID or missing <code>to_lsn</code>), innobackupex will return with an error. <p>Note</p> <p>Backup that\u2019s currently being performed will NOT exist in the xtrabackup_history table within the resulting backup set as the record will not be added to that table until after the backup has been taken.</p> <p>If you want access to backup history outside of your backup set in the case of some catastrophic event, you will need to either perform a <code>mysqldump</code>, partial backup or <code>SELECT</code> * on the history table after innobackupex completes and store the results with you backup set.</p>"},{"location":"innobackupex/storing_history.html#privileges","title":"Privileges","text":"<p>User performing the backup will need following privileges:</p> <ul> <li> <p><code>CREATE</code> privilege in order to create the PERCONA_SCHEMA.xtrabackup_history database and table.</p> </li> <li> <p><code>INSERT</code> privilege in order to add history records to the PERCONA_SCHEMA.xtrabackup_history table.</p> </li> <li> <p><code>SELECT</code> privilege in order to use <code>innobackupex --incremental-history-name</code> or <code>innobackupex --incremental-history-uuid</code> in order for the feature to look up the <code>innodb_to_lsn</code> values in the PERCONA_SCHEMA.xtrabackup_history table.</p> </li> </ul>"},{"location":"innobackupex/storing_history.html#percona_schemaxtrabackup_history-table","title":"PERCONA_SCHEMA.XTRABACKUP_HISTORY table","text":"<p>This table contains the information about the previous server backups. Information about the backups will only be written if the backup was taken with innobackupex \u2013history option.</p> Column Name Description uuid Unique backup id name User provided name of backup series. There may be multiple entries with the same name used to identify related backups in a series. tool_name Name of tool used to take backup tool_command Exact command line given to the tool with \u2013password and \u2013encryption_key obfuscated tool_version Version of tool used to take backup ibbackup_version Version of the xtrabackup binary used to take backup server_version Server version on which backup was taken start_time Time at the start of the backup end_time Time at the end of the backup lock_time Amount of time, in seconds, spent calling and holding locks for <code>FLUSH TABLES WITH READ LOCK</code> binlog_pos Binlog file and position at end of <code>FLUSH TABLES WITH READ LOCK</code> innodb_from_lsn LSN at beginning of backup which can be used to determine prior backups innodb_to_lsn LSN at end of backup which can be used as the starting lsn for the next incremental partial Is this a partial backup, if <code>N</code> that means that it\u2019s the full backup incremental Is this an incremental backup format Description of result format (<code>file</code>, <code>tar</code>, <code>xbstream</code>) compressed Is this a compressed backup encrypted Is this an encrypted backup"},{"location":"innobackupex/storing_history.html#limitations","title":"Limitations","text":"<ul> <li> <p><code>innobackupex --history</code> option must be specified only on the innobackupex command line and not within a configuration file in order to be effective.</p> </li> <li> <p><code>innobackupex --incremental-history-name</code> and <code>innobackupex --incremental-history-uuid</code> options must be specified only on the innobackupex command line and not within a configuration file in order to be effective.</p> </li> </ul>"},{"location":"innobackupex/streaming_backups_innobackupex.html","title":"Streaming and Compressing Backups","text":"<p>Streaming mode, supported by Percona XtraBackup, sends backup to <code>STDOUT</code> in special <code>tar</code> or xbstream format instead of copying files to the backup directory.</p> <p>This allows you to use other programs to filter the output of the backup, providing greater flexibility for storage of the backup. For example, compression is achieved by piping the output to a compression utility. One of the benefits of streaming backups and using Unix pipes is that the backups can be automatically encrypted.</p> <p>To use the streaming feature, you must use the <code>innobackupex --stream</code>, providing the format of the stream (<code>tar</code> or <code>xbstream</code> ) and where to store the temporary files:</p> <pre><code>$ innobackupex --stream=tar /tmp\n</code></pre> <p>innobackupex uses xbstream to stream all of the data files to <code>STDOUT</code>, in a special <code>xbstream</code> format. See The xbstream binary for details. After it finishes streaming all of the data files to <code>STDOUT</code>, it stops xtrabackup and streams the saved log file too.</p> <p>When compression is enabled, xtrabackup compresses all output data, except the meta and non-InnoDB files which are not compressed, using the specified compression algorithm. The only currently supported algorithm is <code>quicklz</code>. The resulting files have the qpress archive format, i.e. every *.qp file produced by xtrabackup is essentially a one-file qpress archive and can be extracted and uncompressed by the qpress file archiver which is available from Percona Software repositories.</p> <p>Using xbstream as a stream option, backups can be copied and compressed in parallel which can significantly speed up the backup process. In case backups were both compressed and encrypted, they\u2019ll need to decrypted first in order to be uncompressed.</p>"},{"location":"innobackupex/streaming_backups_innobackupex.html#examples-using-xbstream","title":"Examples using xbstream","text":"<p>Store the complete backup directly to a single file:</p> <pre><code>$ innobackupex --stream=xbstream /root/backup/ &gt; /root/backup/backup.xbstream\n</code></pre> <p>To stream and compress the backup:</p> <pre><code>$ innobackupex --stream=xbstream --compress /root/backup/ &gt; /root/backup/backup.xbstream\n</code></pre> <p>To unpack the backup to the /root/backup/ directory:</p> <pre><code>$ xbstream -x &lt;  backup.xbstream -C /root/backup/\n</code></pre> <p>To send the compressed backup to another host and unpack it:</p> <pre><code>$ innobackupex --compress --stream=xbstream /root/backup/ | ssh user@otherhost \"xbstream -x -C /root/backup/\"\n</code></pre>"},{"location":"innobackupex/streaming_backups_innobackupex.html#examples-using-tar","title":"Examples using tar","text":"<p>Store the complete backup directly to a tar archive:</p> <pre><code>$ innobackupex --stream=tar /root/backup/ &gt; /root/backup/out.tar\n</code></pre> <p>To send the tar archive to another host:</p> <pre><code>$ innobackupex --stream=tar ./ | ssh user@destination \\ \"cat - &gt; /data/backups/backup.tar\"\n</code></pre> <p>Note</p> <p>To extract Percona XtraBackup\u2019s archive you must use tar with <code>-i</code> option:</p> <p><pre><code> $ tar -xizf backup.tar.gz\n</code></pre> Compress with your preferred compression tool:</p> <pre><code>$ innobackupex --stream=tar ./ | gzip - &gt; backup.tar.gz\n$ innobackupex --stream=tar ./ | bzip2 - &gt; backup.tar.bz2\n</code></pre> <p>Note that the streamed backup will need to be prepared before restoration. Streaming mode does not prepare the backup.</p>"},{"location":"innobackupex/throttling_ibk.html","title":"Throttling backups with innobackupex","text":"<p>Although innobackupex does not block your database\u2019s operation, any backup can add load to the system being backed up. On systems that do not have much spare I/O capacity, it might be helpful to throttle the rate at which innobackupex reads and writes InnoDB data. You can do this with the <code>innobackupex --throttle</code> option.</p> <p>This option is passed directly to xtrabackup binary and only limits the operations on the logs and files of InnoDB tables. It doesn\u2019t have an effect on reading or writing files from tables with other storage engine.</p> <p>One way of checking the current I/O operations at a system is with <code>iostat</code> command. See Throttling Backups for details of how throttling works.</p> <p>Note</p> <p><code>innobackupex --throttle</code> option works only during the backup phase, i.e. it will not work with <code>innobackupex --apply-log</code> and <code>innobackupex --copy-back</code> options.</p>"},{"location":"installation/apt_repo.html","title":"Installing Percona XtraBackup on Debian and Ubuntu","text":"<p>Note</p> <p>The following instructions install Percona XtraBackup 2.4 using the APT package manager. The instructions to install Percona XtraBackup 8.0 using the APT package manager are available in the Percona XtraBackup 8.0 installation documentation.</p> <p>Ready-to-use packages are available from the Percona XtraBackup software repositories and the Percona download page.</p> <p>Specific information on the supported platforms, products, and versions is described in Percona Software and Platform Lifecycle.</p>"},{"location":"installation/apt_repo.html#whats-in-each-deb-package","title":"What\u2019s in each DEB package?","text":"<p>The <code>percona-xtrabackup-24</code> package contains the latest Percona XtraBackup GA binaries and associated files.</p> <p>The <code>percona-xtrabackup-dbg-24</code> package contains the debug symbols for binaries in <code>percona-xtrabackup-24</code>.</p> <p>The <code>percona-xtrabackup-test-24</code> package contains the test suite for Percona XtraBackup.</p> <p>The <code>percona-xtrabackup</code> package contains the older version of the Percona XtraBackup.</p>"},{"location":"installation/apt_repo.html#installing-percona-xtrabackup-via-percona-release","title":"Installing Percona XtraBackup via percona-release","text":"<p>Percona XtraBackup, like many other Percona products, is installed with the percona-release package configuration tool.</p> <ol> <li> <p>Download a deb package for percona-release the repository packages from Percona web:</p> <pre><code>$ wget https://repo.percona.com/apt/percona-release_latest.$(lsb_release -sc)_all.deb\n</code></pre> </li> <li> <p>Install the downloaded package with <code>dpkg</code>. To do that, run the following commands as root or with <code>sudo</code>:</p> <pre><code>$ sudo dpkg -i percona-release_latest.$(lsb_release -sc)_all.deb\n</code></pre> <p>Once you install this package the Percona repositories should be added. You can check the repository setup in the /etc/apt/sources.list.d/percona-release.list file.</p> </li> <li> <p>Enable the repository: <code>percona-release enable-only tools release</code></p> <p>If Percona XtraBackup is intended to be used in combination with the upstream MySQL Server, you enable only the <code>tools</code> repository: <code>percona-release enable-only tools</code>.</p> </li> <li> <p>After that you can install the <code>percona-xtrabackup-24</code> package:</p> <pre><code>$ sudo apt install percona-xtrabackup-24\n</code></pre> </li> <li> <p>In order to make compressed backups, install the <code>qpress</code> package:</p> <pre><code>$ sudo apt install qpress\n</code></pre> </li> </ol>"},{"location":"installation/apt_repo.html#apt-pinning-the-packages","title":"Apt-Pinning the packages","text":"<p>In some cases you might need to \u201cpin\u201d the selected packages to avoid the upgrades from the distribution repositories. You\u2019ll need to make a new file <code>/etc/apt/preferences.d/00percona.pref</code> and add the following lines in it:</p> <pre><code>Package: *\nPin: release o=Percona Development Team\nPin-Priority: 1001\n</code></pre> <p>For more information about the pinning you can check the official debian wiki.</p>"},{"location":"installation/apt_repo.html#installing-percona-xtrabackup-using-downloaded-deb-packages","title":"Installing Percona XtraBackup using downloaded deb packages","text":"<p>Download the packages of the desired series for your architecture from the download page. Following example downloads the Percona XtraBackup 2.4.20 release package for Debian 9.0:</p> <pre><code>$ wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.20/\\\nbinary/debian/stretch/x86_64/percona-xtrabackup-24_2.4.20-1.stretch_amd64.deb\n</code></pre> <p>Now you can install Percona XtraBackup by running:</p> <pre><code>$ sudo dpkg -i percona-xtrabackup-24_2.4.20-1.stretch_amd64.deb\n</code></pre> <p>Note</p> <p>Installing the packages manually like this, you must resolve all dependencies and install the missing packages yourself.</p>"},{"location":"installation/apt_repo.html#update-the-curl-utility-in-debian-10","title":"Update the Curl utility in Debian 10","text":"<p>The default curl version, 7.64.0, in Debian 10 has known issues when attempting to reuse an already closed connection. This issue directly affects <code>xbcloud</code> and users may see intermittent backup failures.</p> <p>For more details, see curl #3750 or curl #3763.</p> <p>Follow these steps to upgrade curl to version 7.74.0:</p> <ol> <li> <p>Edit the <code>/etc/apt/sources.list</code> to add the following:</p> <pre><code>deb http://ftp.de.debian.org/debian buster-backports main\n</code></pre> </li> <li> <p>Refresh the <code>apt</code> sources:</p> <pre><code>sudo apt update\n</code></pre> </li> <li> <p>Install the version from <code>buster-backports</code>:</p> <pre><code>$ sudo apt install curl/buster-backports\n</code></pre> </li> <li> <p>Verify the version number:</p> <p><pre><code>$ curl --version\n</code></pre> The result is similar to the following;</p> <pre><code>curl 7.74.0 (x86_64-pc-linux-gnu) libcurl/7.74.0\n</code></pre> </li> </ol>"},{"location":"installation/apt_repo.html#uninstalling-percona-xtrabackup","title":"Uninstalling Percona XtraBackup","text":"<p>To uninstall Percona XtraBackup you\u2019ll need to remove all the installed packages.</p> <ol> <li> <p>Remove the packages</p> <pre><code>$ sudo apt remove percona-xtrabackup-24\n</code></pre> </li> </ol>"},{"location":"installation/binary-tarball.html","title":"Installing Percona XtraBackup from a Binary Tarball","text":"<p>Note</p> <p>The following instructions install Percona XtraBackup 2.4 by downloading and installing a binary tarball. The instructions to install Percona XtraBackup 8.0 by the same method are available in the Percona XtraBackup 8.0 installation documentation.</p> <p>Percona provides binary tarballs of Percona XtraBackup. Binary tarballs contain pre-compiled executables, libraries, and other dependencies and are compressed <code>tar</code> archives. Extract the binary tarballs to any path.</p> <p>Binary tarballs are available for download and installation. The following table lists the tarballs available in <code>Linux - Generic</code>. Select the Percona XtraBackup 2.4 version number and the type of tarball for your installation. Binary tarballs support all distributions.</p> <p>After you have downloaded the binary tarballs, extract the tarball in the file location of your choice.</p> Type Name Description Full percona-xtrabackup\u2013Linux.x86_64.glibc2.12.tar.gz Contains binaries, libraries, test files, and debug symbols Minimal percona-xtrabackup\u2013Linux.x86_64.glibc2.12-minimal.tar.gz Contains binaries, and libraries but does not include test files, or debug symbols <p>Fetch and extract the correct binary tarball. For example, the following downloads the full tarball for version 2.4.24:</p> <p>You may need to update the apt repositories and then install <code>wget</code>.</p> <pre><code>$ apt update\n$ apt install wget\n</code></pre> <pre><code>$ wget wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.27/binary/tarball/percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz\n</code></pre> Expected results <pre><code>  --2022-12-06 17:01:29--  https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.27/binary/tarball/percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz\n  Resolving downloads.percona.com (downloads.percona.com)... 74.121.199.231, 162.220.4.221, 162.220.4.222\n  Connecting to downloads.percona.com (downloads.percona.com)|74.121.199.231|:443... connected.\n  HTTP request sent, awaiting response... 200 OK\n  Length: 77216741 (74M) [application/x-gzip]\n  Saving to: 'percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz'\n</code></pre> <p>Uncompress the file:</p> <pre><code>$ tar xvf percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12.tar.gz\n</code></pre> Expected results <pre><code>percona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12/\npercona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12/man/\npercona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12/man/man1/\npercona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12/man/man1/xtrabackup.1\npercona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12/man/man1/xbstream.1\npercona-xtrabackup-2.4.27-Linux-x86_64.glibc2.12/man/man1/xbcrypt.1\n...\n</code></pre> <p>An installation from a binary tarball requires doing certain tasks manually, such as configuring settings, and policies, that a repository package installation performs automatically.</p>"},{"location":"installation/compiling_xtrabackup.html","title":"Compiling and Installing from Source Code","text":"<p>Note</p> <p>The following instructions installs Percona XtraBackup 2.4 by compiling the source code. The instructions to run Percona XtraBackup 8.0 by the same method are available in the Percona XtraBackup 8.0 installation documentation.</p> <p>The source code is available from the Percona XtraBackup Github project. The easiest way to get the code is by using the <code>git clone</code> command. Then, switch to the release branch that you want to install, such as 2.4.</p> <pre><code>$ git clone https://github.com/percona/percona-xtrabackup.git\n$ cd percona-xtrabackup\n$ git checkout 2.4\n</code></pre>"},{"location":"installation/compiling_xtrabackup.html#step-1-installing-prerequisites","title":"Step 1: Installing prerequisites","text":"<p>The following packages and tools must be installed to compile Percona XtraBackup from source. These might vary from system to system.</p> <p>Important</p> <p>In order to build Percona XtraBackup v8.0 from source, you need to use <code>cmake</code> version 3. In your distribution, it may be available either as a separate package <code>cmake3</code> or as <code>cmake</code>. To check which version is installed, run <code>cmake --version</code> and if it does report a version 3, install <code>cmake3</code> for your system.</p> <p>See also</p> <p>https://cmake.org/</p>"},{"location":"installation/compiling_xtrabackup.html#debian-or-ubuntu-using-apt","title":"Debian or Ubuntu using <code>apt</code>","text":"<pre><code>$ sudo apt install build-essential flex bison automake autoconf \\\nlibtool cmake libaio-dev mysql-client libncurses-dev zlib1g-dev \\\nlibgcrypt11-dev libev-dev libcurl4-gnutls-dev vim-common\n</code></pre> <p>To install the man pages, install the <code>python3-sphinx</code> package:</p> <pre><code>$ sudo apt install python3-sphinx\n</code></pre>"},{"location":"installation/compiling_xtrabackup.html#centos-or-red-hat-using-yum","title":"CentOS or Red Hat using <code>yum</code>","text":"<p>Percona XtraBackup requires GCC version 5.3 or higher. If the version of GCC installed on your system is lower then you may need to install and enable the Developer Toolset on <code>RPM</code>-based distributions to make sure that you use the latest GCC compiler and development tools.  Then, install <code>cmake</code> and other dependencies:</p> <pre><code>$ sudo yum install cmake openssl-devel libaio libaio-devel automake autoconf \\\nbison libtool ncurses-devel libgcrypt-devel libev-devel libcurl-devel zlib-devel \\\nvim-common\n</code></pre> <p>To install the man pages, install the <code>python3-sphinx</code> package:</p> <pre><code>$ sudo yum install python3-sphinx\n</code></pre>"},{"location":"installation/compiling_xtrabackup.html#step-2-generating-the-build-pipeline","title":"Step 2: Generating the build pipeline","text":"<p>At this step, you have <code>cmake</code> run the commands in the <code>CMakeList.txt</code> file to generate the build pipeline, i.e. a native build environment that will be used to compile the source code).</p> <ol> <li> <p>Change to the directory where you cloned the Percona XtraBackup repository</p> <pre><code>$ cd percona-xtrabackup\n</code></pre> </li> <li> <p>Create a directory to store the compiled files and then change to that directory:</p> <pre><code>$ mkdir build\n$ cd build\n</code></pre> </li> <li> <p>Run <code>cmake</code> or <code>cmake3</code>. In either case, the options you need to use are the same.</p> </li> </ol> <p>Note</p> <p>You can build Percona XtraBackup with man pages but this requires <code>python-sphinx</code> package which isn\u2019t available from that main repositories for every distribution. If you installed the <code>python-sphinx</code> package you need to remove the <code>-DWITH_MAN_PAGES=OFF</code> from previous command. </p> <pre><code>$ cmake -DWITH_BOOST=PATH-TO-BOOST-LIBRARY -DDOWNLOAD_BOOST=ON \\\n-DBUILD_CONFIG=xtrabackup_release -DWITH_MAN_PAGES=OFF -B ..\n</code></pre>"},{"location":"installation/compiling_xtrabackup.html#more-information-about-parameters","title":"More information about parameters","text":"<p><code>-DWITH_BOOST</code></p> <p>For the <code>-DWITH_BOOST</code> parameter, specify the name of a directory to download the boost library to. This directory will be created automatically in your current directory.</p> <p><code>-B (--build)</code></p> <p>Percona XtraBackup is configured to forbid generating the build pipeline for <code>make</code> in the same directory where you store your sources. The <code>-B</code> parameter refers to the directory that contains the source code. In this example we use the relative path to the parent directory (..).</p> <p>Important</p> <p>CMake Error at CMakeLists.txt:367 (MESSAGE): Please do not build in-source.  Out-of source builds are highly recommended: you can have multiple builds for the same source, and there is an easy way to do cleanup, simply remove the build directory (note that \u2018make clean\u2019 or \u2018make distclean\u2019 does not work)</p> <p>You can force in-source build by invoking cmake with -DFORCE_INSOURCE_BUILD=1</p> <p><code>-DWITH_MAN_PAGES</code></p> <p>To build Percona XtraBackup man pages, use <code>ON</code> or remove this parameter from the command line (it is <code>ON</code> by default). </p> <p>To install the man pages, install the <code>python3-sphinx</code> package:</p>"},{"location":"installation/compiling_xtrabackup.html#step-2-compiling-the-source-code","title":"Step 2: Compiling the source code","text":"<p>To compile the source code in your build directory, use the <code>make</code> command.</p> <p>Important</p> <p>The computer where you intend to compile Percona XtraBackup 8.0 must have at least 2G of RAM available.</p> <ol> <li> <p>Change to the <code>build</code> directory (created at Step 2: Generating the build pipeline).</p> </li> <li> <p>Run the <code>make</code> command. This command may take a long time to complete.</p> <pre><code>$ make\n</code></pre> </li> </ol>"},{"location":"installation/compiling_xtrabackup.html#step-3-installing-on-the-target-system","title":"Step 3: Installing on the target system","text":"<p>The following command installs all Percona XtraBackup binaries xtrabackup and tests to default location on the target system: <code>/usr/local/xtrabackup</code>.</p> <p>Run <code>make install</code> to install Percona XtraBackup to the default location.</p> <pre><code>$ sudo make install\n</code></pre>"},{"location":"installation/compiling_xtrabackup.html#installing-to-a-non-default-location","title":"Installing to a non-default location","text":"<p>You may use the <code>DESTDIR</code> parameter with <code>make install</code> to install Percona XtraBackup to another location. Make sure that the effective user is able to write to the destination you choose.</p> <pre><code>$ sudo make DESTDIR=&lt;DIR_NAME&gt; install\n</code></pre> <p>In fact, the destination directory is determined by the installation layout (<code>-DINSTALL_LAYOUT</code>) that <code>cmake</code> applies (see Step 2: Generating the build pipeline). In addition to the installation directory, this parameter controls a number of other destinations that you can adjust for your system.</p> <p>By default, this parameter is set to <code>STANDALONE</code>, which implies the installation directory to be /usr/local/xtrabackup.</p> <p>See also</p> <p>MySQL Documentation: -DINSTALL_LAYOUT</p>"},{"location":"installation/compiling_xtrabackup.html#step-4-running","title":"Step 4: Running","text":"<p>After Percona XtraBackup is installed on your system, you may run it by using the full path to the <code>xtrabackup</code> command:</p> <pre><code>$ /usr/local/xtrabackup/bin/xtrabackup\n</code></pre> <p>Update your PATH environment variable if you would like to use the command on the command line directly.</p> <pre><code>$# Setting $PATH on the command line\n$ PATH=$PATH:/usr/local/xtrabackup/bin/xtrabackup\n\n$# Run xtrabackup directly\n$ xtrabackup\n</code></pre> <p>Alternatively, you may consider placing a soft link (using <code>ln -s</code>) to one of the locations listed in your <code>PATH</code> environment variable.</p> <p>See also</p> <p><code>man ln</code></p> <p>To view the documentation with <code>man</code>, update the <code>MANPATH</code> variable.</p>"},{"location":"installation/docker.html","title":"Running Percona XtraBackup in a Docker container","text":"<p>Note</p> <p>The following instructions runs Percona XtraBackup 2.4 in a Docker container. The instructions to run Percona XtraBackup 8.0 by the same method are available in the Percona XtraBackup 8.0 installation documentation.</p> <p>Docker allows you to run applications in a lightweight unit called a container.</p> <p>You can run Percona XtraBackup in a Docker container without installing the product. All required libraries are available in the container. Being a lightweight execution environment, Docker containers enable creating configurations where each program runs in a separate container. You may run Percona Server for MySQL in one container and Percona XtraBackup in another. Docker images offer a range of options.</p> <p>Create a Docker container based on a Docker image. Docker images for Percona XtraBackup are hosted publicly on Docker Hub at <code>percona/percona-xtrabackup</code>.</p> <pre><code>$ sudo docker create ... percona/percona-xtrabackup --name xtrabackup ...\n</code></pre>"},{"location":"installation/docker.html#scope-of-this-section","title":"Scope of this section","text":"<p>This section demonstrates how to backup data on a Percona Server for MySQL running in another Docker container.</p>"},{"location":"installation/docker.html#installing-docker","title":"Installing Docker","text":"<p>Your operating system may already provide a package for docker. However, the versions of Docker provided by your operating system are likely to be outdated.</p> <p>Use the installation instructions for your operating system available from the Docker site to set up the latest version of docker.</p> <p>Note</p> <p>Docker Documentation:   * How to use Docker   * Installing   * Getting started</p>"},{"location":"installation/docker.html#connecting-to-a-percona-server-for-mysql-container","title":"Connecting to a Percona Server for MySQL container","text":"<p>Percona XtraBackup works in combination with a database server. When running a Docker container for Percona XtraBackup, you can make backups for a database server either installed on the host machine or running in a separate Docker container.</p> <p>To set up a database server on a host machine or in Docker container, follow the documentation of the supported product that you intend to use with Percona XtraBackup.</p> <p>See also</p> <p>Percona Server for MySQL Documentation:   * Installing on a host machine   * Running in a Docker container</p> <pre><code>$ sudo docker run -d --name percona-server-mysql-5.7 \\\n-e MYSQL_ROOT_PASSWORD=root percona/percona-server:5.7\n</code></pre> <p>As soon as Percona Server for MySQL runs, add some data to it. Now, you are ready to make backups with Percona XtraBackup.</p>"},{"location":"installation/docker.html#creating-a-docker-container-from-percona-xtrabackup-image","title":"Creating a Docker container from Percona XtraBackup image","text":"<p>You can create a Docker container based on Percona XtraBackup image with either docker create or docker run command. docker create creates a Docker container and makes it available for starting later.</p> <p>Docker downloads the Percona XtraBackup image from the Docker Hub. If it is not the first time you use the selected image, Docker uses the image available locally.</p> <pre><code>$ sudo docker create --name percona-xtrabackup-2.4 --volumes-from percona-server-mysql-5.7 \\\npercona/percona-xtrabackup:2.4  \\\nxtrabackup --backup --datadir=/var/lib/mysql/ --target-dir=/backup \\\n--user=root --password=mysql\n</code></pre> <p>With <code>--name</code> you give a meaningful name to your new Docker container so that you could easily locate it among your other containers.</p> <p>The <code>--volumes-from</code> referring to percona-server-mysql indicates that you indend to use the same data as the percona-server-mysql container.</p> <p>Run the container with exactly the same parameters that were used when the container was created:</p> <pre><code>$ sudo docker start -ai percona-xtrabackup-2.4\n</code></pre> <p>This command starts the percona-xtrabackup container, attaches to its input/output streams, and opens an interactive shell.</p> <p>The docker run is a shortcut command that creates a Docker container and then immediately runs it.</p> <pre><code>$ sudo docker run --name percona-xtrabackup-2.4 --volumes-from percona-server-mysql-5.7 \\\npercona/percona-xtrabackup:2.4\nxtrabackup --backup --data-dir=/var/lib/mysql --target-dir=/backup --user=root --password=mysql\n</code></pre> <p>See also</p> <p>More in Docker documentation   * Docker volumes as persistent data storage for containers   * More information about containers</p>"},{"location":"installation/yum_repo.html","title":"Installing Percona XtraBackup on Red Hat Enterprise Linux and CentOS","text":"<p>Note</p> <p>The following instructions install Percona XtraBackup 2.4 using the YUM package manager. The instructions to install Percona XtraBackup 8.0 using the YUM package manager are available in the Percona XtraBackup 8.0 installation documentation.</p> <p>Ready-to-use packages are available from the Percona XtraBackup software repositories and the download page. The Percona <code>yum</code> repository supports popular RPM-based operating systems, including the Amazon Linux AMI.</p> <p>The easiest way to install the Percona Yum repository is to install an RPM that configures <code>yum</code> and installs the Percona GPG key.</p> <p>Specific information on the supported platforms, products, and versions is described in Percona Software and Platform Lifecycle.</p>"},{"location":"installation/yum_repo.html#whats-in-each-rpm-package","title":"What\u2019s in each RPM package?","text":"<p>The <code>percona-xtrabackup-24</code> package contains the latest Percona XtraBackup GA binaries and associated files.</p> <p>The <code>percona-xtrabackup-24-debuginfo</code> package contains the debug symbols for binaries in <code>percona-xtrabackup-24</code>.</p> <p>The <code>percona-xtrabackup-test-24</code> package contains the test suite for Percona XtraBackup.</p> <p>The <code>percona-xtrabackup</code> package contains the older version of the Percona XtraBackup.</p>"},{"location":"installation/yum_repo.html#installing-percona-xtrabackup-from-percona-yum-repository","title":"Installing Percona XtraBackup from Percona <code>yum</code> repository","text":"<ol> <li> <p>Install the <code>percona-release</code> configuration tool</p> <p>You can install the yum repository for percona-release by running the following command as a <code>root</code> user or with <code>sudo</code>:</p> <pre><code>$ yum install https://repo.percona.com/yum/percona-release-latest.noarch.rpm\n</code></pre> <p>You should see some output such as the following:</p> <pre><code>Retrieving https://repo.percona.com/yum/percona-release-latest.noarch.rpm\nPreparing...                ########################################### [100%]\n   1:percona-release        ########################################### [100%]\n</code></pre> <p>Note</p> <p>RHEL/Centos 5 doesn\u2019t support installing the packages directly from the remote location so you\u2019ll need to download the package first and install it manually with rpm:</p> <pre><code>$ wget https://repo.percona.com/yum/percona-release-latest.noarch.rpm\n$ rpm -ivH percona-release-latest.noarch.rpm\n</code></pre> </li> <li> <p>Testing the repository</p> <p>Make sure packages are now available from the repository, by executing the following command:</p> <pre><code>$ yum list | grep percona\n</code></pre> <p>You should see output similar to the following:</p> <pre><code>...\npercona-xtrabackup-20.x86_64               2.0.8-587.rhel5             percona-release-x86_64\npercona-xtrabackup-20-debuginfo.x86_64     2.0.8-587.rhel5             percona-release-x86_64\npercona-xtrabackup-20-test.x86_64          2.0.8-587.rhel5             percona-release-x86_64\npercona-xtrabackup-21.x86_64               2.1.9-746.rhel5             percona-release-x86_64\npercona-xtrabackup-21-debuginfo.x86_64     2.1.9-746.rhel5             percona-release-x86_64\npercona-xtrabackup-22.x86_64               2.2.13-1.el5                percona-release-x86_64\npercona-xtrabackup-22-debuginfo.x86_64     2.2.13-1.el5                percona-release-x86_64\npercona-xtrabackup-debuginfo.x86_64        2.3.5-1.el5                 percona-release-x86_64\npercona-xtrabackup-test.x86_64             2.3.5-1.el5                 percona-release-x86_64\npercona-xtrabackup-test-21.x86_64          2.1.9-746.rhel5             percona-release-x86_64\npercona-xtrabackup-test-22.x86_64          2.2.13-1.el5                percona-release-x86_64\n...\n</code></pre> </li> <li> <p>Enable the repository: <code>percona-release enable-only tools release</code></p> <p>If Percona XtraBackup is intented to be used in combination with the upstream MySQL Server, you only need to enable the <code>tools</code> repository: <code>percona-release enable-only tools</code>.</p> </li> <li> <p>Install Percona XtraBackup by running:  <code>yum install percona-xtrabackup-24</code></p> <p>Warning</p> <p>In order to successfully install Percona XtraBackup on CentOS prior to version 7, the <code>libev</code> package needs to be installed first. This package <code>libev</code> package can be installed from the EPEL repositories.</p> </li> </ol>"},{"location":"installation/yum_repo.html#percona-yum-testing-repository","title":"Percona <code>yum</code> Testing Repository","text":"<p>Percona offers pre-release builds from our testing repository. To subscribe to the testing repository, you\u2019ll need to enable the testing repository in /etc/yum.repos.d/percona-release.repo. To do so, set both <code>percona-testing-$basearch</code> and <code>percona-testing-noarch</code> to <code>enabled = 1</code> (Note that there are 3 sections in this file: release, testing and experimental - in this case it is the second section that requires updating). </p> <p>Note</p> <p>You\u2019ll need to install the Percona repository first (ref above) if this hasn\u2019t been done already.</p> <ol> <li> <p>To be able to make compressed backups, install the <code>qpress</code> package:</p> <pre><code>$ yum install qpress\n</code></pre> <p>See also</p> <p>Compressed Backup</p> </li> </ol>"},{"location":"installation/yum_repo.html#installing-percona-xtrabackup-using-downloaded-rpm-packages","title":"Installing Percona XtraBackup using downloaded rpm packages","text":"<p>Download the packages of the desired series for your architecture from the download page. Following example will download Percona XtraBackup 2.4.4 release package for CentOS 7:</p> <pre><code>$ wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.4/\\\nbinary/redhat/7/x86_64/percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm\n</code></pre> <p>Now you can install Percona XtraBackup by running:</p> <pre><code>$ yum localinstall percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm\n</code></pre> <p>Note</p> <p>When installing packages manually like this, you\u2019ll need to make sure to resolve all the dependencies and install missing packages yourself.</p>"},{"location":"installation/yum_repo.html#uninstalling-percona-xtrabackup","title":"Uninstalling Percona XtraBackup","text":"<p>To completely uninstall Percona XtraBackup you\u2019ll need to remove all the installed packages.</p> <p>Remove the packages</p> <pre><code>yum remove percona-xtrabackup\n</code></pre>"},{"location":"release-notes/2.4/2.4.0-rc1.html","title":"Percona XtraBackup 2.4.0-rc1","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.0-rc1 on February 8th 2016. Downloads are available from our download site and from apt and yum repositories.</p> <p>This is a Release Candidate quality release and it is not intended for production. If you want a high quality, Generally Available release, the current Stable version should be used (currently 2.3.3 in the 2.3 series at the time of writing).</p>"},{"location":"release-notes/2.4/2.4.0-rc1.html#new-features","title":"New features","text":"<p>Percona XtraBackup has implemented basic support for MySQL 5.7 and Percona Server for MySQL 5.7.</p>"},{"location":"release-notes/2.4/2.4.0-rc1.html#known-issues","title":"Known Issues","text":"<ul> <li> <p>Backed-up table data could not be recovered if backup was taken while running <code>OPTIMIZE TABLE</code> (bug PXB-1360) or <code>ALTER TABLE ... TABLESPACE</code> (bug PXB-1360) on that table.</p> </li> <li> <p>Compact Backups currently don\u2019t work due to bug PXB-372.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.1.html","title":"Percona XtraBackup 2.4.1","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.1 on February 16th 2016. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the first GA (Generally Available) stable release in the 2.4 series.</p> <p>This release contains all the features and bug fixes in Percona XtraBackup 2.3.3, plus the following:</p>"},{"location":"release-notes/2.4/2.4.1.html#new-features","title":"New features","text":"<p>Percona XtraBackup has implemented basic support for MySQL 5.7 and Percona Server for MySQL 5.7.</p>"},{"location":"release-notes/2.4/2.4.1.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>Percona XtraBackup didn\u2019t respect <code>innodb_log_file_size</code> variable stored in <code>backup-my.cnf</code>. Bug fixed PXB-450.</p> </li> <li> <p>If server would run out of space while backups were taken with innobackupex \u2013rsync option backup process would fail but innobackupex would still complete with <code>completed OK!</code> message. Bug fixed PXB-459.</p> </li> <li> <p>Percona XtraBackup was silently skipping extra arguments. Bug fixed PXB-747 (Fungo Wang).</p> </li> </ul> <p>Other bugs fixed: PXB-1368 and 1363.</p>"},{"location":"release-notes/2.4/2.4.10.html","title":"Percona XtraBackup 2.4.10","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.10 on March 30, 2018. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is based on MySQL 5.7.19 and is the current GA (Generally Available) stable release in the 2.4 series.</p> <p>Starting from now, Percona XtraBackup issue tracking system was moved from launchpad to JIRA. All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.10.html#bugs-fixed","title":"Bugs fixed","text":"<ul> <li> <p>xbcrypt with <code>--encrypt-key-file</code> option was failing due to regression in Percona XtraBackup 2.4.9. Bug fixed PXB-518.</p> </li> <li> <p>Simultaneous usage of both <code>--lock-ddl</code> and <code>--lock-ddl-per-table</code> options caused Percona XtraBackup lock with the backup process never completed. Bug fixed PXB-792.</p> </li> <li> <p>Compilation under Mac OS X was broken. Bug fixed PXB-796.</p> </li> <li> <p>A regression of the maximum number of pending reads and the unnoticed earlier possibility of a pending reads related deadlock caused Percona XtraBackup to stuck in prepare stage. Bug fixed: PXB-1467.</p> </li> <li> <p>Percona XtraBackup skipped tablespaces with corrupted first page instead of aborting the backup. Bug fixed PXB-1497.</p> </li> </ul> <p>Other bugs fixed: PXB-513.</p>"},{"location":"release-notes/2.4/2.4.11.html","title":"Percona XtraBackup 2.4.11","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.11 on April 23, 2018. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.11.html#new-features-and-improvements","title":"New features and improvements","text":"<ul> <li> <p>The support of the Percona Server for MySQL encrypted general tablespaces was implemented in this version of Percona XtraBackup. Issue fixed PXB-1513.</p> </li> <li> <p>Percona XtraBackup is now able to backup encrypted Percona Server for MySQL instances which are using keyring_vault plugin. Issue fixed PXB-1514.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.12.html","title":"Percona XtraBackup 2.4.12","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.12 on June 22, 2018. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.12.html#new-features-and-improvements","title":"New features and improvements","text":"<ul> <li>Percona XtraBackup now prints used arguments to standard output. Bug fixed PXB-1494.</li> </ul>"},{"location":"release-notes/2.4/2.4.12.html#bugs-fixed","title":"Bugs fixed","text":"<ul> <li> <p><code>xtrabackup --copy-back</code> didn\u2019t read which encryption plugin to use from <code>plugin-load</code> setting of the <code>my.cnf</code> configuration file. Bug fixed PXB-1544.</p> </li> <li> <p>xbstream was exiting with zero return code when it failed to create one or more target files instead of returning error code 1. Bug fixed PXB-1542.</p> </li> <li> <p>Meeting a zero sized keyring file, Percona XtraBackup was removing and immediately recreating it, which could affect external software noticing this file had undergo manipulations. Bug fixed  PXB-1540.</p> </li> <li> <p><code>xtrabackup_checkpoints</code> files were encrypted during a backup, which caused additional difficulties to take incremental backups. Bug fixed PXB-202.</p> </li> </ul> <p>Other bugs fixed: PXB-1526 \u201cTest kill_long_selects.sh failing with MySQL 5.7.21\u201d.</p>"},{"location":"release-notes/2.4/2.4.13.html","title":"Percona XtraBackup 2.4.13","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.13 on January 18, 2019. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.13.html#improvements-and-new-features","title":"Improvements and New Features","text":"<ul> <li>PXB-1548: Percona Xtrabackup enables updating the <code>ib_buffer_pool</code> file with the latest pages present in the buffer pool by setting the <code>xtrabackup --dump-innodb-buffer-pool</code> option to ON. Thanks to Marcelo Altmann for contribution.</li> </ul>"},{"location":"release-notes/2.4/2.4.13.html#bus-fixed","title":"Bus Fixed","text":"<ul> <li> <p><code>xtrabackup</code> did not delete missing tables from the partial backup which led to error messages logged by the server on startup. Bug fixed PXB-1536.</p> </li> <li> <p>The <code>--history</code> option did not work when autocommit was disabled. Bug fixed PXB-1569.</p> </li> <li> <p><code>xtrabackup</code> could fail to backup encrypted tablespace when it was recently created or altered. Bug fixed PXB-1648.</p> </li> <li> <p>When the <code>--throttle</code> option was used, the applied value was different from the one specified by the user (off by one error). Bug fixed PXB-1668.</p> </li> <li> <p>It was not allowed for MTS (multi-threaded slaves)  without GTID to be backed up with <code>--safe-slave-backup</code>. Bug fixed PXB-1672.</p> </li> <li> <p>Percona Xtrabackup could crash when the <code>ALTER TABLE \u2026 TRUNCATE PARTITION</code> command was run during a backup without locking DDL. Bug fixed PXB-1679.</p> </li> <li> <p><code>xbcrypt</code> could display an assertion failure and generated core if the required parameters are missing. Bug fixed PXB-1683.</p> </li> <li> <p>Using <code>--lock-ddl-per-table</code> caused the server to scan all records of partitioned tables which could lead to the \u201cout of memory\u201d error. Bugs fixed PXB-1691 and PXB-1698.</p> </li> <li> <p>xtrabackup \u2013prepare could hang while performing insert buffer merge. Bug fixed PXB-1704.</p> </li> <li> <p>Incremental backups did not update <code>xtrabackup_binlog_info</code> with <code>--binlog-info=lockless</code>. Bug fixed PXB-1711.</p> </li> </ul> <p>Other bugs fixed: PXB-1570, PXB-1609, PXB-1632</p>"},{"location":"release-notes/2.4/2.4.14.html","title":"Percona XtraBackup 2.4.14","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.14 on May 1, 2019. Downloads are available from our download site and from apt and yum repositories.</p> <p>Percona XtraBackup 2.4.14 enables saving backups to an Amazon S3 storage when using xbcloud. The following example demonstrates how to use an Amazon S3 storage to make a full backup.</p> <pre><code>$ xtrabackup --backup --stream=xbstream --extra-lsndir=/tmp --target-dir=/tmp | \\\nxbcloud put --storage=s3 \\\n--s3-endpoint='s3.amazonaws.com' \\\n--s3-access-key='YOUR-ACCESSKEYID' \\\n--s3-secret-key='YOUR-SECRETACCESSKEY' \\\n--s3-bucket='mysql_backups'\n--parallel=10 \\\n${date -I}-full_backup\n</code></pre> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.14.html#new-features","title":"New Features","text":"<p>Amazon S3 is now supported in xbcloud. More information in PXB-1813.</p>"},{"location":"release-notes/2.4/2.4.14.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>When the row format was changed during the backup, xtrabackup could crash during the incremental prepare stage. Bug fixed PXB-1824.</p> </li> <li> <p>If compressed InnoDB undo tablespaces were not removed beforehand, the incremental backup could crash at the prepare stage. Bug fixed PXB-1552.</p> </li> </ul> <p>Other bugs fixed: PXB-1771, PXB-1809, PXB-1837.</p>"},{"location":"release-notes/2.4/2.4.15.html","title":"Percona XtraBackup 2.4.15","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.15 on July 10, 2019. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.15.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>When the encrypted tablespaces feature was enabled, encrypted and compressed tables were not usable on the joiner node (Percona XtraDB Cluster) via SST (State Snapshot Transfer) with the <code>xtrabackup-v2</code> method. Bug fixed PXB-1867.</p> </li> <li> <p><code>xbcloud</code> did not update date related fields of the HTTP header when retrying a request. Bug fixed PXB-1874.</p> </li> <li> <p><code>xbcloud</code> did not retry to send the request after receiving the HTTP 408 error (request timeout). Bug fixed PXB-1875.</p> </li> <li> <p>If the user tried to merge an already prepared incremental backup, a misleading error was produced without informing that incremental backups may not be used twice. Bug fixed PXB-1862.</p> </li> <li> <p><code>xbcloud</code> could crash with the Swift storage when project options were not included. Bug fixed PXB-1844.</p> </li> <li> <p><code>xtrabackup</code> did not accept decimal fractions as values of the <code>innodb_max_dirty_pages_pct</code> option. Bug fixed PXB-1807.</p> </li> </ul> <p>Other bugs fixed: PXB-1850, PXB-1879, PXB-1887, PXB-1888, PXB-1890.</p>"},{"location":"release-notes/2.4/2.4.16.html","title":"Percona XtraBackup 2.4.16","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.16 on November 4, 2019. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.16.html#improvements","title":"Improvements","text":"<p>Two options (<code>--backup-lock-timeout</code> and <code>--backup-lock-retry-count</code>) were added to enable the configuring of the timeout for acquiring metadata locks in <code>FLUSH TABLES WITH READ LOCK</code>, <code>LOCK TABLE FOR BACKUP</code>, and <code>LOCK BINLOG FOR BACKUP</code> statements. More information in PXB-1914</p>"},{"location":"release-notes/2.4/2.4.16.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>Percona Xtrabackup was not able to connect to the database when the password was specified along with the transition-key parameter. Bug fixed PXB-1902.</p> </li> <li> <p>In some cases, Percona Xtrabackup stuck with redo log corruption when master key is rotated. Bug fixed PXB-1903.</p> </li> <li> <p>In rare cases, when both full and incremental backups were made before MySQL flushed the first page of the encrypted tablespace, Percona Xtrabackup could crash during the incremental backup prepare for the tablespace encryption. Bug fixed PXB-1894.</p> </li> <li> <p>An encrypted table could not be restored when ADD/DROP INDEX was run on the table. Bug fixed PXB-1905.</p> </li> <li> <p>In some cases <code>xtrabackup --prepare</code> could fail to decrypt a table but reported that the operation completed ok. Bug fixed PXB-1936.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.17.html","title":"Percona XtraBackup 2.4.17","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.17 on December 9, 2019. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.17.html#bugs-fixed","title":"Bugs Fixed","text":"<p>Percona XtraBackup could crash when making a backup for Percona Server 5.7.28-31 where the tablespace encryption was used. Bug fixed PXB-1968.</p>"},{"location":"release-notes/2.4/2.4.18.html","title":"Percona XtraBackup 2.4.18","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.18 on December 16, 2019. Downloads are available from our download site and from apt and yum repositories.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.18.html#bugs-fixed","title":"Bugs Fixed","text":"<p>Sometime between December 3rd and December 10th, a change was introduced in <code>AWS (Amazon Web Services)</code> that caused an incompatibility with our Percona XtraBackup <code>xbcloud</code> utility. Bug fixed PXB-1978.</p>"},{"location":"release-notes/2.4/2.4.19.html","title":"Percona XtraBackup 2.4.19","text":"<ul> <li> <p>Date</p> <p>March 25, 2020</p> </li> <li> <p>Installation</p> <p>Installing Percona XtraBackup</p> </li> </ul> <p>Downloads are available from our download site and from apt and yum repositories.</p> <p>Percona XtraBackup enables MySQL backups without blocking user queries, making it ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, it drives down backup costs while providing unique features for MySQL backups.</p> <p>All Percona software is open-source and free.</p>"},{"location":"release-notes/2.4/2.4.19.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li>PXB-1982: The history table showed a wrong value for <code>lock_time</code>.</li> </ul>"},{"location":"release-notes/2.4/2.4.2.html","title":"Percona XtraBackup 2.4.2","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.2 on April 1st 2016. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.2.html#new-features","title":"New features","text":"<ul> <li> <p>Percona XtraBackup has implemented support for InnoDB tablespace encryption.</p> </li> <li> <p>Percona XtraBackup has been rebased on MySQL 5.7.11.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.2.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>When backup was taken on MariaDB 10 with GTID enabled, Percona XtraBackup didn\u2019t store <code>gtid_slave_pos</code> in <code>xtrabackup_slave_info</code> but logged it only to <code>STDERR</code>. Bug fixed PXB-715.</p> </li> <li> <p>Backup process would fail if <code>xtrabackup --throttle</code> option was used. Bug fixed PXB-465.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.20.html","title":"Percona XtraBackup 2.4.20","text":"<ul> <li> <p>Date</p> <p>April 14, 2020</p> </li> <li> <p>Installation</p> <p>Installing Percona XtraBackup</p> </li> </ul> <p>Percona XtraBackup enables MySQL backups without blocking user queries, making it ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, it drives down backup costs while providing unique features for MySQL backups.</p> <p>This release fixes security vulnerability CVE-2020-10997</p> <p>Seealso</p> <p>Percona Database Performance Blog   CVE-2020-10997</p>"},{"location":"release-notes/2.4/2.4.20.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>PXB-1783: Xtrabackup GTID is incorrect after prepare</p> </li> <li> <p>PXB-2154: Xbstream displayed the encrypt-key in process during backup decryption</p> </li> <li> <p>PXB-2152: PXB wrote a new master key to standard error output</p> </li> <li> <p>PXB-2145: encrypt-key could appear in the process-list</p> </li> <li> <p>PXB-2142: Transition key was written to backup/stream</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.21.html","title":"Percona XtraBackup 2.4.21","text":"<ul> <li> <p>Date</p> <p>November 12, 2020</p> </li> <li> <p>Installation</p> <p>Installing Percona XtraBackup</p> </li> </ul> <p>Percona XtraBackup enables MySQL backups without blocking user queries, making it ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, it drives down backup costs while providing unique features for MySQL backups.</p>"},{"location":"release-notes/2.4/2.4.21.html#new-features","title":"New Features","text":"<ul> <li>PXB-2112: xbcloud: support <code>storage_class</code> option with <code>--storage=s3</code> (Thanks to user rluisr for reporting this issue)</li> </ul>"},{"location":"release-notes/2.4/2.4.21.html#improvements","title":"Improvements","text":"<ul> <li> <p>PXB-2254: Redesign <code>--lock-ddl-per-table</code></p> </li> <li> <p>PXB-2252: Introduce debug option to print the redo log records scanned and applied</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.21.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>PXB-793: Fix syntax error when executing <code>--lock-ddl-per-table</code> queries</p> </li> <li> <p>PXB-2165: Modify xbcloud to store backups using s3 access key parameters if AWS access key env variables are set</p> </li> <li> <p>PXB-2164: Modify xbcloud to return the error when the backup doesn\u2019t exist in s3 bucket</p> </li> <li> <p>PXB-953: Improve stdout for the end of usage of <code>--lock-ddl-per-table</code></p> </li> <li> <p>PXB-2279: Xbcloud: Upload failed: backup is incomplete (Thanks to user mrmainnet for reporting this issue)</p> </li> <li> <p>PXB-2127: Modify xbcloud to upload backups with empty database to min.io storage (Thanks to user hartland for reporting this issue)</p> </li> <li> <p>PXB-2275: Modify backup processing to add validations if an encrypted table is created</p> </li> <li> <p>PXB-2272: Fixed Regexp from <code>is_tmp_table</code> doesn\u2019t account for all temporary tables</p> </li> <li> <p>PXB-2257: fixed <code>--lock-ddl-per-table</code> to properly close database connection</p> </li> <li> <p>PXB-2249: Verify perl binary exists before completing version check</p> </li> <li> <p>PXB-2239: Partitioned table is not restored correctly when partitions are changed during backup</p> </li> <li> <p>PXB-2238: Provide binary tarball with shared libs and glibc suffix &amp; minimal tarballs</p> </li> <li> <p>PXB-2216: Verify encryption version when opening tables to avoid changing encryption version</p> </li> <li> <p>PXB-2202: Modify Xbcloud to display an error when xtrabackup fails to create a backup</p> </li> <li> <p>PXB-2198: Modify xbcloud delete to return the error when the backup doesn\u2019t exist in s3 bucket</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.22.html","title":"Percona XtraBackup 2.4.22","text":"<ul> <li> <p>Date</p> <p>March 22, 2021</p> </li> <li> <p>Installation</p> <p>Installing Percona XtraBackup</p> </li> </ul> <p>Percona XtraBackup enables MySQL backups without blocking user queries, making it ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, it drives down backup costs while providing unique features for MySQL backups.</p> <p>This release fixes the security vulnerability CVE-2020-29488</p>"},{"location":"release-notes/2.4/2.4.22.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>PXB-2171: Add missing PXB help options to the xtrabackup options reference</p> </li> <li> <p>PXB-2395: Update versions for xbstream and xbcrypt</p> </li> <li> <p>PXB-2394: Correct spellings in xbcloud help</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.23.html","title":"Percona XtraBackup 2.4.23","text":"<ul> <li> <p>Date</p> <p>June 22, 2021</p> </li> <li> <p>Installation</p> <p>Installing Percona XtraBackup</p> </li> </ul> <p>Percona XtraBackup enables MySQL backups without blocking user queries, making it ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, it drives down backup costs while providing unique features for MySQL backups.</p>"},{"location":"release-notes/2.4/2.4.23.html#improvements","title":"Improvements","text":"<ul> <li>PXB-2487: Problems with the typesetting in the Partial Backups document (Thanks to user qing for reporting this issue).</li> </ul>"},{"location":"release-notes/2.4/2.4.23.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>PXB-1462: Long <code>gtid_executed</code> breaks <code>--history</code> functionality.</p> </li> <li> <p>PXB-2486: When the <code>--encrypt</code> and <code>--parallel</code> parameters are used, XtraBackup does not handle a broken pipe correctly.</p> </li> <li> <p>PXB-1855: Format correction for the `xtrabackup \u2013databasesv options.</p> </li> <li> <p>PXB-2427: Update the XtraBackup Help description for the parameter <code>--stream</code>.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.24.html","title":"Percona XtraBackup 2.4.24","text":"<ul> <li> <p>Date</p> <p>September 14, 2021</p> </li> <li> <p>Installation</p> <p>Installing Percona XtraBackup</p> </li> </ul> <p>Percona XtraBackup enables MySQL backups without blocking user queries, making it ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, it drives down backup costs while providing unique features for MySQL backups.</p>"},{"location":"release-notes/2.4/2.4.24.html#improvements","title":"Improvements","text":"<ul> <li> <p>PXB-2477: The xbcloud Binary should retry on error and utilize incremental backoff (Thanks to Baptiste Mille-Mathias for reporting this issue)</p> </li> <li> <p>PXB-2580: With the xbcloud binary, a chunk-upload on SSL connect error to Amazon S3 was not retried. (Thanks to Tim Vaillancourt for providing the patch)</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.24.html#bugs-fixed","title":"Bugs Fixed","text":"<p>PXB-1504: The FIND_GCRYPT macro is broken. (Thanks to Maxim Bublis for reporting this issue)</p>"},{"location":"release-notes/2.4/2.4.25.html","title":"Percona XtraBackup 2.4.25","text":"<ul> <li> <p>Date</p> <p>April 26, 2022</p> </li> </ul> <p>Percona XtraBackup for MySQL Databases enables MySQL backups without blocking user queries. Percona XtraBackup is ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, Percona XtraBackup drives down backup costs while providing unique features for MySQL backups.</p> <p>Percona XtraBackup 2.4 does not support making backups of databases created in MySQL 8.0, Percona Server for MySQL 8.0, or Percona XtraDB Cluster 8.0. Use Percona XtraBackup 8.0 to make backups for these versions.</p>"},{"location":"release-notes/2.4/2.4.25.html#release-highlights","title":"Release Highlights","text":"<p>The xbcloud binary adds support for the Microsoft Azure Cloud Storage using the REST API.</p>"},{"location":"release-notes/2.4/2.4.25.html#new-features","title":"New Features","text":"<ul> <li>PXB-1883: Implements support for Microsoft Azure Cloud Storage in the xbcloud binary. (Thanks to Ivan Groenewold for reporting this issue)</li> </ul>"},{"location":"release-notes/2.4/2.4.25.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>PXB-2608: Upgraded the Vault API to V2 (Thanks to Benedito Marques Magalhaes for reporting this issue)</p> </li> <li> <p>PXB-2649: Fix for compilation issues on GCC-10.</p> </li> <li> <p>PXB-2648: CURL prior to 7.38.0 version doesn\u2019t use CURLE_HTTP2 and throws an error <code>'CURLE_HTTP2' is not a member of 'CURLcode'</code>. Added CURLE_OBSOLETE16 as a connectivity error code. In CURL versions after 7.38.0, CURLE_OBSOLETE16 is translated to CURLE_HTTP2.</p> </li> <li> <p>PXB-2711: Fix for libgcrypt initialization warnings in xtrabackup.</p> </li> <li> <p>PXB-2722: Fix for when via command line, a password, passed using the -p option, was written into the backup tool_command in xtrabackup_info.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.25.html#useful-links","title":"Useful Links","text":"<ul> <li> <p>The Percona XtraBackup installation instructions</p> </li> <li> <p>The Percona XtraBackup downloads</p> </li> <li> <p>The Percona XtraBackup GitHub location</p> </li> <li> <p>To contribute to the documentation, review the Documentation Contribution Guide</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.26.html","title":"Percona XtraBackup 2.4.26","text":"<ul> <li> <p>Date</p> <p>May 9, 2022</p> </li> </ul> <p>Percona XtraBackup for MySQL Databases enables MySQL backups without blocking user queries. Percona XtraBackup is ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, Percona XtraBackup drives down backup costs while providing unique features for MySQL backups.</p> <p>Percona XtraBackup 2.4 does not support making backups of databases created in MySQL 8.0, Percona Server for MySQL 8.0, or Percona XtraDB Cluster 8.0. Use Percona XtraBackup 8.0 to make backups for these versions.</p>"},{"location":"release-notes/2.4/2.4.26.html#release-highlights","title":"Release Highlights","text":"<p>Fixed a segmentation fault when creating a tmpdir.</p>"},{"location":"release-notes/2.4/2.4.26.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li>PXB-2756: Fixed a segmentation fault when creating a tmpdir.</li> </ul>"},{"location":"release-notes/2.4/2.4.26.html#useful-links","title":"Useful Links","text":"<ul> <li> <p>The Percona XtraBackup installation instructions</p> </li> <li> <p>The Percona XtraBackup downloads</p> </li> <li> <p>The Percona XtraBackup GitHub location</p> </li> <li> <p>To contribute to the documentation, review the Documentation Contribution Guide</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.27.html","title":"Percona XtraBackup 2.4.27 (2022-12-06)","text":"Release date December 06, 2022 Install instructions Install Percona XtraBackup 2.4 Download this version Percona XtraBackup 2.4 <p>Percona XtraBackup for MySQL Databases enables MySQL backups without blocking user queries. Percona XtraBackup is ideal for companies with large data sets and mission-critical applications that cannot tolerate long periods of downtime. Offered free as an open source solution, Percona XtraBackup drives down backup costs while providing unique features for MySQL backups.</p> <p>Percona XtraBackup 2.4 does not support making backups of databases created in MySQL 8.0, Percona Server for MySQL 8.0, or Percona XtraDB Cluster 8.0. Download Percona XtraBackup 8.0 to make backups for these versions.</p>"},{"location":"release-notes/2.4/2.4.27.html#release-highlights","title":"Release highlights","text":"<p>This release contains fixes for backing up Percona XtraDB Cluster (PXC) and an xbcloud fix.</p>"},{"location":"release-notes/2.4/2.4.27.html#bugs-fixed","title":"Bugs fixed","text":"<ul> <li> <p>PXB-2809: <code>wsrep_sync_wait&lt;&gt;0</code> caused a <code>Lock wait timeout exceeded</code> error when issued against Percona XtraDB Cluster (Thanks to Frank Well for providing the initial patch).</p> </li> <li> <p>PXB-2840: Xbcloud did not have a required set location constraint when creating a bucket on a non-default endpoint (Thanks to Jason Zareski for the patch).</p> </li> <li> <p>PXB-2906: Fixed failed query errors in backup for <code>wsrep_sync_wait</code> and <code>group-replication-consistency</code>.</p> </li> <li> <p>PXB-2729: Percona XtraBackup compilation failed if GTest packages are installed.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.27.html#platform-support","title":"Platform support","text":"<ul> <li> <p>Percona XtraBackup 2.4.27 supports Oracle Linux/Red Hat Enterprise 9.</p> </li> <li> <p>Percona XtraBackup 2.4.27 supports Ubuntu 22.04.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.27.html#useful-links","title":"Useful links","text":"<ul> <li> <p>Percona XtraBackup GitHub location</p> </li> <li> <p>Read the Documentation Contribution Guide to add to the documentation.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.3.html","title":"Percona XtraBackup 2.4.3","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.3 on May 23rd 2016. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.3.html#new-features","title":"New features","text":"<p>Percona XtraBackup has implemented new <code>xtrabackup --reencrypt-for-server-id</code> option. Using this option allows users to start the server instance with different <code>server_id</code> from the one the encrypted backup was taken from, like a replication slave or a galera node. When this option is used, xtrabackup will, as a prepare step, generate a new master key with ID based on the new <code>server_id</code>, store it into keyring file and re-encrypt the tablespace keys inside of tablespace headers.</p>"},{"location":"release-notes/2.4/2.4.3.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>Running DDL statements on Percona Server for MySQL 5.7 during the backup process could in some cases lead to failure while preparing the backup. Bug fixed PXB-247.</p> </li> <li> <p>MySQL 5.7 can sometimes skip redo logging when creating an index. If such <code>ALTER TABLE</code> is being issued during the backup, the backup would be inconsistent. xtrabackup will now abort with error message if such <code>ALTER TABLE</code> has been done during the backup. Bug fixed PXB-249.</p> </li> <li> <p><code>.ibd</code> files for remote tablespaces were not copied back to original location pointed by the .isl files. Bug fixed PXB-466.</p> </li> <li> <p>When called with insufficient parameters, like specifying the empty <code>xtrabackup --defaults-file</code> option, Percona XtraBackup could crash. Bug fixed PXB-471.</p> </li> <li> <p>Documentation states that the default value for <code>xtrabackup --ftwrl-wait-query-type</code> is <code>all</code>, however it was <code>update</code>. Changed the default value to reflect the documentation. Bug fixed PXB-472.</p> </li> <li> <p>When <code>xtrabackup --keyring-file-data</code> option was specified, but no keyring file was found, xtrabackup would create an empty one instead of reporting an error. Bug fixed PXB-476.</p> </li> <li> <p>If <code>ALTER INSTANCE ROTATE INNODB MASTER KEY</code> was run at same time when <code>xtrabackup --backup</code> was bootstrapping it could catch a moment when the key was not written into the keyring file yet and xtrabackup would overwrite the keyring with the old copy of a keyring, so the new key would be lost. Bug fixed PXB-478.</p> </li> <li> <p>Output of <code>xtrabackup --slave-info</code> option was missing an apostrophe. Bug fixed PXB-940.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.4.html","title":"Percona XtraBackup 2.4.4","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.4 on July 25th 2016. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.4.html#new-features","title":"New features","text":"<p>Percona XtraBackup has been rebased on MySQL 5.7.13.</p>"},{"location":"release-notes/2.4/2.4.4.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>Percona XtraBackup reported the difference in the actual size of the system tablespace and the size which was stored in the tablespace header. This check is now skipped for tablespaces with autoextend support. Bug fixed PXB-462.</p> </li> <li> <p>Because Percona Server for MySQL 5.5 and MySQL 5.6 store the LSN offset for large log files at different places inside the redo log header, Percona Xtrabackup was trying to guess which offset is better to use by trying to read from each one and compare the log block numbers and assert <code>lsn_chosen == 1</code> when both LSNs looked correct, but they were different. Fixed by improving the server detection. Bug fixed PXB-473.</p> </li> <li> <p>Percona XtraBackup didn\u2019t correctly detect when tables were both compressed and encrypted. Bug fixed PXB-477.</p> </li> <li> <p>Percona XtraBackup would crash if the keyring file was empty. Bug fixed PXB-479.</p> </li> <li> <p>Backup couldn\u2019t be prepared when the size in cache didn\u2019t match the physical size. Bug fixed PXB-482.</p> </li> <li> <p>Free Software Foundation address in copyright notices was outdated. Bug fixed PXB-663.</p> </li> <li> <p>Backup process would fail if the <code>datadir</code> specified on the command-line was not the same as one that is reported by the server. Percona XtraBackup now allows the <code>datadir</code> from <code>my.cnf</code> override the one from <code>SHOW VARIABLES</code>. xtrabackup will print a warning that they don\u2019t match, but continue. Bug fixed PXB-741.</p> </li> <li> <p>With upstream change of maximum page size from 16K to 64K, the size of incremental buffer became 1G. Which increased the requirement to 1G of RAM in order to prepare the backup. While in fact there is no need to allocate such a large buffer for smaller pages. Bug fixed PXB-753.</p> </li> <li> <p>Backup process would fail on MariaDB Galera cluster operating in GTID mode if binary logs were in non-standard directory. Bug fixed PXB-936.</p> </li> </ul> <p>Other bugs fixed: PXB-755, PXB-756, and PXB-759.</p>"},{"location":"release-notes/2.4/2.4.5.html","title":"Percona XtraBackup 2.4.5","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.5 on November 29th 2016. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.5.html#new-features","title":"New features","text":"<ul> <li> <p>Percona XtraBackup now supports <code>SHA256</code> passwords. Using the <code>SHA256</code> algorithm requires either SSL encrypted connection, or using public key encryption for password exchange which is only available when both client and server are linked with OpenSSL.</p> </li> <li> <p>Percona XtraBackup now supports Command Options for Secure Connections.</p> </li> <li> <p>NOTE: Due to xbcrypt format changes, backups encrypted with this Percona XtraBackup version will not be recoverable by older versions.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.5.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>Percona XtraBackup would crash while preparing the backup, during the shutdown, when master thread was performing checkpoint and purge thread was expecting that all other threads completed or were idle. Bug fixed PXB-483.</p> </li> <li> <p>Safe slave backup algorithm performed too short delays between retries which could cause backups to fail on a busy servers. Bug fixed PXB-484.</p> </li> <li> <p>Percona XtraBackup didn\u2019t check the logblock checksums. Bug fixed PXB-485.</p> </li> <li> <p>Fixed new compilation warnings with GCC 6. Bug fixed PXB-487.</p> </li> <li> <p>xbcrypt was not setting the Initialization Vector (IV) correctly (and thus is was not using an IV). This was causing the same ciphertext to be generated across different runs (for the same message/same key). The IV provides the extra randomness to ensure that the same ciphertext is not generated across runs. Bug fixed PXB-490.</p> </li> <li> <p><code>target-dir</code> was no longer relative to current directory but to <code>datadir</code> instead. Bug fixed PXB-760.</p> </li> <li> <p>Backup would still succeed even if xtrabackup would fail to write the metadata. Bug fixed PXB-763.</p> </li> <li> <p>xbcloud now supports EMC ECS Swift API Authorization requests. Bugs fixed PXB-769 and PXB-770 (Txomin Barturen).</p> </li> <li> <p>Some older versions of MySQL did not bother to initialize page type field for pages which are not index pages (see upstream #76262 for more information). Having this page type uninitialized could cause xtrabackup to crash on prepare. Bug fixed PXB-772.</p> </li> <li> <p>Percona XtraBackup would fail to backup MariaDB 10.2 with the <code>unsupported server version</code> error message. Bug fixed PXB-1027.</p> </li> <li> <p>Fixed misleading error message about missing metadata. Bug fixed PXB-752.</p> </li> <li> <p>Backing up with an SSL user didn\u2019t work correctly. Bug fixed PXB-750.</p> </li> </ul> <p>Other bugs fixed: PXB-486, PXB-771, PXB-773, and PXB-774.</p>"},{"location":"release-notes/2.4/2.4.6.html","title":"Percona XtraBackup 2.4.6","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.6 on February 22nd 2017. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.6.html#new-features","title":"New features","text":"<p>Percona XtraBackup has implemented new <code>xtrabackup --remove-original</code> option that can be used to remove the encrypted and compressed files once they\u2019ve been decrypted/decompressed.</p>"},{"location":"release-notes/2.4/2.4.6.html#bugs-fixed","title":"Bugs Fixed","text":"<ul> <li> <p>xtrabackup was using username set for server in a configuration file even if a different user was defined in the users configuration file. Bug fixed PXB-463.</p> </li> <li> <p>Incremental backups did not include <code>xtrabackup_binlog_info</code> and xtrabackup_galera_info files. Bug fixed PXB-489.</p> </li> <li> <p>In case a warning was written to stout instead of stderr during the streaming backup, it could cause assertion in the xbstream. Bug fixed PXB-491.</p> </li> <li> <p><code>xtrabackup --move-back</code> did not always restore out-of-datadir tablespaces to their original directories. Bug fixed PXB-492.</p> </li> <li> <p>innobackupex and xtrabackup scripts were showing the password in the <code>ps</code> output when it was passed as a command line argument. Bug fixed PXB-585</p> </li> <li> <p>Incremental backup would fail with path like <code>~/backup/inc_1</code> because xtrabackup didn\u2019t properly expand tilde. Bug fixed PXB-775.</p> </li> <li> <p>Fixed missing dependency check for <code>perl(Digest::MD5)</code> in rpm packages. Bug fixed PXB-777.</p> </li> <li> <p>Percona XtraBackup now supports <code>-H</code>, <code>-h</code>, <code>-u</code> and <code>-p</code> shortcuts for <code>--hostname</code>, <code>--datadir</code>, <code>--user</code> and <code>--password</code> respectively. Bugs fixed PXB-947 and PXB-1032.</p> </li> <li> <p>[UPDATE 2016-02-28]: New packages have been pushed to repositories with incremented package version to address the bug PXB-497.</p> </li> </ul> <p>Other bugs fixed: PXB-945.</p>"},{"location":"release-notes/2.4/2.4.7-2.html","title":"Percona XtraBackup 2.4.7-2","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.7-2 on May 29th 2017. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the current GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.7-2.html#bugs-fixed","title":"Bugs fixed","text":"<p>Fixed build failure on Debian 9.0 (Stretch). Bug fixed PXB-501.</p>"},{"location":"release-notes/2.4/2.4.7.html","title":"Percona XtraBackup 2.4.7","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.7 on April 17th 2017. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the current GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.7.html#new-features","title":"New Features","text":"<ul> <li> <p>Percona XtraBackup now uses hardware accelerated implementation of <code>crc32</code> where it is supported.</p> </li> <li> <p>Percona XtraBackup has implemented new options: <code>xtrabackup --tables-exclude</code> and <code>xtrabackup --databases-exclude</code> that work similar to <code>xtrabackup --tables</code> and <code>xtrabackup --databases</code> options, but exclude given names/paths from backup.</p> </li> <li> <p>The xbstream binary now supports parallel extraction with the <code>--parallel</code> option.</p> </li> <li> <p>The xbstream binary now supports following new options: <code>--decrypt</code>, <code>--encrypt-threads</code>, <code>--encrypt-key</code>, and <code>--encrypt-key-file</code>. When <code>--decrypt</code> option is specified xbstream will automatically decrypt encrypted files when extracting input stream. Either <code>--encrypt-key</code> or <code>--encrypt-key-file</code> options must be specified to provide encryption key, but not both. Option <code>--encrypt-threads</code> specifies the number of worker threads doing the encryption, default is <code>1</code>.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.7.html#bugs-fixed","title":"Bugs fixed","text":"<ul> <li> <p>Backups were missing *.isl files for general tablespace. Bug fixed PXB-494.</p> </li> <li> <p>In 5.7 MySQL changed default checksum algorithm to <code>crc32</code>, while xtrabackup was using <code>innodb</code>. This caused xtrabackup to perform extra checksum calculations which were not needed. Bug fixed PXB-495.</p> </li> <li> <p>For system tablespaces consisting of multiple files xtrabackup updated LSN only in first file. This caused MySQL versions lower than 5.7 to fail on startup. Bug fixed PXB-498.</p> </li> <li> <p><code>xtrabackup --export</code> can now export tables that have more than 31 index. Bug fixed PXB-58.</p> </li> <li> <p><code>Unrecognized character \\x01; marked by &lt;-- HERE</code> message could be seen if backups were taken with the version check enabled. Bug fixed PXB-944.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.8.html","title":"Percona XtraBackup 2.4.8","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.8 on July 24th 2017. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the current GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.8.html#new-features","title":"New Features","text":"<ul> <li> <p>To avoid issues with MySQL 5.7 skipping redo log for DDL Percona XtraBackup has implemented three new options (<code>xtrabackup --lock-ddl</code>, <code>xtrabackup --lock-ddl-timeout</code>, <code>xtrabackup --lock-ddl-per-table</code>) that can be used to place MDL locks on tables while they are copied.</p> </li> <li> <p>New <code>xtrabackup --check-privileges</code> option has been implemented that can be used to check if Percona XtraBackup has all required privileges to perform the backup.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.8.html#bugs-fixed","title":"Bugs fixed","text":"<ul> <li> <p>xtrabackup would hang with <code>Waiting for master thread to be suspended</code> message when backup was being prepared. Bug fixed PXB-499.</p> </li> <li> <p>xtrabackup would fail to prepare the backup with <code>6th page is not initialized</code> message in case server didn\u2019t properly initialize the page. Bug fixed PXB-500.</p> </li> <li> <p>xbstream could run out of file descriptors while extracting the backup which contains many tables. Bug fixed PXB-503</p> </li> <li> <p>When a table was created with the <code>DATA DIRECTORY</code> option xtrabackup would back up the <code>.frm</code> and <code>.isl</code> files, but not the <code>.ibd</code> file. Due to the missing <code>.ibd</code> files backup then could not be restored. Bug fixed PXB-504.</p> </li> <li> <p>Percona XtraBackup incorrectly determined use of <code>master_auto_postion</code> on a slave, and thus generated invalid xtrabackup_slave_info file. Bug fixed PXB-505.</p> </li> <li> <p>Percona XtraBackup will now print a warning if it encounters unsupported storage engine. Bug fixed PXB-713.</p> </li> <li> <p>Percona XtraBackup would crash while backing up MariaDB 10.2.x with <code>--ftwrl-\\*</code> options. Bug fixed PXB-790.</p> </li> <li> <p><code>xtrabackup --slave-info</code> didn\u2019t write the correct information into <code>xtrabackup_slave_info</code> file when multi-source replication was used. Bug fixed PXB-1022.</p> </li> <li> <p>Along with xtrabackup_checkpints file, xtrabackup now copies <code>xtrabackup_info</code> file into directory specified by <code>xtrabackup --extra-lsndir</code> option. Bug fixed PXB-1026.</p> </li> <li> <p>GTID position was not recorded when xtrabackup \u2013binlog-info option was set to <code>AUTO</code>. Bug fixed PXB-1030.</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.9.html","title":"Percona XtraBackup 2.4.9","text":"<p>Percona is glad to announce the release of Percona XtraBackup 2.4.9 on November 29th 2017. Downloads are available from our download site and from apt and yum repositories.</p> <p>This release is the current GA (Generally Available) stable release in the 2.4 series.</p>"},{"location":"release-notes/2.4/2.4.9.html#new-features","title":"New Features","text":"<ul> <li> <p>Percona XtraBackup packages are now available for Ubuntu 17.10 (Artful).</p> </li> <li> <p>xbcrypt now has an ability to decrypt files in parallel by specifying the number of threads with the <code>xtrabackup --encrypt-threads</code> option.</p> </li> <li> <p><code>xtrabackup --copy-back</code> option can now be used with <code>xtrabackup --parallel</code> option to copy the user data files in parallel (redo logs and system tablespaces are copied in the main thread).</p> </li> </ul>"},{"location":"release-notes/2.4/2.4.9.html#bugs-fixed","title":"Bugs fixed","text":"<ul> <li> <p>Percona XtraBackup would fail to backup large databases on 32-bit platforms. Bug fixed PXB-481.</p> </li> <li> <p>Percona XtraBackup failed to build with GCC 7. Bug fixed PXB-502.</p> </li> <li> <p>Percona XtraBackup would hang during the prepare phase if there was not enough room in log buffer to accommodate checkpoint information at the end of the crash recovery process. Bug fixed PXB-506.</p> </li> <li> <p>When backup was streamed in tar format with with the <code>xtrabackup --slave-info</code> option output file <code>xtrabackup_slave_info</code> did not contain the slave information. Bug fixed PXB-507.</p> </li> <li> <p>If xtrabackup \u2013slave-info was used while backing up 5.7 instances, the master binary log coordinates were not properly displayed in the logs. Bug fixed PXB-508.</p> </li> <li> <p><code>innobackupex --slave-info</code> would report a single <code>m</code> instead of <code>slave info</code> in the standard output. Bug fixed PXB-510.</p> </li> <li> <p>Percona XtraBackup would crash while preparing the 5.5 backup with <code>utf8_general50_ci</code> collation. Bug fixed PXB-748 (Fungo Wang).</p> </li> <li> <p>Percona XtraBackup would crash if <code>xtrabackup --throttle</code> was used while preparing backups. Fixed by making this option available only during the backup process. Bug fixed PXB-789.</p> </li> <li> <p>Percona XtraBackup could get stuck if backups are taken with <code>xtrabackup --safe-slave-backup</code> option, while there were long running queries. Bug fixed PXB-1039.</p> </li> </ul> <p>Other bugs fixed: PXB-250, PXB-511, and PXB-512.</p>"},{"location":"using_xtrabackup/configuring.html","title":"Configuring xtrabackup","text":"<p>All of the xtrabackup configuration is done through options, which behave exactly like standard MySQL program options: they can be specified either at the command-line, or through a file such as <code>/etc/my.cnf</code>.</p> <p>The xtrabackup binary reads the <code>[mysqld]</code> and <code>[xtrabackup]</code> sections from any configuration files, in that order. That is so that it can read its options from your existing MySQL installation, such as the datadir or some of the InnoDB options. If you want to override these, just specify them in the <code>[xtrabackup]</code> section, and because it is read later, it will take precedence.</p> <p>You don\u2019t need to put any configuration in your <code>my.cnf</code> if you don\u2019t want to. You can simply specify the options on the command-line. Normally, the only thing you might find convenient to place in the <code>[xtrabackup]</code> section of your <code>my.cnf</code> file is the <code>target_dir</code> option to default the directory in which the backups will be placed, for example:</p> <pre><code>[xtrabackup]\ntarget_dir = /data/backups/mysql/\n</code></pre> <p>This manual will assume that you do not have any file-based configuration for xtrabackup, so it will always show command-line options being used explicitly. Please see the option and variable reference for details on all of the configuration options.</p> <p>The xtrabackup binary does not accept exactly the same syntax in the <code>my.cnf</code> file as the <code>mysqld</code> server binary does. For historical reasons, the <code>mysqld</code> server binary accepts parameters with a <code>--set-variable=&lt;variable&gt;=&lt;value&gt;</code> syntax, which xtrabackup does not understand. If your my.cnf file has such configuration directives, you should rewrite them in the <code>--variable=value</code> syntax.</p>"},{"location":"using_xtrabackup/configuring.html#system-configuration-and-nfs-volumes","title":"System Configuration and NFS Volumes","text":"<p>The xtrabackup tool requires no special configuration on most systems. However, the storage where the <code>xtrabackup --target-dir</code> is located must behave properly when <code>fsync()</code> is called. In particular, we have noticed that NFS volumes not mounted with the <code>sync</code> option might not really sync the data. As a result, if you back up to an NFS volume mounted with the async option, and then try to prepare the backup from a different server that also mounts that volume, the data might appear to be corrupt. You can use the <code>sync</code> mount option to avoid this problem.</p>"},{"location":"using_xtrabackup/privileges.html","title":"Connection and Privileges Needed","text":"<p>Percona XtraBackup needs to be able to connect to the database server and perform operations on the server and the datadir when creating a backup, when preparing in some scenarios and when restoring it. In order to do so, there are privileges and permission requirements on its execution that must be fulfilled.</p> <p>Privileges refers to the operations that a system user is permitted to do in the database server. They are set at the database server and only apply to users in the database server.</p> <p>Permissions are those which permits a user to perform operations on the system, like reading, writing or executing on a certain directory or start/stop a system service. They are set at a system level and only apply to system users.</p> <p>Whether xtrabackup or innobackupex is used, there are two actors involved: the user invoking the program - a system user - and the user performing action in the database server - a database user. Note that these are different users in different places, even though they may have the same username.</p> <p>All the invocations of innobackupex and xtrabackup in this documentation assume that the system user has the appropriate permissions and you are providing the relevant options for connecting the database server - besides the options for the action to be performed - and the database user has adequate privileges.</p>"},{"location":"using_xtrabackup/privileges.html#connecting-to-the-server","title":"Connecting to the server","text":"<p>The database user used to connect to the server and its password are specified by the <code>xtrabackup --user</code> and <code>xtrabackup \u2013password</code> option:</p> <pre><code>$ xtrabackup --user=DVADER --password=14MY0URF4TH3R --backup \\\n--target-dir=/data/bkps/\n$ innobackupex --user=DBUSER --password=SECRET /path/to/backup/dir/\n$ innobackupex --user=LUKE  --password=US3TH3F0RC3 --stream=tar ./ | bzip2 -\n</code></pre> <p>If you don\u2019t use the <code>xtrabackup --user</code> option, Percona XtraBackup will assume the database user whose name is the system user executing it.</p>"},{"location":"using_xtrabackup/privileges.html#other-connection-options","title":"Other Connection Options","text":"<p>According to your system, you may need to specify one or more of the following options to connect to the server:</p> Option Description \u2013port The port to use when connecting to the database server with TCP/IP. \u2013socket The socket to use when connecting to the local database. \u2013host The host to use when connecting to the database server with TCP/IP. <p>These options are passed to the mysql child process without alteration, see <code>mysql --help</code> for details.</p> <p>Note</p> <p>In case of multiple server instances the correct connection parameters (port, socket, host) must be specified in order for xtrabackup to talk to the correct server.</p>"},{"location":"using_xtrabackup/privileges.html#permissions-and-privileges-needed","title":"Permissions and Privileges Needed","text":"<p>Once connected to the server, in order to perform a backup you will need <code>READ</code> and <code>EXECUTE</code> permissions at a filesystem level in the server\u2019s datadir.</p> <p>The database user needs the following privileges on the tables/databases to be backed up:</p> <ul> <li> <p><code>RELOAD</code> and <code>LOCK TABLES</code> (unless the  \u2013no-lock  option is specified) in order  to <code>FLUSH TABLES WITH READ LOCK</code> and <code>FLUSH ENGINE LOGS</code> prior to start  copying the files, and  <code>LOCK TABLES FOR BACKUP</code> and <code>LOCK BINLOG FOR  BACKUP</code> require this privilege when Backup Locks are used. <li> <p><code>REPLICATION CLIENT</code> in order to obtain the binary log position.</p> </li> <li> <p><code>CREATE TABLESPACE</code> in order to import tables (see Restoring Individual Tables).</p> </li> <li> <p><code>PROCESS</code> in order to run <code>SHOW ENGINE INNODB STATUS</code> (which is  mandatory), and optionally to see all threads which are running on the  server (see Improved FLUSH TABLES WITH READ LOCK handling).</p> </li> <li> <p><code>SUPER</code> in order to start/stop the replica threads in a replication  environment, use XtraDB Changed Page Tracking  for Incremental Backups and for Improved FLUSH TABLES WITH READ LOCK handling.</p> </li> <li> <p><code>CREATE</code> privilege in order to create the  PERCONA_SCHEMA.xtrabackup_history database and table.</p> </li> <li> <p><code>ALTER</code> privilege in order to upgrade the  PERCONA_SCHEMA.xtrabackup_history database and table.</p> </li> <li> <p><code>INSERT</code> privilege in order to add history records to the  PERCONA_SCHEMA.xtrabackup_history table.</p> </li> <li> <p><code>SELECT</code> privilege in order to use  <code>innobackupex --incremental-history-name</code> or  <code>innobackupex --incremental-history-uuid</code> in order for the feature  to look up the <code>innodb_to_lsn</code> values in the  PERCONA_SCHEMA.xtrabackup_history table.</p> </li> <p>The explanation of when these are used can be found in How Percona XtraBackup Works.</p> <p>An SQL example of creating a database user with the minimum privileges required to full backups would be:</p> <pre><code>mysql&gt; CREATE USER 'bkpuser'@'localhost' IDENTIFIED BY 's3cret';\nmysql&gt; GRANT RELOAD, LOCK TABLES, PROCESS, REPLICATION CLIENT ON *.* TO\n'bkpuser'@'localhost';\nmysql&gt; FLUSH PRIVILEGES;\n</code></pre>"},{"location":"xbcloud/xbcloud.html","title":"The xbcloud Binary","text":"<p>The purpose of xbcloud is to download and upload full or part of xbstream archive from/to the cloud. xbcloud will not overwrite the backup with the same name. xbcloud accepts input via a pipe from xbstream so that it can be invoked as a pipeline with xtrabackup to stream directly to the cloud without needing a local storage.</p> <p>Note</p> <p>In a Bash shell, the <code>$?</code> parameter returns the exit code from the last binary. If you use pipes the <code>${PIPESTATUS[x]}</code> array parameter returns the exit codes for each binary in the pipe string.</p> <pre><code>$ xtrabackup --backup --stream=xbstream --target-dir=/storage/backups/ | xbcloud put [options] full_backup\n\n&gt; true | false\n&gt; echo $?\n&gt; 1\n\n# with PIPESTATUS\n&gt; true | false\n&gt; echo ${PIPESTATUS[0]} ${PIPESTATUS[1]}\n&gt; 0 1\n</code></pre> <p>The xbcloud binary stores each chunk as a separate object with a name <code>backup_name/database/table.ibd.NNNNNNNNNNNNNNNNNNNN</code>, where <code>NNN...</code> is a 0-padded serial number of chunk within a file. Size of chunk produced by xtrabackup and xbstream changed to 10MB.</p> <p>Note</p> <p>Use <code>--read-buffer-size</code> to adjust the chunk size.</p> <p>If you use encryption, specify both the <code>--read-buffer-size</code> and <code>--encrypt-chunk-size</code> options to adjust the chunk size.</p> <p>xbcloud has three essential operations: put, get, and delete. With these operations, backups are created, stored, retrieved, restored, and deleted. xbcloud operations clearly map to similar operations within the AWS S3 API.</p>"},{"location":"xbcloud/xbcloud.html#version-specific-information","title":"Version specific information","text":"<ul> <li> <p>2.4.25 - Added the support for Microsoft Azure Cloud Storage</p> </li> <li> <p>2.4.21 - Added s3-storage-class and google-storage-class</p> </li> <li> <p>2.4.14 - Added the support of Amazon S3, MinIO and Google Cloud Storage storage types.</p> </li> <li> <p>2.3.1-beta1 - Implemented ability to store xbcloud parameters in a .cnf file</p> </li> <li> <p>2.3.1-beta1 - Implemented support different authentication options for Swift</p> </li> <li> <p>2.3.1-beta1 - Implemented support for partial download of the cloud backups</p> </li> <li> <p>2.3.1-beta1 - <code>xbcloud --swift-url</code> option has been renamed to <code>xbcloud --swift-auth-url</code></p> </li> <li> <p>2.3.0-alpha1 - Initial implementation</p> </li> </ul>"},{"location":"xbcloud/xbcloud.html#supported-cloud-storage-types","title":"Supported Cloud Storage Types","text":"<p>Swift was the only option for storing backups in cloud storage until Percona XtraBackup 2.4.14.</p> <p>The xbcloud binary supports Amazon S3, Azure, MinIO and Google Cloud Storage. Amazon S3-compatible cloud storage types, such as Wasabi and Digital Ocean Spaces, are also supported. The xbcloud binary should work with other S3-compatible storage options.</p> <p>See also</p> <p>OpenStack Object Storage (\u201cSwift\u201d)</p> <p>Amazon Simple Storage Service</p> <p>Azure Cloud Storage</p> <p>MinIO</p> <p>Google Cloud Storage</p> <p>Wasabi</p> <p>Digital Ocean Spaces</p>"},{"location":"xbcloud/xbcloud.html#usage","title":"Usage","text":"<pre><code>$ xtrabackup --backup --stream=xbstream --target-dir=/tmp | xbcloud \\\nput [options] &lt;name&gt;\n</code></pre>"},{"location":"xbcloud/xbcloud.html#creating-a-full-backup-with-swift","title":"Creating a full backup with Swift","text":"<p>The following example shows how to make a full backup and upload it to Swift.</p> <pre><code>$ xtrabackup --backup --stream=xbstream --extra-lsndir=/tmp --target-dir=/tmp | \\\nxbcloud put --storage=swift \\\n--swift-container=test \\\n--swift-user=test:tester \\\n--swift-auth-url=http://192.168.8.80:8080/ \\\n--swift-key=testing \\\n--parallel=10 \\\nfull_backup\n</code></pre>"},{"location":"xbcloud/xbcloud.html#creating-a-full-backup-with-amazon-s3","title":"Creating a full backup with Amazon S3","text":"<pre><code>$ xtrabackup --backup --stream=xbstream --extra-lsndir=/tmp --target-dir=/tmp | \\\nxbcloud put --storage=s3 \\\n--s3-endpoint='s3.amazonaws.com' \\\n--s3-access-key='YOUR-ACCESSKEYID' \\\n--s3-secret-key='YOUR-SECRETACCESSKEY' \\\n--s3-bucket='mysql_backups'\n--parallel=10 \\\n$(date -I)-full_backup\n</code></pre> <p>The following options are available when using Amazon S3:</p> Option Details \u2013s3-access-key Use to supply the AWS access key ID \u2013s3-secret-key Use to supply the AWS secret access key \u2013s3-bucket Use supply the AWS bucket name \u2013s3-region Use to specify the AWS region. The default value is us-east-1 \u2013s3-api-version = &lt;AUTO|2|4&gt; Select the signing algorithm. The default value is AUTO. In this case, xbcloud will probe. \u2013s3-bucket-lookup = &lt;AUTO|PATH|DNS&gt; Specify whether to use bucket.endpoint.com or endpoint.com/bucket* style requests. The default value is AUTO. In this case, xbcloud will probe. \u2013s3-storage-class=&lt;name&gt; Specify the S3 storage class. The name options are the following: STANDARD STANDARD_IA GLACIER NOTE: If you use the GLACIER storage class, the object must be restored to S3 before restoring the backup. Also, supports using custom S3 implementations such as MinIO or CephRadosGW."},{"location":"xbcloud/xbcloud.html#creating-a-full-backup-with-minio","title":"Creating a full backup with MinIO","text":"<pre><code>$ xtrabackup --backup --stream=xbstream --extra-lsndir=/tmp --target-dir=/tmp | \\\nxbcloud put --storage=s3 \\\n--s3-endpoint='play.minio.io:9000' \\\n--s3-access-key='YOUR-ACCESSKEYID' \\\n--s3-secret-key='YOUR-SECRETACCESSKEY' \\\n--s3-bucket='mysql_backups'\n--parallel=10 \\\n$(date -I)-full_backup\n</code></pre>"},{"location":"xbcloud/xbcloud.html#creating-a-full-backup-with-google-cloud-storage","title":"Creating a full backup with Google Cloud Storage","text":"<p>The support for Google Cloud Storage is implemented using the interoperability mode. This mode was especially designed to interact with cloud services compatible with Amazon S3.</p> <p>See also</p> <p>Cloud Storage Interoperability   https://cloud.google.com/storage/docs/interoperability</p> <pre><code>$ xtrabackup --backup --stream=xbstream --extra-lsndir=/tmp --target-dir=/tmp | \\\nxbcloud put --storage=google \\\n--google-endpoint=`storage.googleapis.com` \\\n--google-access-key='YOUR-ACCESSKEYID' \\\n--google-secret-key='YOUR-SECRETACCESSKEY' \\\n--google-bucket='mysql_backups'\n--parallel=10 \\\n$(date -I)-full_backup\n</code></pre> <p>The following options are available when using Google Cloud Storage:</p> <ul> <li> <p>\u2013google-access-key = &lt;ACCESS KEY ID&gt;</p> </li> <li> <p>\u2013google-secret-key = &lt;SECRET ACCESS KEY&gt;</p> </li> <li> <p>\u2013google-bucket = &lt;BUCKET NAME&gt;</p> </li> <li> <p>\u2013google-storage-class=name</p> </li> </ul> <p>Note</p> <p>The Google storage class name options are the following: </p> <ul> <li> <p>STANDARD</p> </li> <li> <p>NEARLINE</p> </li> <li> <p>COLDLINE</p> </li> <li> <p>ARCHIVE </p> </li> </ul> <p>See also: Google storage classes</p>"},{"location":"xbcloud/xbcloud.html#supplying-parameters","title":"Supplying parameters","text":"<p>Each storage type has mandatory parameters that you can supply on the command line, in a configuration file, and via environment variables.</p>"},{"location":"xbcloud/xbcloud.html#configuration-files","title":"Configuration files","text":"<p>The parameters the values of which do not change frequently can be stored in <code>my.cnf</code> or in a custom configuration file. The following example is a template of configuration options under the <code>[xbcloud]</code> group:</p> <pre><code>[xbcloud]\nstorage=s3\ns3-endpoint=http://localhost:9000/\ns3-access-key=minio\ns3-secret-key=minio123\ns3-bucket=backupsx\ns3-bucket-lookup=path\ns3-api-version=4\n</code></pre> <p>Note</p> <p>If you explicitly use a parameter on the command line and in a configuration file, xbcloud uses the the value provided on the command line.</p>"},{"location":"xbcloud/xbcloud.html#environment-variables","title":"Environment variables","text":"<p>The following environment variables are recognized. xbcloud maps them automatically to corresponding parameters applicable to the selected storage.</p> <ul> <li> <p>AWS_ACCESS_KEY_ID (or ACCESS_KEY_ID)</p> </li> <li> <p>AWS_SECRET_ACCESS_KEY (or SECRET_ACCESS_KEY)</p> </li> <li> <p>AWS_DEFAULT_REGION (or DEFAULT_REGION)</p> </li> <li> <p>AWS_ENDPOINT (or ENDPOINT)</p> </li> <li> <p>AWS_CA_BUNDLE</p> </li> </ul> <p>Note</p> <p>If you explicitly use a parameter on the command line, in a configuration file, and the corresponding environment variable contains a value, xbcloud uses the the value provided on the command line or in the configuration file.</p> <p>OpenStack environment variables are also recognized and mapped automatically to corresponding swift parameters (<code>--storage=swift</code>).</p> <ul> <li>OS_AUTH_URL</li> <li>OS_TENANT_NAME</li> <li>OS_TENANT_ID</li> <li>OS_USERNAME</li> <li>OS_PASSWORD</li> <li>OS_USER_DOMAIN</li> <li>OS_USER_DOMAIN_ID</li> <li>OS_PROJECT_DOMAIN</li> <li>OS_PROJECT_DOMAIN_ID</li> <li>OS_REGION_NAME</li> <li>OS_STORAGE_URL</li> <li>OS_CACERT</li> </ul>"},{"location":"xbcloud/xbcloud.html#shortcuts","title":"Shortcuts","text":"<p>For all operations (put, get, and delete), you can use a shortcut to specify the storage type, bucket name, and backup name as one parameter instead of using three distinct parameters (\u2013storage, \u2013s3-bucket, and backup name per se).</p> <p>Using a shortcut syntax to provide a storage type, bucket, and backup name</p> <p>Use the following format: <code>storage-type://bucket-name/backup-name</code></p> <pre><code>$ xbcloud get s3://operator-testing/bak22 ...\n</code></pre> <p>In this example, s3 refers to a storage type, operator-testing is a bucket name, and bak22 is the backup name. This shortcut expands as follows:</p> <pre><code>$ xbcloud get --storage=s3 --s3-bucket=operator-testing bak22 ...\n</code></pre> <p>You can supply the mandatory parameters not only on the command line. You may use configuration files and environment variables.</p>"},{"location":"xbcloud/xbcloud.html#additional-parameters","title":"Additional parameters","text":"<p>xbcloud accepts additional parameters that you can use with any storage type. The <code>--md5</code> parameter computes the MD5 hash value of the backup chunks. The result is stored in files that following the <code>backup_name.md5</code> pattern.</p> <pre><code>$ xtrabackup --backup --stream=xbstream \\\n--parallel=8 2&gt;backup.log | xbcloud put s3://operator-testing/bak22 \\\n--parallel=8 --md5 2&gt;upload.log\n</code></pre> <p>You may use the <code>--header</code> parameter to pass an additional HTTP header with the server side encryption while specifying a customer key.</p> <p>Example of using \u2013header for AES256 encryption</p> <pre><code>$ xtrabackup --backup --stream=xbstream --parallel=4 | \\\nxbcloud put s3://operator-testing/bak-enc/ \\\n--header=\"X-Amz-Server-Side-Encryption-Customer-Algorithm: AES256\" \\\n--header=\"X-Amz-Server-Side-Encryption-Customer-Key: CuStoMerKey=\" \\\n--header=\"X-Amz-Server-Side-Encryption-Customer-Key-MD5: CuStoMerKeyMd5==\" \\\n--parallel=8\n</code></pre> <p>The <code>--header</code> parameter is also useful to set the access control list (ACL) permissions: <code>--header=\"x-amz-acl: bucket-owner-full-control</code></p>"},{"location":"xbcloud/xbcloud.html#restoring-with-swift","title":"Restoring with Swift","text":"<pre><code>xbcloud get [options] &lt;name&gt; [&lt;list-of-files&gt;] | xbstream -x\n</code></pre> <p>The following example shows how to fetch and restore the backup from Swift:</p> <pre><code>$ xbcloud get --storage=swift \\\n--swift-container=test \\\n--swift-user=test:tester \\\n--swift-auth-url=http://192.168.8.80:8080/ \\\n--swift-key=testing \\\nfull_backup | xbstream -xv -C /tmp/downloaded_full\n\n$ xtrabackup --prepare --target-dir=/tmp/downloaded_full\n$ xtrabackup --copy-back --target-dir=/tmp/downloaded_full\n</code></pre>"},{"location":"xbcloud/xbcloud.html#restoring-with-amazon-s3","title":"Restoring with Amazon S3","text":"<pre><code>$ xbcloud get s3://operator-testing/bak22 \\\n--s3-endpoint=https://storage.googleapis.com/ \\\n--parallel=10 2&gt;download.log | xbstream -x -C restore --parallel=8\n</code></pre>"},{"location":"xbcloud/xbcloud.html#incremental-backups","title":"Incremental backups","text":"<p>First, make the full backup which is the base for an incremental backup:</p> <pre><code>$ xtrabackup --backup --stream=xbstream --extra-lsndir=/storage/backups/ \\\n--target-dir=/storage/backups/ | xbcloud put \\\n--storage=swift --swift-container=test_backup \\\n--swift-auth-version=2.0 --swift-user=admin \\\n--swift-tenant=admin --swift-password=xoxoxoxo \\\n--swift-auth-url=http://127.0.0.1:35357/ --parallel=10 \\\nfull_backup\n</code></pre> <p>Then make the incremental backup:</p> <pre><code>$ xtrabackup --backup --incremental-basedir=/storage/backups \\\n--stream=xbstream --target-dir=/storage/inc_backup | xbcloud put \\\n--storage=swift --swift-container=test_backup \\\n--swift-auth-version=2.0 --swift-user=admin \\\n--swift-tenant=admin --swift-password=xoxoxoxo \\\n--swift-auth-url=http://127.0.0.1:35357/ --parallel=10 \\\ninc_backup\n</code></pre>"},{"location":"xbcloud/xbcloud.html#preparing-an-incremental-backup","title":"Preparing an incremental backup","text":"<p>To prepare a backup, download the full backup:</p> <pre><code>$ xbcloud get --swift-container=test_backup \\\n--swift-auth-version=2.0 --swift-user=admin \\\n--swift-tenant=admin --swift-password=xoxoxoxo \\\n--swift-auth-url=http://127.0.0.1:35357/ --parallel=10 \\\nfull_backup | xbstream -xv -C /storage/downloaded_full\n</code></pre> <p>Prepare the downloaded full backup:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/storage/downloaded_full\n</code></pre> <p>After the full backup has been prepared, download the incremental backup:</p> <pre><code>$ xbcloud get --swift-container=test_backup \\\n--swift-auth-version=2.0 --swift-user=admin \\\n--swift-tenant=admin --swift-password=xoxoxoxo \\\n--swift-auth-url=http://127.0.0.1:35357/ --parallel=10 \\\ninc_backup | xbstream -xv -C /storage/downloaded_inc\n</code></pre> <p>Prepare the incremental backup:</p> <pre><code>$ xtrabackup --prepare --apply-log-only \\\n--target-dir=/storage/downloaded_full \\\n--incremental-dir=/storage/downloaded_inc\n\n$ xtrabackup --prepare --target-dir=/storage/downloaded_full\n</code></pre>"},{"location":"xbcloud/xbcloud.html#partial-download-of-the-cloud-backup","title":"Partial download of the cloud backup","text":"<p>If you don\u2019t want to download the entire backup to restore a database you can restore only specific tables:</p> <pre><code>$ xbcloud get --swift-container=test_backup\n--swift-auth-version=2.0 --swift-user=admin \\\n--swift-tenant=admin --swift-password=xoxoxoxo \\\n--swift-auth-url=http://127.0.0.1:35357/ full_backup \\\nibdata1 sakila/payment.ibd \\\n&gt; /storage/partial/partial.xbs\n\n$ xbstream -xv -C /storage/partial &lt; /storage/partial/partial.xbs\n</code></pre> <p>This command downloads the <code>ibdata1</code> table and the <code>sakila/payment.ibd</code> table from a full backup.</p>"},{"location":"xbcloud/xbcloud.html#command-line-options","title":"Command-line options","text":"<p>xbcloud has the following command line options:</p>"},{"location":"xbcloud/xbcloud.html#-storageswiftamazon-s3google","title":"\u2013storage=[swiftAmazon S3google]","text":"<p>Cloud storage option. xbcloud supports Swift, MinIO, and AWS S3. The default value is <code>swift</code>.</p>"},{"location":"xbcloud/xbcloud.html#-swift-auth-url","title":"\u2013swift-auth-url","text":"<p>URL of Swift cluster.</p>"},{"location":"xbcloud/xbcloud.html#-swift-url","title":"\u2013swift-url","text":"<p>Renamed to xbcloud \u2013swift-auth-url</p>"},{"location":"xbcloud/xbcloud.html#-swift-storage-url","title":"\u2013swift-storage-url","text":"<p>xbcloud attempts to get object-store URL for a specified region (if any specified) from the keystone response. One can override that URL by passing \u2013swift-storage-url=URL argument.</p>"},{"location":"xbcloud/xbcloud.html#-swift-user","title":"\u2013swift-user","text":"<p>Swift username (X-Auth-User, specific to Swift)</p>"},{"location":"xbcloud/xbcloud.html#-swift-key","title":"\u2013swift-key","text":"<p>Swift key/password (X-Auth-Key, specific to Swift)</p>"},{"location":"xbcloud/xbcloud.html#-swift-container","title":"\u2013swift-container","text":"<p>Container to backup into (specific to Swift)</p>"},{"location":"xbcloud/xbcloud.html#-paralleln","title":"\u2013parallel=N","text":"<p>Maximum number of concurrent upload/download requests. Default is <code>1</code>.</p>"},{"location":"xbcloud/xbcloud.html#-cacert","title":"\u2013cacert","text":"<p>Path to the file with CA certificates</p>"},{"location":"xbcloud/xbcloud.html#-insecure","title":"\u2013insecure","text":"<p>Do not verify servers certificate</p>"},{"location":"xbcloud/xbcloud.html#swift-authentication-options","title":"Swift authentication options","text":"<p>Swift specification describe several authentication options. xbcloud can authenticate against keystone with API version 2 and 3.</p>"},{"location":"xbcloud/xbcloud.html#-swift-auth-version","title":"\u2013swift-auth-version","text":"<p>Specifies the swift authentication version. Possible values are: <code>1.0</code> - TempAuth, <code>2.0</code> - Keystone v2.0, and <code>3</code> - Keystone v3. Default value is <code>1.0</code>.</p> <p>For v2 additional options are:</p>"},{"location":"xbcloud/xbcloud.html#-swift-tenant","title":"\u2013swift-tenant","text":"<p>Swift tenant name.</p>"},{"location":"xbcloud/xbcloud.html#-swift-tenant-id","title":"\u2013swift-tenant-id","text":"<p>Swift tenant ID.</p>"},{"location":"xbcloud/xbcloud.html#-swift-region","title":"\u2013swift-region","text":"<p>Swift endpoint region.</p>"},{"location":"xbcloud/xbcloud.html#-swift-password","title":"\u2013swift-password","text":"<p>Swift password for the user.</p> <p>For v3 additional options are:</p>"},{"location":"xbcloud/xbcloud.html#-swift-user-id","title":"\u2013swift-user-id","text":"<p>Swift user ID.</p>"},{"location":"xbcloud/xbcloud.html#-swift-project","title":"\u2013swift-project","text":"<p>Swift project name.</p>"},{"location":"xbcloud/xbcloud.html#-swift-project-id","title":"\u2013swift-project-id","text":"<p>Swift project ID.</p>"},{"location":"xbcloud/xbcloud.html#-swift-domain","title":"\u2013swift-domain","text":"<p>Swift domain name.</p>"},{"location":"xbcloud/xbcloud.html#-swift-domain-id","title":"\u2013swift-domain-id","text":"<p>Swift domain ID.</p>"},{"location":"xbcloud/xbcloud_azure.html","title":"Using the xbcloud binary with Microsoft Azure Cloud Storage","text":"<p>This feature is technical preview quality.</p> <p>Implemented in Percona XtraBackup 2.4.25, the xbcloud binary adds support for the Microsoft Azure Cloud Storage using the REST API.</p>"},{"location":"xbcloud/xbcloud_azure.html#options","title":"Options","text":"<p>The following are the options, environment variables, and descriptions for uploading a backup to Azure using the REST API. The environment variables are recognized by xbcloud, which maps them automatically to the corresponding parameters:</p> Option name Environment variables Description <code>--azure-storage-account=name</code> AZURE_STORAGE_ACCOUNT An Azure storage account is a unique namespace to access and store your Azure data objects. <code>--azure-container-name=name</code> AZURE_CONTAINER_NAME A container name is a valid DNS name that conforms to the Azure naming rules <code>--azure-access-key=name</code> AZURE_ACCESS_KEY A generated key that can be used to authorize access to data in your account using the Shared Key authorization. <code>--azure-endpoint=name</code> AZURE_ENDPOINT The endpoint allows clients to securely access data. <code>--azure-tier-class=name</code> AZURE_STORAGE_CLASS Cloud tier can decrease the local storage required while maintaining the performance. When enabled, this feature has the following categories:  * Hot - Frequently accessed or modified data * Cool - Infrequently accessed or modified data * Archive - Rarely accessed or modified data <p>Test your Azure applications with the Azurite open-source emulator. For testing purposes, the xbcloud binary adds the <code>--azure-development-storage</code> option that uses the default <code>access_key</code> and <code>storage account</code> of azurite and <code>testcontainer</code> for the container. You can overwrite these options, if needed.</p>"},{"location":"xbcloud/xbcloud_azure.html#usage","title":"Usage","text":"<p>All of the available options for xbcloud, such as parallel, max-retries, and others, can be used. For more information, see The xbcloud Binary.</p>"},{"location":"xbcloud/xbcloud_azure.html#examples","title":"Examples","text":"<p>An example of a xbcloud backup.</p> <pre><code>$ xtrabackup --backup --stream=xbstream --target-dir= $TARGET_DIR | xbcloud put backup_name --azure-storage-account=pxbtesting --azure-access-key=$AZURE_KEY --azure-container-name=test --storage=azure\n</code></pre> <p>An example of restoring a backup from xbcloud.</p> <pre><code>$ xbcloud get backup_name  --azure-storage-account=pxbtesting --azure-access-key=$AZURE_KEY --azure-container-name=test --storage=azure --parallel=10 2&gt;download.log | xbstream -x -C restore\n</code></pre> <p>An example of deleting a backup from xbcloud.</p> <pre><code>$ xbcloud delete backup_name --azure-storage-account=pxbtesting --azure-access-key=$AZURE_KEY --azure-container-name=test --storage=azure\n</code></pre> <p>An example of using a shortcut restore.</p> <pre><code>$ xbcloud get azure://operator-testing/bak22 ...\n</code></pre>"},{"location":"xbcloud/xbcloud_exbackoff.html","title":"Exponential Backoff","text":"<p>This feature was implemented in Percona XtraBackup 2.4.24 in the xbcloud binary.</p> <p>Exponential backoff increases the chances for the completion of a backup or a restore operation. For example, a chunk upload or download may fail if you have an unstable network connection or other network issues. This feature adds an exponential backoff, or sleep, time and then retries the upload or download.</p> <p>When a chunk upload or download operation fails, xbcloud checks the reason for the failure. This failure can be a CURL error or an HTTP error, or a client-specific error. If the error is listed in the Retriable errors list, xbcloud pauses for a calculated time before retrying the operation until that time reaches the <code>--max-backoff</code> value.</p> <p>The operation is retried until the <code>--max-retries</code> value is reached. If the chunk operation fails on the last retry, xbcloud aborts the process.</p> <p>The default values are the following:</p> <ul> <li> <p>\u2013max-backoff = 300000 (5 minutes)</p> </li> <li> <p>\u2013max-retries = 10</p> </li> </ul> <p>You can adjust the number of retries by adding the <code>--max-retries</code> parameter and adjust the maximum length of time between retries by adding the <code>--max-backoff</code> parameter to an xbcloud command.</p> <p>Since xbcloud does multiple asynchronous requests in parallel, a calculated value, measured in milliseconds, is used for <code>max-backoff</code>. This algorithm calculates how many milliseconds to sleep before the next retry. A number generated is based on the combining the power of two (2), the number of retries already attempted and adds a random number between 1 and 1000. This number avoids network congestion if multiple chunks have the same backoff value. If the default values are used, the final retry attempt to be approximately 17 minutes after the first try. The number is no longer calculated when the milliseconds reach the <code>--max-backoff</code> setting. At that point, the retries continue by using the <code>--max-backoff</code> setting until the <code>max-retries</code> parameter is reached.</p>"},{"location":"xbcloud/xbcloud_exbackoff.html#retriable-errors","title":"Retriable errors","text":"<p>We retry for the following CURL operations:</p> <ul> <li> <p>CURLE_GOT_NOTHING</p> </li> <li> <p>CURLE_OPERATION_TIMEOUT</p> </li> <li> <p>CURLE_RECV_ERROR</p> </li> <li> <p>CURLE_SEND_ERROR</p> </li> <li> <p>CURLE_SEND_FAIL_REWIND</p> </li> <li> <p>CURLE_PARTIAL_FILE</p> </li> <li> <p>CURLE_SSL_CONNECT_ERROR</p> </li> </ul> <p>We retry for the following HTTP operation status codes:</p> <ul> <li> <p>503</p> </li> <li> <p>500</p> </li> <li> <p>504</p> </li> <li> <p>408</p> </li> </ul> <p>Each cloud provider may return a different CURL error or an HTTP error, depending on the issue. Add new errors by setting the following variables <code>--curl-retriable-errors</code> or <code>--http-retriable-errors</code> on the command line or in <code>my.cnf</code> or in a custom configuration file under the [xbcloud] section.</p> <p>The error handling is enhanced when using the <code>--verbose</code> output. This output specifies which error caused xbcloud to fail and what parameter a user must add to retry on this error.</p> <p>The following is an example of a verbose output:</p> <pre><code>210701 14:34:23 /work/pxb/ins/2.4/bin/xbcloud: Operation failed. Error: Server returned nothing (no headers, no data)\n210701 14:34:23 /work/pxb/ins/2.4/bin/xbcloud: Curl error (52) Server returned nothing (no headers, no data) is not configured as retriable. You can allow it by adding --curl-retriable-errors=52 parameter\n</code></pre>"},{"location":"xbcloud/xbcloud_exbackoff.html#example","title":"Example","text":"<p>The following example adjusts the maximum number of retries and the maximum time between retries.</p> <pre><code>xbcloud [options] --max-retries=5 --max-backoff=10000\n</code></pre> <p>The following text is an example of the exponential backoff used with the command:</p> <pre><code>210702 10:07:05 /work/pxb/ins/2.4/bin/xbcloud: Operation failed. Error: Server returned nothing (no headers, no data)\n210702 10:07:05 /work/pxb/ins/2.4/bin/xbcloud: Sleeping for 2384 ms before retrying backup3/xtrabackup_logfile.00000000000000000006 [1]\n. . .\n210702 10:07:23 /work/pxb/ins/2.4/bin/xbcloud: Operation failed. Error: Server returned nothing (no headers, no data)\n210702 10:07:23 /work/pxb/ins/2.4/bin/xbcloud: Sleeping for 4387 ms before retrying backup3/xtrabackup_logfile.00000000000000000006 [2]\n. . .\n210702 10:07:52 /work/pxb/ins/2.4/bin/xbcloud: Operation failed. Error: Failed sending data to the peer\n210702 10:07:52 /work/pxb/ins/2.4/bin/xbcloud: Sleeping for 8691 ms before retrying backup3/xtrabackup_logfile.00000000000000000006 [3]\n. . .\n210702 10:08:47 /work/pxb/ins/2.4/bin/xbcloud: Operation failed. Error: Failed sending data to the peer\n210702 10:08:47 /work/pxb/ins/2.4/bin/xbcloud: Sleeping for 10000 ms before retrying backup3/xtrabackup_logfile.00000000000000000006 [4]\n. . .\n210702 10:10:12 /work/pxb/ins/2.4/bin/xbcloud: successfully uploaded chunk: backup3/xtrabackup_logfile.00000000000000000006, size: 8388660\n</code></pre> <p>The following list details the example output:</p> <p>[1.] Chunk <code>xtrabackup_logfile.00000000000000000006</code> fails to upload the first time and slept for 2384 milliseconds.</p> <p>[2.] The same chunk fails for the second time and the time is increased to 4387 milliseconds.</p> <p>[3.] The same chunk fails for the third time and the time is increased to 8691 milliseconds.</p> <p>[4.] The same chunk fails for the fourth time. The <code>max-backoff</code>=10000, which defines the maximum sleep time as 10000. Any retry sleeps the same amount of time after reaching the parameter.</p> <p>[5.] The same chunk is successfully uploaded.</p>"},{"location":"xbcrypt/xbcrypt.html","title":"The xbcrypt binary","text":"<p>To support encryption and decryption of the backups, a new tool <code>xbcrypt</code> was introduced to Percona XtraBackup.</p> <p>Percona XtraBackup 2.4.25 implements the XBCRYPT_ENCRYPTION_KEY environment variable. The variable is only used in place of the <code>--encrypt_key=name</code> option. You can use the environment variable or command line option. If you use both, the command line option takes precedence over the value specified in the environment variable.</p> <p>This utility has been modeled after The xbstream binary to perform encryption and decryption outside of Percona XtraBackup. <code>xbcrypt</code> has following command line options:</p>"},{"location":"xbcrypt/xbcrypt.html#-d-decrypt","title":"-d, \u2013decrypt","text":"<p>Decrypt data input to output.</p>"},{"location":"xbcrypt/xbcrypt.html#-i-inputname","title":"-i, \u2013input=name","text":"<p>Optional input file. If not specified, input will be read from standard input.</p>"},{"location":"xbcrypt/xbcrypt.html#-o-outputname","title":"-o, \u2013output=name","text":"<p>Optional output file. If not specified, output will be written to standard output.</p>"},{"location":"xbcrypt/xbcrypt.html#-a-encrypt-algoname","title":"-a, \u2013encrypt-algo=name","text":"<p>Encryption algorithm.</p>"},{"location":"xbcrypt/xbcrypt.html#-k-encrypt-keyname","title":"-k, \u2013encrypt-key=name","text":"<p>Encryption key.</p>"},{"location":"xbcrypt/xbcrypt.html#-f-encrypt-key-filename","title":"-f, \u2013encrypt-key-file=name","text":"<p>File which contains encryption key.</p>"},{"location":"xbcrypt/xbcrypt.html#-s-encrypt-chunk-size","title":"-s, \u2013encrypt-chunk-size=","text":"<p>Size of working buffer for encryption in bytes. The default value is 64K.</p>"},{"location":"xbcrypt/xbcrypt.html#-encrypt-threads","title":"\u2013encrypt-threads=","text":"<p>This option specifies the number of worker threads that will be used for parallel encryption/decryption.</p>"},{"location":"xbcrypt/xbcrypt.html#-v-verbose","title":"-v, \u2013verbose","text":"<p>Display verbose status output.</p>"},{"location":"xbstream/xbstream.html","title":"The xbstream binary","text":"<p>To support simultaneous compression and streaming, a new custom streaming format called xbstream was introduced to Percona XtraBackup in addition to the TAR format. That was required to overcome some limitations of traditional archive formats such as tar, cpio and others which did not allow streaming dynamically generated files, for example dynamically compressed files. Other advantages of xbstream over traditional streaming/archive format include ability to stream multiple files concurrently (so it is possible to use streaming in the xbstream format together with the \u2013parallel option) and more compact data storage.</p> <p>This utility has a tar-like interface:</p> <ul> <li> <p>with the <code>-x</code> option it extracts files from the stream read from its standard input to the current directory unless specified otherwise with the <code>-c</code> option. Support for parallel extraction with the <code>--parallel</code> option has been implemented in Percona XtraBackup 2.4.7.</p> </li> <li> <p>with the <code>-c</code> option it streams files specified on the command line to its standard output.</p> </li> <li> <p>with the <code>--decrypt=ALGO</code> option specified xbstream will automatically decrypt encrypted files when extracting input stream. Supported values for this option are: <code>AES128</code>, <code>AES192</code>, and <code>AES256</code>. Either <code>--encrypt-key</code> or <code>--encrypt-key-file</code> options must be specified to provide encryption key, but not both. This option has been implemented in Percona XtraBackup 2.4.7.</p> </li> <li> <p>with the <code>--encrypt-threads</code> option you can specify the number of threads for parallel data encryption. The default value is <code>1</code>. This option has been implemented in Percona XtraBackup 2.4.7.</p> </li> <li> <p>the <code>--encrypt-key</code> option is used to specify the encryption key that will be used. It can\u2019t be used with <code>--encrypt-key-file</code> option because they are mutually exclusive. This option has been implemented in Percona XtraBackup 2.4.7.</p> </li> <li> <p>the <code>--encrypt-key-file</code> option is used to specify the file that contains the encryption key. It can\u2019t be used with <code>--encrypt-key</code> option because they are mutually exclusive. This option has been implemented in Percona XtraBackup 2.4.7.</p> </li> </ul> <p>The utility also tries to minimize its impact on the OS page cache by using the appropriate <code>posix_fadvise()</code> calls when available.</p> <p>When compression is enabled with xtrabackup all data is being compressed, including the transaction log file and meta data files, using the specified compression algorithm. The only currently supported algorithm is <code>quicklz</code>.</p> <p>The resulting files have the qpress archive format, i.e., every <code>\\*.qp</code> file produced by xtrabackup is essentially a one-file qpress archive and can be extracted and uncompressed by the qpress file archiver. This means that there is no need to decompress entire backup to restore a single table as with <code>tar.gz</code>.</p> <p>Files can be decompressed using the qpress tool that can be downloaded from here. Qpress supports multi-threaded decompression.</p> <p>The default size of the chunk file is 10MB.</p> <p>Note</p> <p>Use <code>--read-buffer-size</code> to adjust the chunk size.</p> <p>If you use encryption, specify both the <code>--read-buffer-size</code> and <code>--encrypt-chunk-size</code> options to adjust the chunk size.</p>"},{"location":"xtrabackup_bin/analyzing_table_statistics.html","title":"Analyzing Table Statistics","text":"<p>The xtrabackup binary can analyze InnoDB data files in read-only mode to give statistics about them. To do this, you should use the <code>xtrabackup --stats</code> option. You can combine this with the <code>xtrabackup --tables</code> option to limit the files to examine. It also uses the <code>xtrabackup --use-memory</code> option.</p> <p>You can perform the analysis on a running server, with some chance of errors due to the data being changed during analysis. Or, you can analyze a backup copy of the database. Either way, to use the statistics feature, you need a clean copy of the database including correctly sized log files, so you need to execute with <code>xtrabackup --prepare</code> twice to use this functionality on a backup.</p> <p>The result of running on a backup might look like the following:</p> <pre><code>&lt;INDEX STATISTICS&gt;\n  table: test/table1, index: PRIMARY, space id: 12, root page 3\n  estimated statistics in dictionary:\n    key vals: 25265338, leaf pages 497839, size pages 498304\n  real statistics:\n     level 2 pages: pages=1, data=5395 bytes, data/pages=32%\n     level 1 pages: pages=415, data=6471907 bytes, data/pages=95%\n        leaf pages: recs=25958413, pages=497839, data=7492026403 bytes, data/pages=91%\n</code></pre> <p>This can be interpreted as follows:</p> <ul> <li> <p>The first line simply shows the table and index name and its internal identifiers. If you see an index named <code>GEN_CLUST_INDEX</code>, that is the table\u2019s clustered index, automatically created because you did not explicitly create a <code>PRIMARY KEY</code>.</p> </li> <li> <p>The estimated statistics in dictionary information is similar to the data that\u2019s gathered through <code>ANALYZE TABLE</code> inside of InnoDB to be stored as estimated cardinality statistics and passed to the query optimizer.</p> </li> <li> <p>The real statistics information is the result of scanning the data pages and computing exact information about the index.</p> </li> <li> <p><code>The level &lt;X&gt; pages</code>: output means that the line shows information about pages at that level in the index tree. The larger <code>&lt;X&gt;</code> is, the farther it is from the leaf pages, which are level 0. The first line is the root page.</p> </li> <li> <p>The <code>leaf pages</code> output shows the leaf pages, of course. This is where the table\u2019s data is stored.</p> </li> <li> <p>The <code>external pages</code>: output (not shown) shows large external pages that hold values too long to fit in the row itself, such as long <code>BLOB</code> and <code>TEXT</code> values.</p> </li> <li> <p>The <code>recs</code> is the real number of records (rows) in leaf pages.</p> </li> <li> <p>The <code>pages</code> is the page count.</p> </li> <li> <p>The <code>data</code> is the total size of the data in the pages, in bytes.</p> </li> <li> <p>The <code>data/pages</code> is calculated as (<code>data</code> / (<code>pages</code> * <code>PAGE_SIZE</code>)) * 100%. It will never reach 100% because of space reserved for page headers and footers.</p> </li> </ul> <p>Note</p> <p>A more detailed example as a MySQL Performance blog post http://www.mysqlperformanceblog.com/2009/09/14/statistics-of-innodb-tables-and-indexes-available-in-xtrabackup/</p>"},{"location":"xtrabackup_bin/analyzing_table_statistics.html#script-to-format-output","title":"Script to Format Output","text":"<p>The following script can be used to summarize and tabulate the output of the statistics information:</p> <pre><code>tabulate-xtrabackup-stats.pl\n\n#!/usr/bin/env perl\nuse strict;\nuse warnings FATAL =&gt; 'all';\nmy $script_version = \"0.1\";\n\nmy $PG_SIZE = 16_384; # InnoDB defaults to 16k pages, change if needed.\nmy ($cur_idx, $cur_tbl);\nmy (%idx_stats, %tbl_stats);\nmy ($max_tbl_len, $max_idx_len) = (0, 0);\nwhile ( my $line = &lt;&gt; ) {\n   if ( my ($t, $i) = $line =~ m/table: (.*), index: (.*), space id:/ ) {\n      $t =~ s!/!.!;\n      $cur_tbl = $t;\n      $cur_idx = $i;\n      if ( length($i) &gt; $max_idx_len ) {\n         $max_idx_len = length($i);\n      }\n      if ( length($t) &gt; $max_tbl_len ) {\n         $max_tbl_len = length($t);\n      }\n   }\n   elsif ( my ($kv, $lp, $sp) = $line =~ m/key vals: (\\d+), \\D*(\\d+), \\D*(\\d+)/ ) {\n      @{$idx_stats{$cur_tbl}-&gt;{$cur_idx}}{qw(est_kv est_lp est_sp)} = ($kv, $lp, $sp);\n      $tbl_stats{$cur_tbl}-&gt;{est_kv} += $kv;\n      $tbl_stats{$cur_tbl}-&gt;{est_lp} += $lp;\n      $tbl_stats{$cur_tbl}-&gt;{est_sp} += $sp;\n   }\n   elsif ( my ($l, $pages, $bytes) = $line =~ m/(?:level (\\d+)|leaf) pages:.*pages=(\\d+), data=(\\d+) bytes/ ) {\n      $l ||= 0;\n      $idx_stats{$cur_tbl}-&gt;{$cur_idx}-&gt;{real_pages} += $pages;\n      $idx_stats{$cur_tbl}-&gt;{$cur_idx}-&gt;{real_bytes} += $bytes;\n      $tbl_stats{$cur_tbl}-&gt;{real_pages} += $pages;\n      $tbl_stats{$cur_tbl}-&gt;{real_bytes} += $bytes;\n   }\n}\n\nmy $hdr_fmt = \"%${max_tbl_len}s %${max_idx_len}s %9s %10s %10s\\n\";\nmy @headers = qw(TABLE INDEX TOT_PAGES FREE_PAGES PCT_FULL);\nprintf $hdr_fmt, @headers;\n\nmy $row_fmt = \"%${max_tbl_len}s %${max_idx_len}s %9d %10d %9.1f%%\\n\";\nforeach my $t ( sort keys %tbl_stats ) {\n   my $tbl = $tbl_stats{$t};\n   printf $row_fmt, $t, \"\", $tbl-&gt;{est_sp}, $tbl-&gt;{est_sp} - $tbl-&gt;{real_pages},\n      $tbl-&gt;{real_bytes} / ($tbl-&gt;{real_pages} * $PG_SIZE) * 100;\n   foreach my $i ( sort keys %{$idx_stats{$t}} ) {\n      my $idx = $idx_stats{$t}-&gt;{$i};\n      printf $row_fmt, $t, $i, $idx-&gt;{est_sp}, $idx-&gt;{est_sp} - $idx-&gt;{real_pages},\n         $idx-&gt;{real_bytes} / ($idx-&gt;{real_pages} * $PG_SIZE) * 100;\n   }\n}\n</code></pre>"},{"location":"xtrabackup_bin/analyzing_table_statistics.html#sample-script-output","title":"Sample Script Output","text":"<p>The output of the above Perl script, when run against the sample shown in the previously mentioned blog post, will appear as follows:</p> <pre><code>          TABLE           INDEX TOT_PAGES FREE_PAGES   PCT_FULL\nart.link_out104                    832383      38561      86.8%\nart.link_out104         PRIMARY    498304         49      91.9%\nart.link_out104       domain_id     49600       6230      76.9%\nart.link_out104     domain_id_2     26495       3339      89.1%\nart.link_out104 from_message_id     28160        142      96.3%\nart.link_out104    from_site_id     38848       4874      79.4%\nart.link_out104   revert_domain    153984      19276      71.4%\nart.link_out104    site_message     36992       4651      83.4%\n</code></pre> <p>The columns are the table and index, followed by the total number of pages in that index, the number of pages not actually occupied by data, and the number of bytes of real data as a percentage of the total size of the pages of real data. The first line in the above output, in which the <code>INDEX</code> column is empty, is a summary of the entire table.</p>"},{"location":"xtrabackup_bin/implementation_details.html","title":"Implementation Details","text":"<p>This page contains notes on various internal aspects of the xtrabackup tool\u2019s operation.</p>"},{"location":"xtrabackup_bin/implementation_details.html#file-permissions","title":"File Permissions","text":"<p>xtrabackup opens the source data files in read-write mode, although it does not modify the files. This means that you must run xtrabackup as a user who has permission to write the data files. The reason for opening the files in read-write mode is that xtrabackup uses the embedded InnoDB libraries to open and read the files, and InnoDB opens them in read-write mode because it normally assumes it is going to write to them.</p>"},{"location":"xtrabackup_bin/implementation_details.html#tuning-the-os-buffers","title":"Tuning the OS Buffers","text":"<p>Because xtrabackup reads large amounts of data from the filesystem, it uses <code>posix_fadvise()</code> where possible, to instruct the operating system not to try to cache the blocks it reads from disk. Without this hint, the operating system would prefer to cache the blocks, assuming that <code>xtrabackup</code> is likely to need them again, which is not the case. Caching such large files can place pressure on the operating system\u2019s virtual memory and cause other processes, such as the database server, to be swapped out. The <code>xtrabackup</code> tool avoids this with the following hint on both the source and destination files:</p> <pre><code>posix_fadvise(file, 0, 0, POSIX_FADV_DONTNEED)\n</code></pre> <p>In addition, xtrabackup asks the operating system to perform more aggressive read-ahead optimizations on the source files:</p> <pre><code>posix_fadvise(file, 0, 0, POSIX_FADV_SEQUENTIAL)\n</code></pre>"},{"location":"xtrabackup_bin/implementation_details.html#copying-data-files","title":"Copying Data Files","text":"<p>When copying the data files to the target directory, xtrabackup reads and writes 1MB of data at a time. This is not configurable. When copying the log file, xtrabackup reads and writes 512 bytes at a time. This is also not possible to configure, and matches InnoDB\u2019s behavior (workaround exists in Percona Server for MySQL because it has an option to tune <code>innodb_log_block_size</code> for XtraDB, and in that case XtraBackup will match the tuning).</p> <p>After reading from the files, <code>xtrabackup</code> iterates over the 1MB buffer a page at a time, and checks for page corruption on each page with InnoDB\u2019s <code>buf_page_is_corrupted()</code> function. If the page is corrupt, it re-reads and retries up to 10 times for each page. It skips this check on the doublewrite buffer.</p>"},{"location":"xtrabackup_bin/incremental_backups.html","title":"Incremental Backups","text":"<p>Both xtrabackup and innobackupex tools supports incremental backups, which means that it can copy only the data that has changed since the last full backup. You can perform many incremental backups between each full backup, so you can set up a backup process such as a full backup once a week and an incremental backup every day, or full backups every day and incremental backups every hour.</p> <p>Incremental backups work because each InnoDB page (usually 16kb in size) contains a log sequence number, or <code>LSN</code>. The <code>LSN</code> is the system version number for the entire database. Each page\u2019s <code>LSN</code> shows how recently it was changed. An incremental backup copies each page whose <code>LSN</code> is newer than the previous incremental or full backup\u2019s <code>LSN</code>. There are two algorithms in use to find the set of such pages to be copied. The first one, available with all the server types and versions, is to check the page <code>LSN</code> directly by reading all the data pages. The second one, available with Percona Server for MySQL, is to enable the changed page tracking feature on the server, which will note the pages as they are being changed. This information will be then written out in a compact separate so-called bitmap file. The xtrabackup binary will use that file to read only the data pages it needs for the incremental backup, potentially saving many read requests. The latter algorithm is enabled by default if the xtrabackup binary finds the bitmap file. It is possible to specify <code>xtrabackup --incremental-force-scan</code> to read all the pages even if the bitmap data is available.</p> <p>Incremental backups do not actually compare the data files to the previous backup\u2019s data files. In fact, you can use xtrabackup \u2013incremental-lsn to perform an incremental backup without even having the previous backup, if you know its <code>LSN</code>. Incremental backups simply read the pages and compare their <code>LSN</code> to the last backup\u2019s <code>LSN</code>. You still need a full backup to recover the incremental changes, however; without a full backup to act as a base, the incremental backups are useless.</p>"},{"location":"xtrabackup_bin/incremental_backups.html#creating-an-incremental-backup","title":"Creating an Incremental Backup","text":"<p>To make an incremental backup, begin with a full backup as usual. The xtrabackup binary writes a file called <code>xtrabackup_checkpoints</code> into the backup\u2019s target directory. This file contains a line showing the <code>to_lsn</code>, which is the database\u2019s <code>LSN</code> at the end of the backup. Create the full backup with a command such as the following:</p> <pre><code>xtrabackup --backup --target-dir=/data/backups/base --datadir=/var/lib/mysql/\n</code></pre> <p>If you look at the <code>xtrabackup_checkpoints</code> file, you should see some contents similar to the following:</p> <pre><code>backup_type = full-backuped\nfrom_lsn = 0\nto_lsn = 1291135\n</code></pre> <p>Now that you have a full backup, you can make an incremental backup based on it. Use a command such as the following:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc1 \\\n--incremental-basedir=/data/backups/base --datadir=/var/lib/mysql/\n</code></pre> <p>The <code>/data/backups/inc1/</code> directory should now contain delta files, such as <code>ibdata1.delta</code> and <code>test/table1.ibd.delta</code>. These represent the changes since the <code>LSN 1291135</code>. If you examine the <code>xtrabackup_checkpoints</code> file in this directory, you should see something similar to the following:</p> <pre><code>backup_type = incremental\nfrom_lsn = 1291135\nto_lsn = 1291340\n</code></pre> <p>The meaning should be self-evident. It\u2019s now possible to use this directory as the base for yet another incremental backup:</p> <pre><code>$ xtrabackup --backup --target-dir=/data/backups/inc2 \\\n--incremental-basedir=/data/backups/inc1 --datadir=/var/lib/mysql/\n</code></pre>"},{"location":"xtrabackup_bin/incremental_backups.html#preparing-the-incremental-backups","title":"Preparing the Incremental Backups","text":"<p>The <code>xtrabackup --prepare</code> step for incremental backups is not the same as for normal backups. In normal backups, two types of operations are performed to make the database consistent: committed transactions are replayed from the log file against the data files, and uncommitted transactions are rolled back. You must skip the rollback of uncommitted transactions when preparing a backup, because transactions that were uncommitted at the time of your backup may be in progress, and it\u2019s likely that they will be committed in the next incremental backup. You should use the <code>xtrabackup --apply-log-only</code> option to prevent the rollback phase.</p> <p>Warning</p> <p>If you do not use the xtrabackup \u2013apply-log-only option to prevent the rollback phase, then your incremental backups will be useless. After transactions have been rolled back, further incremental backups cannot be applied.</p> <p>Beginning with the full backup you created, you can prepare it, and then apply the incremental differences to it. Recall that you have the following backups:</p> <pre><code>/data/backups/base\n/data/backups/inc1\n/data/backups/inc2\n</code></pre> <p>To prepare the base backup, you need to run xtrabackup \u2013prepare as usual, but prevent the rollback phase:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/base\n</code></pre> <p>The output should end with some text such as the following:</p> <pre><code>101107 20:49:43  InnoDB: Shutdown completed; log sequence number 1291135\n</code></pre> <p>The log sequence number should match the <code>to_lsn</code> of the base backup, which you saw previously.</p> <p>This backup is actually safe to restore as-is now, even though the rollback phase has been skipped. If you restore it and start MySQL, InnoDB will detect that the rollback phase was not performed, and it will do that in the background, as it usually does for a crash recovery upon start. It will notify you that the database was not shut down normally.</p> <p>To apply the first incremental backup to the full backup, you should use the following command:</p> <pre><code>$ xtrabackup --prepare --apply-log-only --target-dir=/data/backups/base \\\n--incremental-dir=/data/backups/inc1\n</code></pre> <p>This applies the delta files to the files in <code>/data/backups/base</code>, which rolls them forward in time to the time of the incremental backup. It then applies the redo log as usual to the result. The final data is in <code>/data/backups/base</code>, not in the incremental directory. You should see some output such as the following:</p> <pre><code>incremental backup from 1291135 is enabled.\nxtrabackup: cd to /data/backups/base/\nxtrabackup: This target seems to be already prepared.\nxtrabackup: xtrabackup_logfile detected: size=2097152, start_lsn=(1291340)\nApplying /data/backups/inc1/ibdata1.delta ...\nApplying /data/backups/inc1/test/table1.ibd.delta ...\n.... snip\n101107 20:56:30  InnoDB: Shutdown completed; log sequence number 1291340\n</code></pre> <p>Again, the LSN should match what you saw from your earlier inspection of the first incremental backup. If you restore the files from <code>/data/backups/base</code>, you should see the state of the database as of the first incremental backup.</p> <p>Preparing the second incremental backup is a similar process: apply the deltas to the (modified) base backup, and you will roll its data forward in time to the point of the second incremental backup:</p> <pre><code>$ xtrabackup --prepare --target-dir=/data/backups/base \\\n--incremental-dir=/data/backups/inc2\n</code></pre> <p>Note</p> <p><code>xtrabackup --apply-log-only</code> should be used when merging all incrementals except the last one. That\u2019s why the previous line doesn\u2019t contain the <code>xtrabackup --apply-log-only</code> option. Even if the <code>xtrabackup --apply-log-only</code> was used on the last step, backup would still be consistent but in that case server would perform the rollback phase.</p> <p>If you wish to avoid the notice that InnoDB was not shut down normally, when xoyou applied the desired deltas to the base backup, you can run <code>xtrabackup --prepare</code> again without disabling the rollback phase.</p>"},{"location":"xtrabackup_bin/lru_dump.html","title":"LRU dump backup","text":"<p>This feature reduces the warm up time by restoring buffer pool state from <code>ib_lru_dump</code> file after restart. Percona XtraBackup discovers <code>ib_lru_dump</code> and backs it up automatically.</p> <p></p> <p>If the buffer restore option is enabled in <code>my.cnf</code> buffer pool will be in the warm state after backup is restored. To enable this set the variable innodb_buffer_pool_restore_at_startup =1 in Percona Server 5.5 or innodb_auto_lru_dump =1 in Percona Server 5.1.</p>"},{"location":"xtrabackup_bin/partial_backups.html","title":"Partial Backups","text":"<p>xtrabackup supports taking partial backups when the <code>innodb_file_per_table</code> option is enabled. There are three ways to create partial backups:</p> <ol> <li> <p>matching the tables names with a regular expression</p> </li> <li> <p>providing a list of table names in a file</p> </li> <li> <p>providing a list of databases</p> </li> </ol> <p>Warning</p> <p>If any of the matched or listed tables is deleted during the backup, xtrabackup will fail. </p> <p>Do not copy back the prepared backup. Restoring partial backups should be done by importing the tables, not by using the <code>--copy-back</code> option. It is not recommended to run incremental backups after running a partial backup. </p> <p>Although there are some scenarios where restoring can be done by copying back the files, this may lead to database inconsistencies in many cases and it is not a recommended way to do it.</p> <p>For the purposes of this manual page, we will assume that there is a database named <code>test</code> which contains tables named <code>t1</code> and <code>t2</code>.</p>"},{"location":"xtrabackup_bin/partial_backups.html#using-xtrabackup-tables","title":"Using xtrabackup \u2013tables","text":"<p>The first method involves the <code>xtrabackup --tables</code> option. The option\u2019s value is a regular expression that is matched against the fully qualified tablename, including the database name, in the form <code>databasename.tablename</code>.</p> <p>To back up only tables in the <code>test</code> database, you can use the following command:</p> <pre><code>$ xtrabackup --backup --datadir=/var/lib/mysql --target-dir=/data/backups/ \\\n--tables=\"^test[.].*\"\n</code></pre> <p>To back up only the table <code>test.t1</code>, you can use the following command:</p> <pre><code>$ xtrabackup --backup --datadir=/var/lib/mysql --target-dir=/data/backups/ \\\n--tables=\"^test[.]t1\"\n</code></pre>"},{"location":"xtrabackup_bin/partial_backups.html#using-xtrabackup-tables-file","title":"Using <code>xtrabackup --tables-file</code>","text":"<p><code>xtrabackup --tables-file</code> specifies a file that can contain multiple table names, one table name per line in the file. Only the tables named in the file will be backed up. Names are matched exactly, case-sensitive, with no pattern or regular expression matching. The table names must be fully qualified, in <code>databasename.tablename</code> format.</p> <pre><code>$ echo \"mydatabase.mytable\" &gt; /tmp/tables.txt\n$ xtrabackup --backup --tables-file=/tmp/tables.txt\n</code></pre>"},{"location":"xtrabackup_bin/partial_backups.html#using-xtrabackup-databases-and-xtrabackup-databases-file","title":"Using <code>xtrabackup --databases</code> and <code>xtrabackup --databases-file</code>","text":"<p><code>xtrabackup --databases</code> accepts a space-separated list of the databases and tables to backup in the format <code>databasename[.tablename]</code>. In addition to this list make sure to specify the <code>mysql</code>, <code>sys</code>, and <code>performance_schema</code> databases. These databases are required when restoring the databases using <code>xtrabackup --copy-back</code>.</p> <p>Note</p> <p>Tables processed during the \u2013prepare step may also be added to the backup even if they are not explicitly listed by the parameter if they were created after the backup started.</p> <pre><code>$ xtrabackup --databases='mysql sys performance_schema ...'\n</code></pre> <p><code>xtrabackup --databases-file</code> specifies a file that can contain multiple databases and tables in the <code>databasename[.tablename]</code> form, one element name per line in the file. Names are matched exactly, case-sensitive, with no pattern or regular expression matching.</p> <p>Note</p> <p>Tables processed during the \u2013prepare step may also be added to the backup even if they are not explicitly listed by the parameter if they were created after the backup started.</p>"},{"location":"xtrabackup_bin/partial_backups.html#preparing-the-backup","title":"Preparing the Backup","text":"<p>When you use the <code>xtrabackup --prepare</code> option on a partial backup, you will see warnings about tables that don\u2019t exist. This is because these tables exist in the data dictionary inside InnoDB, but the corresponding <code>.ibd</code> files don\u2019t exist. They were not copied into the backup directory. These tables will be removed from the data dictionary, and when you restore the backup and start InnoDB, they will no longer exist and will not cause any errors or warnings to be printed to the log file.</p> <p>An example of the error message you will see during the prepare phase follows.</p> <pre><code>InnoDB: Reading tablespace information from the .ibd files...\n101107 22:31:30  InnoDB: Error: table 'test1/t'\nInnoDB: in InnoDB data dictionary has tablespace id 6,\nInnoDB: but tablespace with that id or name does not exist. It will be removed from data dictionary.\n</code></pre>"},{"location":"xtrabackup_bin/restoring_individual_tables.html","title":"Restore individual tables","text":"<p>With Percona XtraBackup, you can export individual tables from any InnoDB database, and import them into Percona Server for MySQL with XtraDB or MySQL 5.7. The source does not need to be XtraDB or MySQL 5.7 but the destination must be. This operation only works on individual .ibd files. A table that is not contained in its own <code>.ibd</code> file cannot be exported.</p> <p>The following example exports and imports the following table:</p> <pre><code>CREATE TABLE export_test (\na int(11) DEFAULT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n</code></pre>"},{"location":"xtrabackup_bin/restoring_individual_tables.html#export-the-table","title":"Export the table","text":"<p>To generate an .ibd file in the target directory, create the table using the <code>innodb_file_per_table</code> mode:</p> <pre><code>$ find /data/backups/mysql/ -name export_test.*\n/data/backups/mysql/test/export_test.ibd\n</code></pre> <p>During the <code>--prepare</code> step, add the <code>--export</code> option to the command. For example:</p> <pre><code>$ xtrabackup --prepare --export --target-dir=/data/backups/mysql/\n</code></pre> <p>When restoring an encrypted InnoDB tablespace table, add the keyring file:</p> <pre><code>$ xtrabackup --prepare --export --target-dir=/tmp/table \\\n--keyring-file-data=/var/lib/mysql-keyring/keyring\n</code></pre> <p>The following files are the only files required to import the table into a server running Percona Server for MySQL with XtraDB or MySQL 5.7. If the server uses InnoDB Tablespace Encryption, add the <code>.cfp</code> file, which contains the transfer key and an encrypted tablespace key.</p> <p>The files are located in the target directory:</p> <pre><code>/data/backups/mysql/test/export_test.ibd\n/data/backups/mysql/test/export_test.cfg\n</code></pre>"},{"location":"xtrabackup_bin/restoring_individual_tables.html#import-the-table","title":"Import the table","text":"<p>On the destination server, create a table with the same structure, and then perform the following steps:</p> <ol> <li> <p>Run the <code>ALTER TABLE test.export_test DISCARD TABLESPACE;</code> command. If you see the following error message:</p> <pre><code>ERROR 1030 (HY000): Got error -1 from storage engine` message\n</code></pre> <p>enable innodb_file_per_table option:</p> <pre><code>$ set global innodb_file_per_table=ON;\n</code></pre> <p>Then create the table again.</p> </li> <li> <p>Copy the exported files to the <code>test/</code> subdirectory of the destination server\u2019s data directory</p> </li> <li> <p>Execute <code>ALTER TABLE test.export_test IMPORT TABLESPACE;</code></p> </li> </ol> <p>The table should now be imported, and you should be able to <code>SELECT</code> from it and see the imported data.</p> <p>Note</p> <p>Persistent statistics for imported tablespace will be empty until you run the <code>ANALYZE TABLE</code> on the imported table. They are empty because they are stored in the system tables <code>mysql.innodb_table_stats</code> and <code>mysql.innodb_index_stats</code> and they are not updated by server during the import. This is due to upstream bug #72368.</p>"},{"location":"xtrabackup_bin/scripting_backups_xbk.html","title":"Scripting Backups With xtrabackup","text":"<p>The <code>xtrabackup</code> tool has several features to enable scripts to control it while they perform related tasks. The innobackupex script is one example, but <code>xtrabackup</code> is easy to control with your own command-line scripts too.</p>"},{"location":"xtrabackup_bin/scripting_backups_xbk.html#suspending-after-copying","title":"Suspending After Copying","text":"<p>In backup mode, <code>xtrabackup</code> normally copies the log files in a background thread, copies the data files in a foreground thread, and then stops the log copying thread and finishes. As long as that file exists, xtrabackup will continue to watch the log files and copy them into the <code>xtrabackup_logfile</code> in the target directory. When the file is removed, <code>xtrabackup</code> will finish copying the log file and exit.</p> <p>This functionality is useful for coordinating the InnoDB data backups with other actions. Perhaps the most obvious is copying the table definitions (the <code>.frm</code> files) so that the backup can be restored. You can start <code>xtrabackup</code> in the background, wait for the <code>xtrabackup_suspended</code> file to be created, and then copy any other files you need to complete the backup. This is exactly what the innobackupex tool does (it also copies MyISAM data and other files).</p>"},{"location":"xtrabackup_bin/scripting_backups_xbk.html#generating-meta-data","title":"Generating Meta-Data","text":"<p>It is a good idea for the backup to include all the information you need to restore the backup. The <code>xtrabackup</code> tool can print out the contents of a <code>my.cnf</code> file that are needed to restore the data and log files. <code>xtrabackup --print-param</code> prints out something like the following:</p> <pre><code># This MySQL options file was generated by XtraBackup.\n[mysqld]\ndatadir = /data/mysql/\ninnodb_data_home_dir = /data/innodb/\ninnodb_data_file_path = ibdata1:10M:autoextend\ninnodb_log_group_home_dir = /data/innodb-logs/\n</code></pre> <p>You can redirect this output into a file in the target directory of the backup.</p>"},{"location":"xtrabackup_bin/scripting_backups_xbk.html#agreeing-on-the-source-directory","title":"Agreeing on the Source Directory","text":"<p>It\u2019s possible that the presence of a defaults file or other factors could cause <code>xtrabackup</code> to back up data from a different location than you expected. To prevent this, you can use <code>xtrabackup --print-param</code> to ask it where it will be copying data from. You can use the output to ensure that <code>xtrabackup</code> and your script are working on the same dataset.</p>"},{"location":"xtrabackup_bin/working_with_binary_logs.html","title":"Working with Binary Logs","text":"<p>The <code>xtrabackup</code> binary integrates with information that InnoDB stores in its transaction log about the corresponding binary log position for committed transactions. This enables it to print out the binary log position to which a backup corresponds, so you can use it to set up new replication replicas or perform point-in-time recovery.</p>"},{"location":"xtrabackup_bin/working_with_binary_logs.html#finding-the-binary-log-position","title":"Finding the Binary Log Position","text":"<p>You can find the binary log position corresponding to a backup once the backup has been prepared. This can be done by either running <code>xtrabackup --prepare</code> or <code>innobackupex --apply-log</code>. If your backup is from a server with binary logging enabled, xtrabackup will create a file named xtrabackup_binlog_info in the target directory. This file contains the binary log file name and position of the exact point in the binary log to which the prepared backup corresponds.</p> <p>You will also see output similar to the following during the <code>prepare</code> stage:</p> <pre><code>InnoDB: Last MySQL binlog file position 0 3252710, file name ./mysql-bin.000001\n... snip ...\n[notice (again)]\n  If you use binary log and don't use any hack of group commit,\n  the binary log position seems to be:\nInnoDB: Last MySQL binlog file position 0 3252710, file name ./mysql-bin.000001\n</code></pre> <p>This output can also be found in the <code>xtrabackup_binlog_pos_innodb</code> file, but it is only correct when no other than XtraDB or InnoDB are used as storage engines.</p> <p>If other storage engines are used (i.e. MyISAM), you should use the <code>xtrabackup_binlog_info</code> file to retrieve the position.</p> <p>The message about hacking group commit refers to an early implementation of emulated group commit in Percona Server for MySQL.</p>"},{"location":"xtrabackup_bin/working_with_binary_logs.html#point-in-time-recovery","title":"Point-In-Time Recovery","text":"<p>To perform a point-in-time recovery from an <code>xtrabackup</code> backup, you should prepare and restore the backup, and then replay binary logs from the point shown in the <code>xtrabackup_binlog_info</code> file.</p> <p>A more detailed procedure is found here (with innobackupex).</p>"},{"location":"xtrabackup_bin/working_with_binary_logs.html#setting-up-a-new-replication-replica","title":"Setting Up a New Replication Replica","text":"<p>To set up a new replica, you should prepare the backup, and restore it to the data directory of your new replication replica. Then in your <code>CHANGE MASTER TO</code> command, use the binary log filename and position shown in the <code>xtrabackup_binlog_info</code> file to start replication.</p> <p>A more detailed procedure is found in How to setup a replica for replication in 6 simple steps with Percona XtraBackup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html","title":"The xtrabackup Option Reference","text":"<p>This page documents all of the command-line options for the <code>xtrabackup</code> binary.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#options","title":"Options","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-apply-log-only","title":"\u2013apply-log-only","text":"<p>This option causes only the redo stage to be performed when preparing a backup. It is very important for incremental backups.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-backup","title":"\u2013backup","text":"<p>Make a backup and place it in <code>xtrabackup --target-dir</code>. See Creating a backup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-backup-lock-retry-count","title":"\u2013backup-lock-retry-count=","text":"<p>The number of attempts to acquire metadata locks.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-backup-lock-timeout","title":"\u2013backup-lock-timeout=","text":"<p>The timeout in seconds for attempts to acquire metadata locks.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-binlog-info","title":"\u2013binlog-info","text":"<p>This option controls how Percona XtraBackup should retrieve the server\u2019s binary log coordinates corresponding to the backup. Possible values are <code>OFF</code>, <code>ON</code>, <code>LOCKLESS</code> and <code>AUTO</code>. See the Percona XtraBackup Lockless binary log information  manual page for more information.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-check-privileges","title":"\u2013check-privileges","text":"<p>This option checks if Percona XtraBackup has all the required privileges. If a missing privilege is required for the current operation, it will terminate and print out an error message. If a missing privilege is not required for the current operation but may be necessary for some other XtraBackup operation, the process is not aborted, and a warning is printed.</p> <pre><code>xtrabackup: Error: missing required privilege LOCK TABLES on *.*\nxtrabackup: Warning: missing required privilege REPLICATION CLIENT on *.*\n</code></pre>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-close-files","title":"\u2013close-files","text":"<p>Do not keep files open. When xtrabackup opens a tablespace, it normally does not close its file handle to manage the DDL operations correctly. However, if the number of tablespaces is huge and can not fit into any limit, there is an option to close file handles once they are no longer accessed. Percona XtraBackup can produce inconsistent backups with this option enabled. Use the option at your own risk.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-compact","title":"\u2013compact","text":"<p>Create a compact backup by skipping secondary index pages.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-compress","title":"\u2013compress","text":"<p>This option tells xtrabackup to compress all output data, including the transaction log file and metadata files, using the specified compression algorithm. The only currently supported algorithm is <code>quicklz</code>. The resulting files have the qpress archive format.</p> <p>Every <code>\\*.qp</code> file produced by xtrabackup is essentially a one-file qpress archive and can be extracted and uncompressed by the qpress  file archiver.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-compress-chunk-size","title":"\u2013compress-chunk-size=","text":"<p>Size of working buffer(s) for compression threads in bytes. The default value is 64K.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-compress-threads","title":"\u2013compress-threads=","text":"<p>This option specifies the number of worker threads used by xtrabackup for parallel data compression. This option defaults to <code>1</code>. Parallel compression (<code>xtrabackup --compress-threads</code>) can be used together with parallel file copying (<code>xtrabackup --parallel</code>). For example, <code>--parallel=4 --compress --compress-threads=2</code> will create 4 I/O threads that will read the data and pipe it to 2 compression threads.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-copy-back","title":"\u2013copy-back","text":"<p>Copy all the files in a previously made backup from the backup directory to their original locations. This option will not copy over existing files unless <code>xtrabackup --force-non-empty-directories</code> option is specified.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-core-file","title":"\u2013core-file","text":"<p>Write core on fatal signals.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-databases","title":"\u2013databases=","text":"<p>This option specifies the list of databases and tables that should be backed up. The option accepts the list of the form <code>\"databasename1[.table_name1] databasename2[.table_name2] . . .\"</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-databases-excludename","title":"\u2013databases-exclude=name","text":"<p>Excluding databases based on name. This option operates the same way as <code>xtrabackup --databases</code>, but matched names are excluded from the backup. Note that this option has a higher priority than <code>xtrabackup --databases</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-databases-file","title":"\u2013databases-file=","text":"<p>This option specifies the path to the file containing the list of databases and tables that should be backed up. The file can contain the list elements of the form <code>databasename1[.table_name1]</code>, one element per line.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-datadirdirectory","title":"\u2013datadir=DIRECTORY","text":"<p>The source directory for the backup. This directory should be the same as the datadir for your MySQL server, and it should be read from my.cnf if that exists; otherwise, you must specify it on the command line.</p> <p>When combined with the <code>xtrabackup --copy-back</code> or <code>xtrabackup --move-back</code> option, <code>xtrabackup --datadir</code> refers to the destination directory.</p> <p>Once connected to the server, to perform a backup, you will need <code>READ</code> and <code>EXECUTE</code> permissions at a filesystem level in the server\u2019s datadir.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-debug-sleep-before-unlock","title":"\u2013debug-sleep-before-unlock=","text":"<p>A debug-only option that is used by the Xtrabackup test suite.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-decompress","title":"\u2013decompress","text":"<p>This option decompresses all files with the <code>.qp</code> extension in a backup previously made with the <code>xtrabackup --compress</code> option. The <code>xtrabackup --parallel</code> option will allow multiple files to be decrypted simultaneously. To decompress, the qpress utility MUST be installed and accessible within the path. Percona XtraBackup doesn\u2019t automatically remove the compressed files. To clean up the backup directory, users should use the <code>xtrabackup --remove-original</code> option.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-decryptencryption-algorithm","title":"\u2013decrypt=ENCRYPTION-ALGORITHM","text":"<p>Decrypts all files with the .xbcrypt extension in a backup previously made with <code>xtrabackup --encrypt</code> option. The <code>xtrabackup --parallel</code> option will allow multiple files to be decrypted simultaneously. Percona XtraBackup doesn\u2019t automatically remove the encrypted files. To clean up the backup directory, users should use <code>xtrabackup --remove-original</code> option.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-defaults-extra-filemycnf","title":"\u2013defaults-extra-file=[MY.CNF]","text":"<p>Read this file after the global files are read. This file must be the first option on the command-line.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-defaults-filemycnf","title":"\u2013defaults-file=[MY.CNF]","text":"<p>Only read default options from the given file. This file must be the first option on the command-line and be a real file and cannot be a symbolic link.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-defaults-groupgroup-name","title":"\u2013defaults-group=GROUP-NAME","text":"<p>This option sets up the group which should be read from the configuration file. The option is used by the <code>--default-group</code> and is required for</p> <p><code>mysqld_multi</code> deployments.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-defaults-group-suffix","title":"\u2013defaults-group-suffix=","text":"<p>Read the usual options groups and also groups with concat(group, suffix).</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-dump-innodb-buffer-pool","title":"\u2013dump-innodb-buffer-pool","text":"<p>This option controls whether or not a new dump of buffer pool content should be done.</p> <p>With <code>--dump-innodb-buffer-pool</code>, xtrabackup makes a request to the server to start the buffer pool dump (it takes some time to complete and is done in background) at the beginning of a backup provided the status variable <code>innodb_buffer_pool_dump_status</code> reports that the dump has been completed.</p> <pre><code>$ xtrabackup --backup --dump-innodb-buffer-pool --target-dir=/home/user/backup\n</code></pre> <p>By default, this option is set to OFF.</p> <p>If <code>innodb_buffer_pool_dump_status</code> reports that there is running dump of the buffer pool, xtrabackup waits for the dump to complete using the value of \u2013dump-innodb-buffer-pool-timeout</p> <p>The file <code>ib_buffer_pool</code> stores tablespace ID and page ID data used to warm up the buffer pool sooner.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-dump-innodb-buffer-pool-timeout","title":"\u2013dump-innodb-buffer-pool-timeout","text":"<p>This option contains the number of seconds that xtrabackup should monitor the value of <code>innodb_buffer_pool_dump_status</code> to determine if buffer pool dump has completed.</p> <p>This option is used in combination with <code>--dump-innodb-buffer-pool</code>. By default, it is set to 10 seconds.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-dump-innodb-buffer-pool-pct","title":"\u2013dump-innodb-buffer-pool-pct","text":"<p>This option contains the percentage of the most recently used buffer pool pages to dump.</p> <p>This option is effective if \u2013dump-innodb-buffer-pool option is set to ON. If this option contains a value, xtrabackup sets the MySQL system variable <code>innodb_buffer_pool_dump_pct</code>. As soon as the buffer pool dump completes or it is stopped (see \u2013dump-innodb-buffer-pool-timeout), the value of the MySQL system variable is restored.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-encryptencryption_algorithm","title":"\u2013encrypt=ENCRYPTION_ALGORITHM","text":"<p>This option instructs xtrabackup to encrypt backup copies of InnoDB data files using the algorithm specified in the ENCRYPTION_ALGORITHM. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-encrypt-keyencryption_key","title":"\u2013encrypt-key=ENCRYPTION_KEY","text":"<p>This option instructs xtrabackup to use the given <code>ENCRYPTION_KEY</code> when using the <code>xtrabackup --encrypt</code> option. It is passed directly to the xtrabackup child process. See the xtrabackup documentation for more details.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-encrypt-key-fileencryption_key_file","title":"\u2013encrypt-key-file=ENCRYPTION_KEY_FILE","text":"<p>This option instructs xtrabackup to use the encryption key stored in the given <code>ENCRYPTION_KEY_FILE</code> when using the <code>xtrabackup --encrypt</code> option. It is passed directly to the xtrabackup child process. See the xtrabackup documentation for more details.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-encrypt-threads","title":"\u2013encrypt-threads=","text":"<p>This option specifies the number of worker threads that will be used for parallel encryption/decryption. See the xtrabackup documentation for more details.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-encrypt-chunk-size","title":"\u2013encrypt-chunk-size=","text":"<p>This option specifies the size of the internal working buffer for each encryption thread, and is measured in bytes. It is passed directly to the xtrabackup child process. See the <code>xtrabackup</code> documentation for more details.</p> <p>Note</p> <p>To adjust the xbcloud/xbstream chunk size when you use encryption, you must adjust both the \u2013encrypt-chunk-size and \u2013read-buffer-size variables.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-export","title":"\u2013export","text":"<p>Create files necessary for exporting tables. See Restoring Individual Tables.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-extra-lsndirdirectory","title":"\u2013extra-lsndir=DIRECTORY","text":"<p>(for \u2013backup): save an extra copy of the <code>xtrabackup_checkpoints</code> and <code>xtrabackup_info</code> files in this directory.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-force-non-empty-directories","title":"\u2013force-non-empty-directories","text":"<p>When specified, it makes :option`xtrabackup \u2013copy-back` and <code>xtrabackup --move-back</code> option transfer files to non-empty directories. No existing files will be overwritten. If files that need to be copied/moved from the backup directory already exist in the destination directory, it will still fail with an error.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-ftwrl-wait-timeoutseconds","title":"\u2013ftwrl-wait-timeout=SECONDS","text":"<p>This option specifies time in seconds that xtrabackup should wait for queries that would block <code>FLUSH TABLES WITH READ LOCK</code> before running it. If there are still such queries when the timeout expires, xtrabackup terminates with an error. The default is <code>0</code>, in which case it does not wait for queries to complete and starts <code>FLUSH TABLES WITH READ LOCK</code> immediately. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-ftwrl-wait-thresholdseconds","title":"\u2013ftwrl-wait-threshold=SECONDS","text":"<p>This option specifies the query run time threshold which is used by xtrabackup to detect long-running queries with a non-zero value of xtrabackup \u2013ftwrl-wait-timeout. <code>FLUSH TABLES WITH READ LOCK</code> is not started until such long-running queries exist. This option has no effect if xtrabackup \u2013ftwrl-wait-timeout is <code>0</code>. The default value is <code>60</code> seconds. Where supported (Percona Server 5.6+) xtrabackup will automatically use Backup Locks as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-ftwrl-wait-query-typeallupdate","title":"\u2013ftwrl-wait-query-type=all|update","text":"<p>This option specifies which types of queries are allowed to complete before xtrabackup will issue the global lock. The default is <code>all</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-galera-info","title":"\u2013galera-info","text":"<p>This options creates the <code>xtrabackup_galera_info</code> file which contains the local node state at the time of the backup. Option should be used when performing the backup of Percona XtraDB Cluster. It has no effect when backup locks are used to create the backup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-generate-new-master-key","title":"\u2013generate-new-master-key","text":"<p>Generates a new master key when doing a copy-back operation.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-historyname","title":"\u2013history=name","text":"<p>This option enables the tracking of the backup history in the <code>PERCONA_SCHEMA.xtrabackup_history</code> table. An optional history series name may be specified that will be placed with the history record for the backup being taken.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental","title":"\u2013incremental","text":"<p>This option tells xtrabackup to create an incremental backup. It is passed to the xtrabackup child process. When this option is specified, either <code>xtrabackup --incremental-lsn</code> or xtrabackup \u2013incremental-basedir can also be given. If neither option is given, option <code>xtrabackup --incremental-basedir</code> is passed to xtrabackup by default, set to the first timestamped backup directory in the backup base directory.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental-basedirdirectory","title":"\u2013incremental-basedir=DIRECTORY","text":"<p>This directory contains the full backup, which is the base dataset used for the incremental backups.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental-dirdirectory","title":"\u2013incremental-dir=DIRECTORY","text":"<p>When preparing an incremental backup, this is the directory where the incremental backup is combined with the full backup to make a new full backup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental-force-scan","title":"\u2013incremental-force-scan","text":"<p>When creating an incremental backup, force a full scan of the data pages in the instance to be used in the backup even if the complete changed page bitmap data is available.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental-history-namename","title":"\u2013incremental-history-name=name","text":"<p>This option specifies the name of the backup series stored in the PERCONA_SCHEMA.xtrabackup_history history record to base an incremental backup on. xtrabackup searches the history table for the most recent (highest innodb_to_lsn), successful backup in the series and take the to_lsn value to use as the starting lsn for the incremental backup. This will be mutually exclusive with <code>xtrabackup --incremental-history-uuid</code>, <code>xtrabackup --incremental-basedir</code> and <code>xtrabackup --incremental-lsn</code>. If no valid <code>LSN</code> can be found (no series by that name, no successful backups by that name) xtrabackup returns an error. It is used with the <code>xtrabackup --incremental</code> option.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-innodb-checksum-algorithmname","title":"\u2013innodb-checksum-algorithm=name","text":"<p>The algorithm InnoDB uses to calculate a page checksum. The available algorithms are CRC32, INNODB, NONE, STRICT_CRC32, STRICT_INNODB, and STRICT_NONE</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental-history-uuiduuid","title":"\u2013incremental-history-uuid=UUID","text":"<p>This option specifies the <code>UUID</code> of the specific history record stored in the PERCONA_SCHEMA.xtrabackup_history to base an incremental backup on <code>xtrabackup --incremental-history-name</code>, <code>xtrabackup --incremental-basedir</code> and <code>xtrabackup --incremental-lsn</code>. If no valid LSN is found (no success record with that UUID) xtrabackup returns an error. This option is used with the <code>xtrabackup --incremental</code> option.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-incremental-lsnlsn","title":"\u2013incremental-lsn=LSN","text":"<p>When creating an incremental backup, you can specify the log sequence number (<code>LSN</code>) instead of specifying <code>xtrabackup --incremental-basedir</code>. For databases created in 5.1 and later, specify the LSN as a single 64-bit integer. ATTENTION: If a wrong LSN value is specified (a user  error that Percona XtraBackup cannot detect), the backup will be unusable. Be careful!</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-innodb-log-arch-dirdirectory","title":"\u2013innodb-log-arch-dir=DIRECTORY","text":"<p>This option is used to specify the directory containing the archived logs. It can only be used with the <code>xtrabackup --prepare</code> option.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-innodb-miscellaneous","title":"\u2013innodb-miscellaneous","text":"<p>A large group of InnoDB options are normally read from the <code>my.cnf</code> configuration file, so that xtrabackup boots up its embedded InnoDB in the same configuration as your current server. You normally do not need to specify these explicitly. These options have the same behavior that they have in InnoDB or XtraDB. They are as follows:</p> <pre><code>--innodb-adaptive-hash-index\n--innodb-additional-mem-pool-size\n--innodb-autoextend-increment\n--innodb-buffer-pool-size\n--innodb-checksums\n--innodb-data-file-path\n--innodb-data-home-dir\n--innodb-doublewrite-file\n--innodb-doublewrite\n--innodb-extra-undoslots\n--innodb-fast-checksum\n--innodb-file-io-threads\n--innodb-file-per-table\n--innodb-flush-log-at-trx-commit\n--innodb-flush-method\n--innodb-force-recovery\n--innodb-io-capacity\n--innodb-lock-wait-timeout\n--innodb-log-buffer-size\n--innodb-log-files-in-group\n--innodb-log-file-size\n--innodb-log-group-home-dir\n--innodb-max-dirty-pages-pct\n--innodb-open-files\n--innodb-page-size\n--innodb-read-io-threads\n--innodb-write-io-threads\n</code></pre>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-innodb-undo-directoryname","title":"\u2013innodb-undo-directory=name","text":"<p>The directory location for the undo tablespace. The path is absolute.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-innodb-undo-tablespace","title":"\u2013innodb-undo-tablespace=","text":"<p>The number of undo tablespaces to use.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-keyring-file-datafilename","title":"\u2013keyring-file-data=FILENAME","text":"<p>The path to the keyring file. Combine this option with <code>xtrabackup --xtrabackup-plugin-dir</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-kill-long-queries-timeout","title":"\u2013kill-long-queries-timeout=","text":"<p>This options specifies the number of seconds xtrabackup waits between starting FLUSH TABLES WITH READ LOCK and killing those queries that block it. The default is <code>0</code> (zero) seconds, which means the xtrabackup does not attempt to kill any queries.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-kill-long-query-typeselectall","title":"\u2013kill-long-query-type=select|all","text":"<p>This option specifies which types of queries should be killed to unblock the global lock. The default value is <code>select</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-lock-ddl","title":"\u2013lock-ddl","text":"<p>Issue <code>LOCK TABLES FOR BACKUP</code> if it is supported by server at the beginning of the backup to block all DDL operations.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-lock-ddl-per-table","title":"\u2013lock-ddl-per-table","text":"<p>Lock DDL for each table before xtrabackup starts to copy it and until the backup is completed.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-lock-ddl-timeout","title":"\u2013lock-ddl-timeout","text":"<p>If <code>LOCK TABLES FOR BACKUP</code> does not return within given timeout, abort the backup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-log-binname","title":"\u2013log-bin[=name]","text":"<p>The base name for the log sequence.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-log-copy-interval","title":"\u2013log-copy-interval=","text":"<p>This option specifies time interval between log copying thread checks in milliseconds (default is 1 second).</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-login-path","title":"\u2013login-path=","text":"<p>Read this path from the login file.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-move-back","title":"\u2013move-back","text":"<p>Move all the files in a previously made backup from the backup directory to their original locations. As this option removes backup files, it must be used with caution.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-no-backup-locks","title":"\u2013no-backup-locks","text":"<p>This options controls if backup locks are used instead of <code>FLUSH TABLES WITH READ LOCK</code> during the backup stage. The backup locks are must be supported on the server for the option to have an affect.</p> <p>This option is enabled by default. Disable the option with <code>--no-backup-locks</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-no-defaults","title":"\u2013no-defaults","text":"<p>Do not read the default options from any option file. Must be given as the first option on the command-line.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-no-lock","title":"\u2013no-lock","text":"<p>This option automatically uses Backup Locks, and disables table locks, as a lightweight alternative to <code>FLUSH TABLES WITH READ LOCK</code> to copy non-InnoDB data to avoid blocking DML queries that modify InnoDB tables.</p> <p>Only use this option if all tables are InnoDB and you do not care about the binary log position of the backup.</p> <p>Do not use this option if any DDL statements will be executed or if any non-InnoDB tables are being updated (this includes the MyISAM tables in the mysql database). Using this option in these conditions could cause an inconsistent backup.</p> <p>If your backups fail to acquire a lock and you are planning to use this option, the failure may be caused by incoming replication events that prevent the lock from succeeding. Try the <code>--safe-slave-backup</code> to momentarily stop the replication slave thread.</p> <p>The <code>xtrabackup-binlog-info</code> is not created when the <code>--no-lock</code> is used because <code>SHOW MASTER STATUS</code> may be inconsistent. In certain conditions, <code>xtrabackup_binlog_pos_innodb</code> can be used instead to get consistent binlog coordinates as described in Working with Binary Logs.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-no-version-check","title":"\u2013no-version-check","text":"<p>This option disables the version check. If you do not pass this option, the automatic version check is enabled implicitly when xtrabackup runs in the <code>--backup</code> mode. To disable the version check, explicitly pass the <code>--no-version-check</code> option when invoking xtrabackup.</p> <p>When the automatic version check is enabled,xtrabackup performs a version check against the server on the backup stage after creating a server connection. xtrabackup sends the following information to the server:</p> <ul> <li> <p>MySQL flavour and version</p> </li> <li> <p>Operating system name</p> </li> <li> <p>Percona Toolkit version</p> </li> <li> <p>Perl version</p> </li> </ul> <p>Each piece of information has a unique identifier which is an MD5 hash value that Percona Toolkit uses to obtain statistics about how it is used. This value is a random UUID; no client information is either collected or stored.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-open-files-limit","title":"\u2013open-files-limit=","text":"<p>The maximum number of file descriptors to reserve with setrlimit().</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-parallel","title":"\u2013parallel=","text":"<p>This option specifies the number of threads to use to copy multiple data files concurrently when creating a backup. The default value is 1 (i.e., no concurrent transfer). In Percona XtraBackup 2.3.10 and newer, this option can be used with <code>xtrabackup --copy-back</code> option to copy the user data files in parallel (redo logs and system tablespaces are copied in the main thread).</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-passwordpassword","title":"\u2013password=PASSWORD","text":"<p>This option specifies the password to use when connecting to the database. It accepts a string argument. See <code>mysql --help</code> for details.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-prepare","title":"\u2013prepare","text":"<p>Makes <code>xtrabackup</code> perform recovery on a backup created with <code>xtrabackup --backup</code>, so that it is ready to use. See preparing a backup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-print-defaults","title":"\u2013print-defaults","text":"<p>Print the program argument list and exit. Must be given as the first option on the command-line.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-print-param","title":"\u2013print-param","text":"<p>Makes <code>xtrabackup</code> print out parameters that to copy the data files back to their original locations to restore them. See Scripting Backups With xtrabackup.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-read-buffer-size","title":"\u2013read-buffer-size[=#]","text":"<p>Set read buffer size. The given value is scaled up to page size. The default is 10MB.</p> <p>Use this variable to increase the xbcloud/xbstream chunk size from the default value of 10MB.</p> <p>NOTE: When you use encryption, to adjust the xbcloud/xbstream chunk size, adjust both the <code>--encrypt-chunk-size</code> and <code>--read-buffer-size</code> variables.</p> <pre><code>$ xtrabackup ... --read-buffer-size=1G | xbcloud put ...\n</code></pre>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-rebuild-indexes","title":"\u2013rebuild-indexes","text":"<p>Rebuild secondary indexes in InnoDB tables after applying the log. Only use with \u2013prepare.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-rebuild-threads","title":"\u2013rebuild-threads=","text":"<p>This option defines the number of threads to rebuild indexes in a compact backup. Only use with <code>--prepare</code> and <code>--rebuild-indexes</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-redo-log-version","title":"\u2013redo-log-version=","text":"<p>The redo log version of the backup. Use only with <code>--prepare</code>.</p>"},{"location":"xtrabackup_bin/xbk_option_reference.html#-reencrypt-for-server-id","title":"\u2013reencrypt-for-server-id= <p>Use this option to start the server instance with different server_id from the one the encrypted backup was taken from, like a replication replica or a Galera node. When this option is used, xtrabackup will, as a prepare step, generate a new master key with ID based on the new server_id, store it into keyring file, and re-encrypt the tablespace keys inside of tablespace headers. The option should be passed for <code>--prepare</code> (final step).</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-remove-original","title":"\u2013remove-original <p>Implemented in Percona XtraBackup 2.4.6, this option when specified will remove <code>.qp</code>, <code>.xbcrypt</code> and <code>.qp.xbcrypt</code> files after decryption and decompression.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-rsync","title":"\u2013rsync <p>Use the <code>rsync</code> utility to optimize local file transfers.</p> <p>When this option is specified, xtrabackup uses <code>rsync</code> to copy all non-InnoDB files instead of spawning a separate copy command for each file. This option is faster for servers with a large number of databases or tables.</p> <p>This option cannot be used with <code>--stream</code>.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-safe-slave-backup","title":"\u2013safe-slave-backup <p>When specified, xtrabackup will stop the replica SQL thread just before running <code>FLUSH TABLES WITH READ LOCK</code> and wait to start backup until <code>Slave_open_temp_tables</code> in <code>SHOW STATUS</code> is zero. If there are no open temporary tables, the backup will occur; otherwise the SQL thread will be started and stopped until there are no open temporary tables. The backup will fail if <code>Slave_open_temp_tables</code> does not become zero after xtrabackup \u2013safe-slave-backup-timeout seconds. The replica SQL thread will be restarted when the backup finishes. This option is implemented to deal with replicating temporary tables and isn\u2019t neccessary with Row-Based-Replication.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-safe-slave-backup-timeoutseconds","title":"\u2013safe-slave-backup-timeout=SECONDS <p>How many seconds <code>xtrabackup --safe-slave-backup</code> should wait for <code>Slave_open_temp_tables</code> to become zero. The default is 300 seconds.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-secure-auth","title":"\u2013secure-auth <p>Refuse client connecting to the server if it uses old (pre-4.1.1) protocol. (Enabled by default; use \u2013skip-secure-auth to disable.)</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-server-id","title":"\u2013server-id= <p>The server instance being backed up.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-server-public-key-pathname","title":"\u2013server-public-key-path=name <p>File path the server\u2019s public RSA key in PEM format.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-skip-tables-compatibility-check","title":"\u2013skip-tables-compatibility-check <p>This option disables the engine compatibility warning.</p>  <p>See also</p> <p><code>--tables-compatibility-check</code></p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-slave-info","title":"\u2013slave-info <p>This option is useful when backing up a replication replica server. It prints the binary log position of the source server. It also writes the binary log coordinates to the <code>xtrabackup_slave_info</code> file as a <code>CHANGE MASTER</code> command. A new replica for this source can be set up by starting a replica server on this backup and issuing a <code>CHANGE MASTER</code> command with the binary log position saved in the xtrabackup_slave_info file.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl","title":"\u2013ssl <p>Enable secure connection. More information can be found in \u2013ssl MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-ca","title":"\u2013ssl-ca <p>Path of the file, which contains a list of trusted SSL CAs. More information can be found in \u2013ssl-ca MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-capath","title":"\u2013ssl-capath <p>The directory path that contains trusted SSL CA certificates in the PEM format. More information can be found in \u2013ssl-capath MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-cert","title":"\u2013ssl-cert <p>Path of the file which contains X509 certificate in PEM format. More information can be found in \u2013ssl-cert MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-cipher","title":"\u2013ssl-cipher <p>List of permitted ciphers to use for connection encryption. More information can be found in \u2013ssl-cipher MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-crl","title":"\u2013ssl-crl <p>Path of the file that contains certificate revocation lists. More information can be found in \u2013ssl-crl MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-crlpath","title":"\u2013ssl-crlpath <p>Path of the directory that contains certificate revocation list files. More information can be found in \u2013ssl-crlpath MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-key","title":"\u2013ssl-key <p>Path of the file that contains X509 key in PEM format. More information can be found in \u2013ssl-key MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-mode","title":"\u2013ssl-mode <p>The security state of connection to server. More information can be found in \u2013ssl-mode MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-ssl-verify-server-cert","title":"\u2013ssl-verify-server-cert <p>Verify server certificate Common Name value against host name used when connecting to server. More information can be found in \u2013ssl-verify-server-cert MySQL server documentation.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-stats","title":"\u2013stats <p>Causes xtrabackup to scan the specified data files and print out index statistics.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-streamname","title":"\u2013stream=name <p>Stream all backup files to the standard output in the specified format. Currently supported formats are <code>xbstream</code> and <code>tar</code>.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-tablesname","title":"\u2013tables=name <p>A regular expression against which the full tablename, in <code>databasename.tablename</code> format, is matched. If the name matches, the table is backed up. See partial backups.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-tables-compatibility-check","title":"\u2013tables-compatibility-check <p>This option enables the engine compatibility warning.</p> <p>The default value is <code>ON</code>. Use <code>--skip-tables-compatibility-check</code> to disable.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-tables-excludename","title":"\u2013tables-exclude=name <p>Filtering by regexp for table names. Operates the same way as <code>xtrabackup --tables</code>, but matched names are excluded from backup. Note that this option has a higher priority than <code>xtrabackup --tables</code>.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-tables-filename","title":"\u2013tables-file=name <p>A file containing one table name per line, in databasename.tablename format. The backup will be limited to the specified tables. See Scripting Backups With xtrabackup.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-target-dirdirectory","title":"\u2013target-dir=DIRECTORY <p>This option specifies the destination directory for the backup. If the directory does not exist, <code>xtrabackup</code> creates it. If the directory does exist and is empty, <code>xtrabackup</code> will succeed. <code>xtrabackup</code> will not overwrite existing files; however it will fail with operating system error 17, <code>file exists</code>.</p> <p>If this option is a relative path, it is interpreted as being relative to the current working directory from which xtrabackup is executed.</p> <p>In order to perform a backup, you need <code>READ</code>, <code>WRITE</code>, and <code>EXECUTE</code> permissions at a filesystem level for the directory that you supply as the value of <code>--target-dir</code>.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-throttle","title":"\u2013throttle= <p>This option limits the number of chunks copied per second. The chunk size is 10 MB.</p> <p>To limit the bandwidth to 10 MB/s, set the option to 1: <code>--throttle=1</code>.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-tls-versionname","title":"\u2013tls-version=name <p>The TLS version to use. The allowed values are the following:</p> <ul> <li> <p>TLSv1</p> </li> <li> <p>TLSv1.1</p> </li> <li> <p>TLSv1.2</p> </li> </ul>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-tmpdirname","title":"\u2013tmpdir=name <p>This option is currently not used for anything except printing out the correct tmpdir parameter when <code>xtrabackup --print-param</code> is used.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-to-archived-lsnlsn","title":"\u2013to-archived-lsn=LSN <p>This option is used to specify the LSN to which the logs should be applied when backups are being prepared. It can only be used with the <code>xtrabackup --prepare</code> option.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-transition-key","title":"\u2013transition-key <p>This option is used to enable processing the backup without accessing the keyring vault server. In this case, xtrabackup derives the AES encryption key from the specified passphrase and uses it to encrypt tablespace keys of tablespaces being backed up.</p> <p>If <code>--transition-key &lt;xtrabackup \u2013transition-key&gt;</code> does not have any value, xtrabackup will ask for it. The same passphrase should be specified for the <code>xtrabackup --prepare</code> command.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-use-memory","title":"\u2013use-memory= <p>This option affects how much memory is allocated and is similar to <code>innodb_buffer_pool_size</code>. This option is only relevant in the <code>--prepare</code> phase or when analyzing statistics with <code>--stats</code>. The default value is 100MB. The recommended value is between 1GB to 2GB. Multiples are supported providing the unit (for example, 1MB, 1M, 1GB, 1G).</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-userusername","title":"\u2013user=USERNAME <p>This option specifies the MySQL username used when connecting to the server, if that\u2019s not the current user. The option accepts a string argument. See mysql \u2013help for details.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-version","title":"\u2013version <p>This option prints xtrabackup version and exits.</p>","text":""},{"location":"xtrabackup_bin/xbk_option_reference.html#-xtrabackup-plugin-dirdirname","title":"\u2013xtrabackup-plugin-dir=DIRNAME <p>The absolute path to the directory that contains the <code>keyring</code> plugin.</p>  <p>See also</p> <p>Percona Server for MySQL Documentation: keyring_vault plugin with Data at Rest Encryption https://www.percona.com/doc/percona-server/5.7/security/data-at-rest-encryption.html MySQL Documentation: Using the keyring_file File-Based Plugin https://dev.mysql.com/doc/refman/5.7/en/keyring-file-plugin.html</p>","text":""},{"location":"xtrabackup_bin/xtrabackup_binary.html","title":"The xtrabackup Binary","text":"<p>The xtrabackup binary is a compiled C program that is linked with the InnoDB libraries and the standard MySQL client libraries. The InnoDB libraries provide functionality necessary to apply a log to data files, and the MySQL client libraries provide command-line option parsing, configuration file parsing, and so on to give the binary a familiar look and feel.</p> <p>The tool runs in either <code>xtrabackup --backup</code> or <code>xtrabackup --prepare</code> mode, corresponding to the two main functions it performs. There are several variations on these functions to accomplish different tasks, and there are two less commonly used modes, <code>xtrabackup --stats</code> and <code>xtrabackup --print-param</code>.</p>"},{"location":"xtrabackup_bin/xtrabackup_binary.html#other-types-of-backups","title":"Other Types of Backups","text":"<ul> <li> <p>Incremental Backups</p> </li> <li> <p>Partial Backups</p> </li> </ul>"},{"location":"xtrabackup_bin/xtrabackup_binary.html#advanced-features","title":"Advanced Features","text":"<ul> <li> <p>Throttling Backups</p> </li> <li> <p>Scripting Backups With xtrabackup</p> </li> <li> <p>Analyzing Table Statistics</p> </li> <li> <p>Working with Binary Logs</p> </li> <li> <p>Restoring Individual Tables</p> </li> <li> <p>LRU dump backup</p> </li> </ul>"},{"location":"xtrabackup_bin/xtrabackup_binary.html#implementation","title":"Implementation","text":"<ul> <li> <p>Implementation Details</p> </li> <li> <p>xtrabackup Exit Codes</p> </li> </ul>"},{"location":"xtrabackup_bin/xtrabackup_binary.html#references","title":"References","text":"<ul> <li>The xtrabackup Option Reference</li> </ul>"},{"location":"xtrabackup_bin/xtrabackup_exit_codes.html","title":"xtrabackup Exit Codes","text":"<p>The xtrabackup binary exits with the traditional success value of 0 after a backup when no error occurs. If an error occurs during the backup, the exit value is 1.</p> <p>In certain cases, the exit value can be something other than 0 or 1, due to the command-line option code included from the MySQL libraries. An unknown command-line option, for example, will cause an exit code of 255.</p>"}]}